### Run MCMC Analysis using jags
library(R2jags)
library(rstan)
library(rjags)
dyn.load(file, DLLpath = DLLpath, ...)
library("jagsUI", lib.loc="~/Library/R/3.5/library")
detach("package:jagsUI", unload=TRUE)
library("R2jags", lib.loc="~/Library/R/3.5/library")
library("R2WinBUGS", lib.loc="~/Library/R/3.5/library")
library("rjags", lib.loc="~/Library/R/3.5/library")
library("jagsUI", lib.loc="~/Library/R/3.5/library")
update.packages("jagsUI")
update.packages("rjags")
update.packages("r2jags")
library(R2jags)
devtools::install_url("http://sourceforge.net/projects/mcmc-jags/files/rjags/3/rjags_3-2.tar.gz",
args="--configure-args='--with-jags-include=/Users/casallas/homebrew/opt/jags/include/JAGS
--with-jags-lib=/Users/casallas/homebrew/opt/jags/lib'
"
)
devtools::install_url("https://sourceforge.net/projects/mcmc-jags/files/JAGS/4.x/Mac%20OS%20X/",
args="--configure-args='--with-jags-include=/Users/casallas/homebrew/opt/jags/include/JAGS
--with-jags-lib=/Users/casallas/homebrew/opt/jags/lib'
"
)
remove.packages("rjags", lib="~/Library/R/3.5/library")
remove.packages("jagsUI", lib="~/Library/R/3.5/library")
remove.packages("R2jags", lib="~/Library/R/3.5/library")
library("rjags", lib.loc="~/Library/R/3.5/library")
remove.packages("rjags", lib="~/Library/R/3.5/library")
library("R2WinBUGS", lib.loc="~/Library/R/3.5/library")
library("R2jags", lib.loc="~/Library/R/3.5/library")
install.packages("rjags")
library("rjags", lib.loc="~/Library/R/3.5/library")
remove.packages("rjags", lib="~/Library/R/3.5/library")
remove.packages("R2jags", lib="~/Library/R/3.5/library")
install.packages("jagsUI")
library(jagsUI)
library("jagsUI", lib.loc="~/Library/R/3.5/library")
install.packages("~/Downloads/JAGS-4.3.0.dmg", repos = NULL)
library("jagsUI", lib.loc="~/Library/R/3.5/library")
detach("package:jagsUI", unload=TRUE)
remove.packages("jagsUI", lib="~/Library/R/3.5/library")
library("rjags", lib.loc="~/Library/R/3.5/library")
devtools::install_url("http://sourceforge.net/projects/mcmc-jags/files/rjags/4/rjags_4-4.tar.gz")
devtools::install_url("http://sourceforge.net/projects/mcmc-jags/files/rjags/4/rjags_4-4.tar.gz")
library(rjags)
devtools::install_url("http://sourceforge.net/projects/mcmc-jags/files/rjags/4/rjags_4-4.tar.gz",)
remove.packages("rjags", lib="~/Library/R/3.5/library")
##################################################################
# Start to look at orca movement,
# Code based off Kery's movement examples
# Ailene Ettinger, ailene.ettinger@noaa.gov
# (modifed from code of  Mark Kery, marc.kery@vogelwarte.ch
# Start Date:December 11, 2018
# Title:	orca_movement_explore
##################################################################
#-----------------------------------------------------------------
# Data exploration code
#-----------------------------------------------------------------
#housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
# Set working directory:
setwd("~/Documents/GitHub/fishphen")
# Load libraries
# 1. Get the orcamaster data
d <- read.csv("data/AppendixII.csv")
# Select columns that you want and clean the orcamaster data
source("analyses/orca_dataprep_movement.R")
#for starters, run on most recent 7 years only:
j2017<-j[j$Year==2017,]
k2017<-k[k$Year==2017,]
#str(j)
#head(j)
#Make plot of movement of j pod in one year
# Static plot
# Grab x and y coordinates
x <- j2017$Lat.cl
y <- j2017$Long.cl
x.k <- k2017$Lat.cl
y.k <- k2017$Long.cl
length(x)
head(j2017)
head(d)
# Set working directory:
setwd("~/Documents/GitHub/fishphen")
# Load libraries
library(mgcv)
library(dplyr)
# 1. Get the data
d <- read.csv("data/AppendixII.csv")
# 2. Clean the data (also saved in output/AppendixII_cleaned,csv)
source("analyses/clean_orca.R")
#Create a new column that combines Pod and Likely Pod columna and removes spaces
d$Pod.cl<-d$Pod
#Always use Likely Pod column, when it is not blank:
d$Pod.cl[d$LikelyPod!="" & d$LikelyPod!=" "]<-d$LikelyPod[d$LikelyPod!="" & d$LikelyPod!=" "]
d$Pod.cl[d$Pod.cl=="j"|d$Pod.cl==" J"|d$Pod.cl=="J "|d$Pod.cl=="J  "|d$Pod.cl=="J   "|d$Pod.cl=="J?"|d$Pod.cl=="J "|d$Pod.cl=="J  "|d$Pod.cl=="J+"|d$Pod.cl=="Jp"|d$Pod.cl=="Jp "|d$Pod.cl=="Jp  "|d$Pod.cl=="Jp?"| d$Pod.cl=="Js"]<-"J"
d$Pod.cl[d$Pod.cl=="J1 "]<-"J1"
d$Pod.cl[d$Pod.cl=="K "|d$Pod.cl=="K  "|d$Pod.cl=="K?"|d$Pod.cl=="K+"|d$Pod.cl=="Kp"|d$Pod.cl=="KP"|d$Pod.cl=="Kp  "|d$Pod.cl=="Kp  "]<-"K"
d$Pod.cl[d$Pod.cl=="L "|d$Pod.cl=="L  "|d$Pod.cl=="L?"|d$Pod.cl=="L+"|d$Pod.cl=="L+?"|d$Pod.cl=="LP"|d$Pod.cl=="Lp  "|d$Pod.cl=="Lp "|d$Pod.cl=="Lp?"|d$Pod.cl=="Ls"|d$Pod.cl=="Ls?"]<-"L"
d$Pod.cl[d$Pod.cl=="JK "|d$Pod.cl=="JK  "|d$Pod.cl=="JK   "|d$Pod.cl=="J?K?"|d$Pod.cl=="KJ?"|d$Pod.cl=="JK+"|d$Pod.cl=="JKp+"|d$LikelyPod=="Jp+K?"]<-"JK"
d$Pod.cl[d$Pod.cl=="JL "|d$Pod.cl=="JL  "|d$Pod.cl=="JL   "|d$Pod.cl=="JLp? "|d$Pod.cl=="JpLp?"|d$Pod.cl=="JLp"]<-"JL"
d$Pod.cl[d$Pod.cl=="KL "|d$Pod.cl=="KL  "|d$Pod.cl=="KL?"|d$Pod.cl=="KL+? "|d$Pod.cl=="KpLp"|d$Pod.cl=="KpL"|d$Pod.cl=="KpL "|d$Pod.cl=="KpL  "|d$Pod.cl=="KpLp?"|d$Pod.cl=="LK"|d$Pod.cl=="LK?"]<-"KL"
d$Pod.cl[d$Pod.cl=="JL "|d$Pod.cl=="JL  "|d$Pod.cl=="JL   "|d$Pod.cl=="JLp? "|d$Pod.cl=="JpLp?"|d$Pod.cl=="JLp"]<-"JL"
d$Pod.cl[d$Pod.cl=="JKLp"|d$Pod.cl=="JKLm"|d$Pod.cl=="JKl"|d$Pod.cl=="JKL  "|d$Pod.cl=="JKL?"|d$Pod.cl=="JKLm"|d$Pod.cl=="JpKL"|d$Pod.cl=="JKLp"]<-"JKL"
d$Pod.cl[d$Pod.cl=="O?"|d$Pod.cl=="Ts?"]<-"Ts"
sort(unique(d$Pod.cl))
#remove non-orca data
d<-d[d$Pod.cl!="HB?"|d$Pod.cl!="Not Orcas",]
#4. Add week and day of year (doy)
d$doy<-strftime(strptime(paste(d$Month, d$Day, d$Year, sep="."),format= "%m.%d.%Y"),format= "%j")
d$week<-strftime(strptime(paste(d$Month, d$Day, d$Year, sep="."),format= "%m.%d.%Y"), format = "%V")#new weeks start on mondays
d$J<-0
d$J[grep("J",d$Pod.cl)]<- 1
d$K<-0
d$K[grep("K",d$Pod.cl)]<- 1
d$L<-0
d$L[grep("L",d$Pod.cl)]<- 1
d$SRKW<-0
d$SRKW[grep("SR",d$Pod.cl)]<- 1
d$SRKW[d$J==1|d$K==1|d$L==1]<- 1
d$Orcas<-1
#6. Add a column for total number of observations during the year to standardize
obs = aggregate(Orcas ~Year, data = d,sum)
colnames(obs)[2]<-"totobsyr"
d2<-left_join(d,obs,b="Year")
# Sum up Chinook for each calendar day across areas
SRs = aggregate(SRKW ~ week, data = d2,sum)
# Fit the gam, using log(effort) as offset
w = as.numeric(SRs$week)
effort = as.numeric(d2$totob)
head(effort)
head(d2)
obs
##Make plots of effort over time, for orcas and chinook
quarts(height=5, widths=10)
##Make plots of effort over time, for orcas and chinook
quartz(height=5, widths=10)
##Make plots of effort over time, for orcas and chinook
quartz(height=5, width=10)
par(mfrow=c(1,3))
plot(obs$Year,obs$totobsyr,type="b",xlab="Year",ylab="Number of observations")
head(data())
head(dat)
#Make plots of fishing areas by year with chinook and orcas present
#Read in the chinook data (WDFW recreational fishing data)
dat<-read.csv("data/2001-2013PSChinookLandings.csv", header=TRUE)
#get dates in day-of-year (doy) and week of year
dat$doy<-strftime(strptime(paste(dat$Month, dat$Day, dat$Year, sep="."),format= "%m.%d.%Y"),format= "%j")
dat$week<-strftime(strptime(paste(dat$Month, dat$Day, dat$Year, sep="."),format= "%m.%d.%Y"), format = "%V")#new weeks start on mondays
head(dat)
chinboatobs = aggregate(Boats ~Year, data = dat,sum)
chinboatobs = aggregate(Anglers ~Year, data = dat,sum)
chinboats = aggregate(Boats ~Year, data = dat,sum)
chinanglers = aggregate(Anglers ~Year, data = dat,sum)
plot(chinboats$Year,chinboats$Boats,type="b",pch=16,col="black",xlab="Year",ylab="Number of boats", main="Chinook")
plot(chinanglers$Year,chinanglers$Boats,type="b",pch=16,col="black",xlab="Year",ylab="Number of Anglers", main="Chinook")
chinanglers = aggregate(Anglers ~Year, data = dat,sum)
chinanglers
quartz(height=7, width=20)
par(mfrow=c(1,3))
plot(obs$Year,obs$totobsyr,type="b",pch=16,col="black",xlab="Year",ylab="Number of observations", main="Orcas")
chinboats = aggregate(Boats ~Year, data = dat,sum)
chinanglers = aggregate(Anglers ~Year, data = dat,sum)
plot(chinboats$Year,chinboats$Boats,type="b",pch=16,col="black",xlab="Year",ylab="Number of boats", main="Chinook")
plot(chinanglers$Year,chinanglers$Anglers,type="b",pch=16,col="black",xlab="Year",ylab="Number of Anglers", main="Chinook")
quartz(height=7, width=20)
par(mfrow=c(1,3))
plot(obs$Year,obs$totobsyr,type="b",pch=16,col="black",xlab="Year",ylab="Number of observations", main="Orcas")
chinboats = aggregate(Boats ~Year, data = dat,sum)
chinanglers = aggregate(Anglers ~Year, data = dat,sum)
plot(chinboats$Year,chinboats$Boats,type="b",pch=16,col="black",xlab="Year",ylab="Number of boats", main="Chinook-Boats")
plot(chinanglers$Year,chinanglers$Anglers,type="b",pch=16,col="black",xlab="Year",ylab="Number of Anglers", main="Chinook-Anglers")
# 1. Get the orcamaster data
d <- read.csv("data/AppendixII.csv")
# Select columns that you want and clean the orcamaster data
source("analyses/orca_dataprep_movement.R")
#for starters, run on most recent 7 years only:
j2017<-j[j$Year==2017,]
k2017<-k[k$Year==2017,]
#str(j)
#head(j)
#Make plot of movement of j pod in one year
# Static plot
# Grab x and y coordinates
x <- j2017$Lat.cl
y <- j2017$Long.cl
x.k <- k2017$Lat.cl
y.k <- k2017$Long.cl
quartz()
plot(x, y, type = "b", col = "red", pch = 16, main = "Start is at black plus sign", ylab = "Latitude", xlab = "Longitude",ylim = rev(range(y)),xlim = rev(range(x)))
n <- length(x)
points(x.k,y.k, type = "b",col="blue",pch = 16,)
points(x[1], y[1], col = "black", pch = "J", cex = 2)
points(x.k[1], y.k[1], col = "black", pch = "K", cex = 2)
quartz()
plot(x, y, type = "b", col = "red", pch = 16, main = "Start is at black letter", ylab = "Latitude", xlab = "Longitude",ylim = rev(range(y)),xlim = rev(range(x)))
n <- length(x)
points(x.k,y.k, type = "b",col="blue",pch = 16,)
points(x[1], y[1], col = "black", pch = "J", cex = 2)
points(x.k[1], y.k[1], col = "black", pch = "K", cex = 2)
range.x
# Dynamic plot (browse through)
range.x <- range(x)
range.y <- range(y)
range.x
range.y
#housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
# Set working directory:
setwd("~/Documents/GitHub/fishphen")
# Load libraries
# 1. Get the data
d <- read.csv("data/AppendixII.csv")
# 2. Clean the data (also saved in output/AppendixII_cleaned,csv)
source("analyses/clean_orca.R")
#Create a new column that combines Pod and Likely Pod columna and removes spaces
d$Pod.cl<-d$Pod
#Always use Likely Pod column, when it is not blank:
d$Pod.cl[d$LikelyPod!="" & d$LikelyPod!=" "]<-d$LikelyPod[d$LikelyPod!="" & d$LikelyPod!=" "]
#remove non-orca data
d<-d[d$Pod.cl!="HB?"|d$Pod.cl!="Not Orcas",]
#only using fishing areas in Washington's Salish Sea
d<-d[d$FishArea %in% c("01","02","03","04","05","06","07","09","10","11","12","13","81","82"),]#not sure where 17, 18, 19, 20, 28, 29 are...need to find out. also, where is 42583,42584
#Only use fishing areas that have atleast 4 years with >20 observations:
table(d$FishArea,d$Year)
#Only use fishing areas that have atleast 4 years with >20 observations:
tab.fa.yr<-table(d$FishArea,d$Year)
tab.fa.yr[>20,]
tab<-apply(tab.fa.yr, 1, function(x) {ifelse(any(x > 20), 1, 0)})
tab
1
tab.fa.yr[tab.fa.yr > 20] <- 1
#Only use fishing areas that have atleast 4 years with >20 observations:
tab.fa.yr<-table(d$FishArea,d$Year)
tab<-apply(tab.fa.yr, 1, function(x) {ifelse(any(x > 20), 1, 0)})
tab.fa.yr[tab.fa.yr > 20] <- 1
tab
tab.fa.yr
tab.fa.yr[tab.fa.yr < 20] <- 0
tab.fa.yr[tab.fa.yr >= 20] <- 1
tab.fa.yr
#Only use fishing areas that have atleast 4 years with >20 observations:
tab.fa.yr<-table(d$FishArea,d$Year)
tab.fa.yr[tab.fa.yr < 20] <- 0
tab.fa.yr
tab.fa.yr[tab.fa.yr >= 20] <- 1
tab.fa.yr
