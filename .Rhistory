boxplot(as.numeric(regdat$daysaftmar31[regdat[,colnum]==1])~as.factor(regdat$orcayear[regdat[,colnum]==1]),horizontal=TRUE,las=1,col=col,xaxt='n')
points(c(1,1,214,214),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1))
polygon(c(1,1,214,214),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1),
col=adjustcolor(col,alpha.f=0.2),
border=NA)
}
if(r=="ps"){
col="salmon"
#using orcayears
polygon(c(92,92,309,309),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1),
col=adjustcolor(col,alpha.f=0.2),
border=NA)
boxplot(as.numeric(regdat$daysaftmar31[regdat[,colnum]==1])~as.factor(regdat$orcayear[regdat[,colnum]==1]),horizontal=TRUE,las=1,col=col,xaxt='n')
}
if(r=="jf"){
col="darkgreen"
#using orcayears
boxplot(as.numeric(regdat$daysaftmar31[regdat[,colnum]==1])~as.factor(regdat$orcayear[regdat[,colnum]==1]),horizontal=TRUE,las=1,col=col,xaxt='n')
polygon(c(1,1,214,214),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1),
col=adjustcolor(col,alpha.f=0.2),
border=NA)
}
for(y in years){
yrdat = regdat[regdat$orcayear==y,]
days = yrdat$daysaftmar31[yrdat[,colnum]==1]
points(x=days,y=rep(y,length=length(days)), pch=16,col= col, cex=1.3)
#lines(x=days,y=rep(y,length=length(days)), lwd=2)
}
axis(side=1,at = c(1,92,184,276,365), labels=c("1Apr","1Jul","1Oct","1Jan","31Mar"))
#if(r=="uss"){mtext(paste(pods[p]), side=3,line=3, adj=0.5)}
if(r=="uss"){mtext("Year", side=2,line=4, adj=0.5)}
}
}
if(use3regions==FALSE){dev.off()}
#summarize the days on which atleast one sighting occured for each lat/long in ps and uss
srlatlon = aggregate(d$SRKW, list(d$Lat,d$Long,d$region,d$Year,d$day),sum)
colnames(srlatlon)<-c("lat","lon","region","year","doy","numsights")
latlons<-srlatlon[srlatlon$region!="oc",]#remove outercoast\
latlons<-latlons[latlons$lat!="",]#remove blank lats
latlons<-latlons[latlons$lon!="0.0000",] #remove weird lon
latlons$pres<-0#add column for 0/1 abs/pres on a given day at the lat/long.
latlons$pres[latlons$numsights>0]<-1
numdays<-aggregate(latlons$pres, list(latlons$lat,latlons$lon,latlons$region,latlons$year),sum)
colnames(numdays)<-c("lat","lon","region","year","numdays")
numdays<-numdays[numdays$numdays>0,]#remove zeros
meannumdays<-aggregate(numdays$numdays, list(numdays$lat,numdays$lon,numdays$region),mean)
colnames(meannumdays)<-c("lat","lon","region","mnnumdays")
#make a map that shows mean number of whale days by lat long in each region
newmap <- getMap(resolution = "low")
#quartz(height=12, width=6)
if(assumeSRKW==TRUE & use3regions==FALSE){mapname<-paste("analyses/figures/OrcaPhenPlots/srkw_justmap_assumeSRKW_April1.pdf")
pdf(mapname,height=12, width=6)
}
plot(newmap, xlim = c(-126, -120), ylim = c(49.2, 51), asp = 1)
points(meannumdays$lon[meannumdays$region=="ps"],meannumdays$lat[meannumdays$region=="ps"],type="p",pch=16, col="salmon",cex=log(meannumdays$mnnumdays, base=10))
points(meannumdays$lon[meannumdays$region=="uss"],meannumdays$lat[meannumdays$region=="uss"],type="p",pch=16, col="darkblue",cex=log(meannumdays$mnnumdays, base=10))
legend(-123.5,46,legend=c("# days per year= 2","# days per year= 80"),
pch=21, pt.bg=c("darkblue","darkblue"), pt.cex=c(log(2, base=10), log(80, base=10)))
dev.off()
#make a map that shows mean number of whale days by lat long in each region
newmap <- getMap(resolution = "low")
pdf("analyses/figures/OrcaPhenPlots/meanphenboxplot.pdf",height=6, width=10)
#quartz(height=6, width=6)
par(omi=c(.5,1.5,.5,.5), mfrow=c(1,1))
ps.ussdat<-orcasum.days[orcasum.days$region!="oc",]
cols=c("salmon","darkblue")
#using orcayears
boxplot(as.numeric(ps.ussdat$daysaftmar31)~as.factor(ps.ussdat$region),horizontal=TRUE,las=1,col=cols,xaxt='n', bty="l",boxwex=.75, at = c(1,5), names=c("Puget Sound","Central Salish Sea"), cex.label=1.2)
axis(side=1,at = c(1,92,184,276,365), labels=c("1Apr","1Jul","1Oct","1Jan","31Mar"))
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
#Same figure but from April 1- MAr 31 and try boxplots
if(assumeSRKW==TRUE & use3regions==FALSE){figname<-paste("analyses/figures/OrcaPhenPlots/srkw_phenmap_assumeSRKW_April1.pdf")}
if(assumeSRKW==FALSE & use3regions==FALSE){figname<-paste("analyses/figures/OrcaPhenPlots/srkw_phenmap_April1.pdf")}
if(assumeSRKW==TRUE & use3regions==TRUE){figname<-paste("analyses/figures/OrcaPhenPlots/srkw_phenmap_assumeSRKW_3regs_April1.pdf")}
if(assumeSRKW==FALSE & use3regions==TRUE){figname<-paste("analyses/figures/OrcaPhenPlots/srkw_phenmap_3regs_April1.pdf")}
if(use3regions==FALSE){
pdf(figname,height=12, width=6)
#quartz(height=12, width=6)
par(omi=c(.5,.5,.5,.5), mfrow=c(2,2))
}
if(use3regions==TRUE){
pdf(figname,height=6, width=20)
#quartz(height=6, width=20)
par(omi=c(.5,.5,.5,.5), mfrow=c(1,4))
}
podcols<-c("AllSRpres")
pods<-c("SRs")
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
regions=sort(unique(orcasum.days$region[-which(orcasum.days$region=="oc")]),decreasing=TRUE)
for(r in regions){
regdat<-orcasum.days[orcasum.days$region==r,]
years = unique(orcasum.days$orcayear)
plot(0, type = 'n', las=1, xlim=c(1,366),ylim=c(min(as.numeric(years)),max(as.numeric(years))),ylab="",xlab="Month",xaxt='n', main="", cex.axis=1.1, cex.lab=1.3)
if(r=="uss"){
col="darkblue"
#using orcayears
polygon(c(1,1,214,214),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1),
col=adjustcolor(col,alpha.f=0.2),
border=NA)
}
if(r=="ps"){
col="salmon"
#using orcayears
polygon(c(92,92,309,309),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1),
col=adjustcolor(col,alpha.f=0.2),
border=NA)
}
if(r=="jf"){
col="darkgreen"
#using orcayears
#polygon(c(1,1,214,214),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1),
#       col=adjustcolor(col,alpha.f=0.2),
#      border=NA)
}
for(y in years){
yrdat = regdat[regdat$orcayear==y,]
days = yrdat$daysaftmar31[yrdat[,colnum]==1]
points(x=days,y=rep(y,length=length(days)), pch=16,col= col, cex=1.3)
#lines(x=days,y=rep(y,length=length(days)), lwd=2)
}
axis(side=1,at = c(1,92,184,276,365), labels=c("1Apr","1Jul","1Oct","1Jan","31Mar"))
#if(r=="uss"){mtext(paste(pods[p]), side=3,line=3, adj=0.5)}
if(r=="uss"){mtext("Year", side=2,line=4, adj=0.5)}
}
}
if(use3regions==FALSE){dev.off()}
#summarize the days on which atleast one sighting occured for each lat/long in ps and uss
srlatlon = aggregate(d$SRKW, list(d$Lat,d$Long,d$region,d$Year,d$day),sum)
colnames(srlatlon)<-c("lat","lon","region","year","doy","numsights")
latlons<-srlatlon[srlatlon$region!="oc",]#remove outercoast\
latlons<-latlons[latlons$lat!="",]#remove blank lats
latlons<-latlons[latlons$lon!="0.0000",] #remove weird lon
latlons$pres<-0#add column for 0/1 abs/pres on a given day at the lat/long.
latlons$pres[latlons$numsights>0]<-1
numdays<-aggregate(latlons$pres, list(latlons$lat,latlons$lon,latlons$region,latlons$year),sum)
colnames(numdays)<-c("lat","lon","region","year","numdays")
numdays<-numdays[numdays$numdays>0,]#remove zeros
meannumdays<-aggregate(numdays$numdays, list(numdays$lat,numdays$lon,numdays$region),mean)
colnames(meannumdays)<-c("lat","lon","region","mnnumdays")
#make a map that shows mean number of whale days by lat long in each region
newmap <- getMap(resolution = "low")
#quartz(height=17, width=6)
#windows(height=10, width=10)
if(assumeSRKW==TRUE & use3regions==FALSE){mapname<-paste("analyses/figures/OrcaPhenPlots/srkw_justmap_assumeSRKW_April1.pdf")
pdf(mapname,height=12, width=6)
}
if(assumeSRKW==FALSE & use3regions==FALSE){mapname<-paste("analyses/figures/OrcaPhenPlots/srkw_justmap_April1.pdf")
pdf(mapname,height=12, width=6)
}
plot(newmap, xlim = c(-126, -120), ylim = c(47.2, 51), asp = 1)
#d$Lat<-as.numeric(d$Lat);d$Long<-as.numeric(d$Long)
#points(d$Long[d$FishArea=="07"],d$Lat[d$FishArea=="07"], type="p",och=16, col="green")
#points(d$Long[d$FishArea=="06"],d$Lat[d$FishArea=="06"], type="p", col="blue")
#points(d$Long[d$FishArea=="06"],d$Lat[d$FishArea=="06"], type="p",col="blue")
#points(d$Long[d$FishArea=="05"],d$Lat[d$FishArea=="05"], type="p",col="red")
#points(d$Long[d$FishArea=="04"],d$Lat[d$FishArea=="04"], type="p",col="orange")
#points(d$Long[d$FishArea=="03"],d$Lat[d$FishArea=="03"], type="p",col="yellow")
#points(d$Long[d$FishArea=="02"],d$Lat[d$FishArea=="02"], type="p",col="yellow")
#points(d$Long[d$FishArea=="01"],d$Lat[d$FishArea=="01"], type="p",col="yellow")
#points(d$Long[d$FishArea=="09"],d$Lat[d$FishArea=="09"], type="p",col="purple")
#points(d$Long[d$FishArea=="81"],d$Lat[d$FishArea=="81"], type="p",col="gray")
#points(d$Long[d$FishArea=="82"],d$Lat[d$FishArea=="82"], type="p",col="gray")
#points(d$Long[d$FishArea=="12"],d$Lat[d$FishArea=="12"], type="p",col="lightblue")
#points(d$Long[d$FishArea=="11"],d$Lat[d$FishArea=="11"], type="p",col="lightgreen")
#points(d$Long[d$FishArea=="13"],d$Lat[d$FishArea=="13"], type="p",col="darkgreen")
#points(d$Long[d$FishArea=="10"],d$Lat[d$FishArea=="10"], type="p",col="pink")
#points(d$Long[d$FishArea=="18C"],d$Lat[d$FishArea=="18C"], type="p",col="lightgreen")
#points(d$Long[d$FishArea=="19C"],d$Lat[d$FishArea=="19C"], type="p",col="darkred")
#points(d$Long[d$FishArea=="20C"],d$Lat[d$FishArea=="20C"], type="p",col="pink")
#points(d$Long[d$FishArea=="21C"],d$Lat[d$FishArea=="21C"], type="p",col="purple")
points(meannumdays$lon[meannumdays$region=="ps"],meannumdays$lat[meannumdays$region=="ps"],type="p",pch=16, col=adjustcolor("salmon",alpha.f=0.6),cex=log(meannumdays$mnnumdays, base=10))
points(meannumdays$lon[meannumdays$region=="uss"],meannumdays$lat[meannumdays$region=="uss"],type="p",pch=16, col=adjustcolor("darkblue",alpha.f=0.4),cex=log(meannumdays$mnnumdays, base=10))
points(meannumdays$lon[meannumdays$region=="jf"],meannumdays$lat[meannumdays$region=="jf"],type="p",pch=16, col="darkgreen",cex=log(meannumdays$mnnumdays, base=10))
legend(-122.3,52,legend=c("Central Salish Sea","Puget Sound proper","# days per year= 2","# days per year= 80", "Lime Kiln", "Albion Test Fishery"),
pch=c(16,16,16,16,8,17), col=c(adjustcolor("darkblue",alpha.f=0.4),adjustcolor("salmon",alpha.f=0.6),adjustcolor("darkblue",alpha.f=0.4),adjustcolor("darkblue",alpha.f=0.4),"black","black"), pt.cex=c(log(7, base=10),log(7, base=10),log(2, base=10), log(80, base=10),1,1))
#add  lime kiln
points(-123.1510,48.5160,pch=8,col="black" )
#add  albion test fishery
points(-122.62275,49.2104,pch=17,col="black" )
dev.off()
limekiln<-c(48.5160,-123.1510,"Lime Kiln Point State Park","NA","NA")
albion<-c(49.2104,-122.62275,"Albion Test Fishery","NA","NA")
meannumdays$logdays<-log(meannumdays$mnnumdays, base=10)
mapdatfile<-rbind(limekiln,albion,meannumdays)
mapdatfile<-mapdatfile[mapdatfile$region!="oc",]
write.csv(mapdatfile,"analyses/output/srkw_mapdatfile.csv", row.names = FALSE)
#Try boxplots
if(assumeSRKW==TRUE & use3regions==FALSE){figname<-paste("analyses/figures/OrcaPhenPlots/srkw_phenmap_assumeSRKW_April1box.pdf")}
if(assumeSRKW==FALSE & use3regions==FALSE){figname<-paste("analyses/figures/OrcaPhenPlots/srkw_phenmap_April1box.pdf")}
if(assumeSRKW==TRUE & use3regions==TRUE){figname<-paste("analyses/figures/OrcaPhenPlots/srkw_phenmap_assumeSRKW_3regs_April1box.pdf")}
if(assumeSRKW==FALSE & use3regions==TRUE){figname<-paste("analyses/figures/OrcaPhenPlots/srkw_phenmap_3regs_April1box.pdf")}
if(use3regions==FALSE){
pdf(figname,height=12, width=6)
#quartz(height=12, width=6)
par(omi=c(.5,.5,.5,.5), mfrow=c(2,1))
}
if(use3regions==TRUE){
pdf(figname,height=6, width=20)
#quartz(height=6, width=20)
par(omi=c(.5,.5,.5,.5), mfrow=c(1,4))
}
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
regions=sort(unique(orcasum.days$region[-which(orcasum.days$region=="oc")]),decreasing=TRUE)
for(r in regions){
regdat<-orcasum.days[orcasum.days$region==r,]
regdat<-regdat[regdat$orcayear>1976,]
regdat<-regdat[regdat$orcayear<2017,]
years = sort(unique(regdat$orcayear))
if(r=="uss"){
col="darkblue"
#using orcayears
boxplot(as.numeric(regdat$daysaftmar31[regdat[,colnum]==1])~as.factor(regdat$orcayear[regdat[,colnum]==1]),horizontal=TRUE,las=1,col=col,xaxt='n')
points(c(1,1,214,214),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1))
polygon(c(1,1,214,214),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1),
col=adjustcolor(col,alpha.f=0.2),
border=NA)
}
if(r=="ps"){
col="salmon"
#using orcayears
polygon(c(92,92,309,309),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1),
col=adjustcolor(col,alpha.f=0.2),
border=NA)
boxplot(as.numeric(regdat$daysaftmar31[regdat[,colnum]==1])~as.factor(regdat$orcayear[regdat[,colnum]==1]),horizontal=TRUE,las=1,col=col,xaxt='n')
}
if(r=="jf"){
col="darkgreen"
#using orcayears
boxplot(as.numeric(regdat$daysaftmar31[regdat[,colnum]==1])~as.factor(regdat$orcayear[regdat[,colnum]==1]),horizontal=TRUE,las=1,col=col,xaxt='n')
polygon(c(1,1,214,214),c(max(as.numeric(years))+1,min(as.numeric(years))-1,min(as.numeric(years))-1,max(as.numeric(years))+1),
col=adjustcolor(col,alpha.f=0.2),
border=NA)
}
for(y in years){
yrdat = regdat[regdat$orcayear==y,]
days = yrdat$daysaftmar31[yrdat[,colnum]==1]
points(x=days,y=rep(y,length=length(days)), pch=16,col= col, cex=1.3)
#lines(x=days,y=rep(y,length=length(days)), lwd=2)
}
axis(side=1,at = c(1,92,184,276,365), labels=c("1Apr","1Jul","1Oct","1Jan","31Mar"))
#if(r=="uss"){mtext(paste(pods[p]), side=3,line=3, adj=0.5)}
if(r=="uss"){mtext("Year", side=2,line=4, adj=0.5)}
}
}
if(use3regions==FALSE){dev.off()}
#summarize the days on which atleast one sighting occured for each lat/long in ps and uss
srlatlon = aggregate(d$SRKW, list(d$Lat,d$Long,d$region,d$Year,d$day),sum)
colnames(srlatlon)<-c("lat","lon","region","year","doy","numsights")
latlons<-srlatlon[srlatlon$region!="oc",]#remove outercoast\
latlons<-latlons[latlons$lat!="",]#remove blank lats
latlons<-latlons[latlons$lon!="0.0000",] #remove weird lon
latlons$pres<-0#add column for 0/1 abs/pres on a given day at the lat/long.
latlons$pres[latlons$numsights>0]<-1
numdays<-aggregate(latlons$pres, list(latlons$lat,latlons$lon,latlons$region,latlons$year),sum)
colnames(numdays)<-c("lat","lon","region","year","numdays")
numdays<-numdays[numdays$numdays>0,]#remove zeros
meannumdays<-aggregate(numdays$numdays, list(numdays$lat,numdays$lon,numdays$region),mean)
colnames(meannumdays)<-c("lat","lon","region","mnnumdays")
#make a map that shows mean number of whale days by lat long in each region
newmap <- getMap(resolution = "low")
#quartz(height=12, width=6)
if(assumeSRKW==TRUE & use3regions==FALSE){mapname<-paste("analyses/figures/OrcaPhenPlots/srkw_justmap_assumeSRKW_April1.pdf")
pdf(mapname,height=12, width=6)
}
plot(newmap, xlim = c(-126, -120), ylim = c(49.2, 51), asp = 1)
points(meannumdays$lon[meannumdays$region=="ps"],meannumdays$lat[meannumdays$region=="ps"],type="p",pch=16, col="salmon",cex=log(meannumdays$mnnumdays, base=10))
points(meannumdays$lon[meannumdays$region=="uss"],meannumdays$lat[meannumdays$region=="uss"],type="p",pch=16, col="darkblue",cex=log(meannumdays$mnnumdays, base=10))
legend(-123.5,46,legend=c("# days per year= 2","# days per year= 80"),
pch=21, pt.bg=c("darkblue","darkblue"), pt.cex=c(log(2, base=10), log(80, base=10)))
dev.off()
#make a map that shows mean number of whale days by lat long in each region
newmap <- getMap(resolution = "low")
#
# #quartz(height=6, width=6)
# if(assumeSRKW==FALSE & use3regions==FALSE){mapname<-paste("analyses/figures/OrcaPhenPlots/srkw_justmap_April1.pdf")
# pdf(mapname,height=12, width=6)
# }
# plot(newmap, xlim = c(-126, -120), ylim = c(49.2, 51), asp = 1)
# points(meannumdays$lon[meannumdays$region=="ps"],meannumdays$lat[meannumdays$region=="ps"],type="p",pch=16, col=adjustcolor("salmon", alpha.f=0.1),cex=log(meannumdays$mnnumdays, base=10))
# points(meannumdays$lon[meannumdays$region=="uss"],meannumdays$lat[meannumdays$region=="uss"],type="p",pch=16, col=adjustcolor("darkblue", alpha.f=0.1),cex=log(meannumdays$mnnumdays, base=10))
# legend(-122.3,47,legend=c("Central Salish Sea","Puget Sound proper","# days per year= 2","# days per year= 80"),
#        pch=21, pt.bg=adjustcolor(c("darkblue","salmon","darkblue","darkblue"), alpha.f=.1), pt.cex=c(log(5, base=10),log(5, base=10),log(2, base=10), log(80, base=10)))
# #add  lime kiln
# points(-123.1510,48.5160,pch=4,cex=2 )
#
# dev.off()#adjustcolor(col,alpha.f=0.2)
#
# #Make box plots of data across all years
pdf("analyses/figures/OrcaPhenPlots/meanphenboxplot.pdf",height=6, width=10)
#quartz(height=6, width=6)
par(omi=c(.5,1.5,.5,.5), mfrow=c(1,1))
ps.ussdat<-orcasum.days[orcasum.days$region!="oc",]
cols=c("salmon","darkblue")
#using orcayears
boxplot(as.numeric(ps.ussdat$daysaftmar31)~as.factor(ps.ussdat$region),horizontal=TRUE,las=1,col=cols,xaxt='n', bty="l",boxwex=.75, at = c(1,5), names=c("Puget Sound","Central Salish Sea"), cex.label=1.2)
axis(side=1,at = c(1,92,184,276,365), labels=c("1Apr","1Jul","1Oct","1Jan","31Mar"))
dev.off()
#check that dat file does not have the erronesou lats from uss
sort(unique(mapdatfile$lat[mapdatfile$region=="USS"]))
mapdatfile$region
unique(mapdatfile$lat[mapdatfile$region=="USS"])
colnames(mapdatfile)
unique(mapdatfile$lat)
unique(mapdatfile$region)
unique(mapdatfile$lat[mapdatfile$region=="USS"])
mapdatfile[mapdatfile$region=="USS",]
mapdatfile[mapdatfile$region=="PS",]
mapdatfile$lat[mapdatfile$region=="uss"]
unique(mapdatfile$lat[mapdatfile$region=="uss"])
sort(unique(mapdatfile$lat[mapdatfile$region=="uss"]))
min(as.numeric(unique(mapdatfile$lat[mapdatfile$region=="uss"]))))
min(as.numeric(unique(mapdatfile$lat[mapdatfile$region=="uss"])))
mapdatfile[mapdatfile$lat=="47.5829",])
mapdatfile[mapdatfile$lat=="47.5829",]
d[d$Lat=="47.5829",]
d$FishArea[d$Lat=="47.5829"]
d[d$Lat=="47.5829",]
d$region[d$Lat=="47.5829"]
unique(mapdatfile$lat)
which(is.na((mapdatfile$lat)))
which(is.na((mapdatfile$lon)))
which(is.na((mapdatfile$region)))
which(is.na((mapdatfile$mnnumdays)))
range(as.numeric(mapdatfile$lat[mapdatfile$region=="uss"])))
range(as.numeric(mapdatfile$lat[mapdatfile$region=="uss"]))
range(as.numeric(mapdatfile$lat[mapdatfile$region=="ps"]))
mapdatfile[mapdatfile$lat=="45.5829",]
mapdatfile[mapdatfile$lat==47.5829,]
#Only use fishing areas that have atleast 4 years with >20 observations:
#Look at some basic stats about orca observations
#Started with orca_dataprep_occmodel.R code
#4 February 2019
#housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
# Set working directory:
setwd("~/Documents/GitHub/fishphen")#setwd("~/GitHub/fishphen")
#or from laptop:
#setwd("/Users/aileneettinger/Documents/GitHub/fishphen")
# Load libraries
library(dplyr)
library(mgcv)
library(scales)
library(RColorBrewer)
library(rworldmap)
library(scales)
library(matrixStats)
# 1. Choose the years, regions of interest, assumption about reports in the OrcaMaster and get the data
includeCanada=TRUE
firstyear=1976#probably set to 1975 or 1976 (Olson et al)
assumeSRKW=FALSE #If true, assume that "Orcas" means SRKW unless noted otherwuse (i.e. Transients or NRKWs)
use3regions=FALSE#If true, separate out the straight of Juan de Fuca as a 3rd region, distinct from CSS and PS (all code not yet working for 3 regions!)
#Set start of seasons
ps.start<-182#July 1 = 182
uss.start<-91#April 1 = 91,
d <- read.csv("data/AppendixII.csv")
quads<-read.csv("data/QuadCentroids.csv")
dim(d)#105344  18 on Nov 08, 2019
# 2. Clean the data (also saved in output/AppendixII_cleaned,csv)
source("analyses/orcaphen/source/clean_orca.R")
dim(d)#105339     21 on Nov 8, 2019
# 3. Limit space and time to firstyear or later and Salish Sea, Puget Sound, Washington Outer Coast
source("analyses/orcaphen/source/orca_limitspacetime.R")
dim(d)#102435      22
#table(d$FishArea,d$region)#check regions are correct
#4. Get data in terms of number of observations per day and "whale days": days on which whales were seen (presence/absence for each day)
source("analyses/orcaphen/source/orca_get_whaledays.R")
#5. Summarize and plot whale days
wdays<-as.data.frame(tapply(orcasum.days$AllSRpres,list(orcasum.days$year,orcasum.days$region),sum))
wdays.J<-as.data.frame(tapply(orcasum.days$Jpres,list(orcasum.days$year,orcasum.days$region),sum))
wdays.K<-as.data.frame(tapply(orcasum.days$Kpres,list(orcasum.days$year,orcasum.days$region),sum))
wdays.L<-as.data.frame(tapply(orcasum.days$Lpres,list(orcasum.days$year,orcasum.days$region),sum))
source("analyses/orcaphen/source/orca_plot_whaledays.R")
#6. if you want to do some other basic plots of the data. This includes proportion of days in a week in which whales were observed up by week and decade
#source("analyses/orcaphen/source/orca_plotdata.R")
#7. Make a map of the SRKW sightings in ps and uss
source("analyses/orcaphen/source/orca_makemap.R")
#Take home from the above plots: Seasonality is hard to see in the figure with a separate line for each decade. I also plotted them with a single line showing the mean across all decades, and I standardized the proportions by substracting the means and dividing by the standard deviation.
#I did this to try to make seasonal patterns more obvious. It only sort of made them more obvious. Here's what I take away from these figures:
#1) There is a very clear seasonal pattern in the SRKW use of the upper salish sea. This season ranges roughly from week 20 (mid May) through week 40 (early October).
#2) The seasonal pattern in the SRKW use is less obvious for Puget Sound, because the maximum proportion is lower over all. However, the season during which the proportion is consistently above the mean probability
#ranges from week 40 (early October) through week 2 (early January)
#use these for whale seasons to investigate shifts over time
#use apr 1 for uss season, aug 1 for ps season as start dates
#use oct 31 for uss season, jan31 for ps season, as end dates
#8. Fit some basic linear models to all srkw data
regions=unique(orcasum.days$region)
podcols<-c("Jpres","Kpres","Lpres","AllSRpres")
pods<-c("J", "K","L","SRs")
source("analyses/orcaphen/source/orca_runlinmods.R")
#9. Fit some basic linear models to lime kiln data only
limed<-d[d$Source=="TWM-Otis",]
limed<-limed[which(!is.na(limed$SightDate)),]
source("analyses/orcaphen/source/orca_runlinmods_lime.R")
# Orca analysis: occupancy models
# Started November 1327, 2018
# by Ailene Ettinger ailene.ettinger@noo.gov
#NEed to fix this
#housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
# Set working directory:
setwd("~/Documents/GitHub/fishphen")
# Load libraries
library(dplyr)
# 1. Choose the years, regions of interest, assumption about reports in the OrcaMaster and get the data
includeCanada=TRUE
firstyear=1978#probably set to 1975 or 1976 (Olson et al)
assumeSRKW=FALSE #If true, assume that "Orcas" means SRKW unless noted otherwuse (i.e. Transients or NRKWs)
use3regions=FALSE#If true, separate out the straight of Juan de Fuca as a 3rd region, distinct from CSS and PS
d <- read.csv("data/AppendixII.csv")
quads<-read.csv("data/QuadCentroids.csv")
# 2. Clean the data (also saved in output/AppendixII_cleaned,csv)
source("analyses/orcaphen/source/clean_orca.R")
# 3. Limit space and time to firstyear or later and Salish Sea, Puget Sound, Washington Outer Coast
source("analyses/orcaphen/source/orca_limitspacetime.R")
#4. Get data in terms of number of observations per day and "whale days": days on which whales were seen (presence/absence for each day)
source("analyses/orcaphen/source/orca_get_whaledays.R")
#Only use fishing areas that have atleast 4 years with >20 observations:
#tab.fa.yr<-table(d$FishArea,d$Year)
#tab.fa.yr[tab.fa.yr < 20] <- 0
#tab.fa.yr[tab.fa.yr >= 20] <- 1
#sites.touse<-rownames(tab.fa.yr)[rowSums(tab.fa.yr)>4]
#d<-d[d$FishArea %in% c(sites.touse),]
#Prepare data for running model from strebel et al 2014
#"nrep" "ndet" "site" "day" "year"
# Add a column for total number of observations
#of all SRKWs during each week of each year year to estimate detection
#d$wkyrfa<-paste(d$Year, d$week,d$FishArea,sep="_")#if we decide to add FishArea to detection estimates for model
#d$wkyr<-paste(d$Year, d$week,sep="_")
#unique(d$FishArea)
d$yrdayfa<-paste(d$Year, d$day,d$FishArea,sep="_")
#Raw detection ratios:
obs = aggregate(Orcas ~yrdayfa, data = d,sum)
# presence of each pod
js = aggregate(J ~yrdayfa, data = d,sum)
ks = aggregate(K~yrdayfa, data = d,sum)
ls = aggregate(L~yrdayfa, data = d,sum)
srs = aggregate(SRKW~yrdayfa, data = d,sum)
det<-cbind(js,ks[,2],ls[,2],srs[,2],obs[2])
colnames(det)[2:6]<-c("Jobs","Kobs","Lobs","AllSRobs","nrep")
det$year<-substr(det$yrdayfa,1,4)
det$day<-substr(det$yrdayfa,6,8)
det$fa<-substr(det$yrdayfa,10,nchar(det$yrdayfa))
#4.#Assign region to this new aggregated dataset, based on fishing area:
if(use3regions==FALSE){
det$region<-"ps"
det$region[det$fa=="04"|det$fa=="05"|det$fa=="06"|det$fa=="07"|det$fa== "16C"|det$fa=="17C"|det$fa== "18C"|det$fa=="19C"|det$fa=="20C"|det$fa=="29C"]<-"uss"
det$region[det$fa=="01"|det$fa=="02"|det$fa=="03"]<-"oc"#outer coast
}
if(use3regions==TRUE){
det$region<-"ps"
det$region[det$fa=="06"|det$fa=="07"|det$fa== "16C"|det$fa=="17C"|det$fa== "18C"|det$fa=="19C"|det$fa=="29C"]<-"uss"
det$region[det$fa=="01"|det$fa=="02"|det$fa=="03"]<-"oc"#outer coast
det$region[det$fa=="04"|det$fa=="05"|det$fa=="20C"|det$fa=="21C"|det$fa=="22C"|det$fa=="121C"]<-"jf"#straight of juan de fuca
}
det$site<-as.numeric(as.factor(det$fa))
det$day<-as.numeric(det$day)
det$year<-as.numeric(det$year)
jdet<-subset(det,select=c(nrep,Jobs,site,day,year,region))
#i.e. use only sites that have atleast 1 observation in all years
jdet <- jdet[apply(jdet, 1, function(x) all(!is.na(x))),] # only keep rows of all not na
#jdet<- jdet[apply(jdet,1,function(row) all(row!=0)),]
#kdet<-subset(det,select=c(nrep,Kobs,site,day,orcayear,daysaftsept30,season,region))
kdet<-subset(det,select=c(nrep,Kobs,site,day,year,region))
kdet <- kdet[apply(kdet, 1, function(x) all(!is.na(x))),] # only keep rows of all not na
#ldet<-subset(det,select=c(nrep,Lobs,site,day,orcayear,daysaftsept30,season,region))
ldet<-subset(det,select=c(nrep,Lobs,site,day,year,region))
ldet <- ldet[apply(ldet, 1, function(x) all(!is.na(x))),] # only keep rows of all not na
#srdet<-subset(det,select=c(nrep,AllSRobs,site,day,orcayear,daysaftsept30,season,region))
srdet<-subset(det,select=c(nrep,AllSRobs,site,day,year,region))
srdet <- srdet[apply(srdet, 1, function(x) all(!is.na(x))),] # only keep rows of all not na
colnames(srdet)[2]<-colnames(jdet)[2]<-colnames(kdet)[2]<-colnames(ldet)[2]<-"ndet"
colnames(srdet)[5]<-colnames(jdet)[5]<-colnames(kdet)[5]<-colnames(ldet)[5]<-"year"
if(assumeSRKW==FALSE){
write.csv(srdet,"analyses/output/allsr_dat.csv",row.names = FALSE)
write.csv(ldet,"analyses/output/l_dat.csv",row.names = FALSE)
write.csv(kdet,"analyses/output/k_dat.csv",row.names = FALSE)
write.csv(jdet,"analyses/output/j_dat.csv",row.names = FALSE)
}
if(assumeSRKW==TRUE){
write.csv(srdet,"analyses/output/allsr_dat_assumeSRKW.csv",row.names = FALSE)
write.csv(ldet,"analyses/output/l_dat_assumeSRKW.csv",row.names = FALSE)
write.csv(kdet,"analyses/output/k_dat_assumeSRKW.csv",row.names = FALSE)
write.csv(jdet,"analyses/output/j_dat_assumeSRKW.csv",row.names = FALSE)
}
#
#nrep   ndet
#101974  54444
head(srdet)
head(ldet)
table(jdet$site,jdet$region)
install.packages("R2jags")
install.packages("Rtools")
rm(list=ls())
options(stringsAsFactors = FALSE)
# Set working directory
setwd("~/Documents/GitHub/fishphen")
# Load libraries
library(R2jags)
library(scales)
# C
install.packages("rjags")
install.packages("R2jags")
install.packages("Rtools")
