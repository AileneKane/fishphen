slope.first<-mean(r.first[,2],na.rm=T)
intercept.first.lci<-quantile(r.first[,1],c(lci),na.rm=T)
intercept.first.uci<-quantile(r.first[,1],c(uci),na.rm=T)
slope.first.lci<-quantile(r.first[,2],c(lci),na.rm=T)
slope.first.uci<-quantile(r.first[,2],c(uci),na.rm=T)
#Look at trends just in recent data
r.first.recent<-matrix(NA,dim(firstlp)[1],2)
for (o in 1:(dim(firstlp)[1])) {
y<-firstlp[o,25:40]
y[y=="Inf"]<-NA
lm(y~as.numeric(colnames(firstlp))[25:40])$coefficients->r.first.recent[o,]
}
slopevec.first.recent<-as.vector(r.first.recent[,2])
intercept.first.recent<-mean(r.first.recent[,1],na.rm=T)
slope.first.recent<-mean(r.first.recent[,2],na.rm=T)
intercept.first.recent.lci<-quantile(r.first.recent[,1],c(lci),na.rm=T)
intercept.first.recent.uci<-quantile(r.first.recent[,1],c(uci),na.rm=T)
slope.first.recent.lci<-quantile(r.first.recent[,2],c(lci),na.rm=T)
slope.first.recent.uci<-quantile(r.first.recent[,2],c(uci),na.rm=T)
#get last date when detectability is greater than prob
findlast.fn<-function(x) {
max(which(plogis(x)>prob), na.rm=TRUE)
}
#check:
#count.fn<-function(x) {
#  length(which(plogis(x)<prob))
#}
lastlp<-array(data=NA,dim=c(out$n.sims,nyear))
dimnames(lastlp)<-list(c(1:out$n.sims),c(sort(unique(dat$year))))
for (xj in sort(unique(as.numeric(factor(dat$year))))) {
lastlp[,xj]<-apply(out$sims.array[,,paste("lp[",xj[1],",",1:(max(dat$day)-min(dat$day)+1),"]",sep="")],MARGIN=c(if(out$n.chains>1) 1:2 else 1),findlast.fn)
}
lastlp<-lastlp+min(dat$day)-1
#lastlp[lastlp==max(dat$day)]<-NA
#lastlp[lastlp==min(dat$day)]<-NA
#lastlp[which(lastlp=="Inf")]<-NA
lastlp[which(lastlp=="-Inf")]<-NA
#lastlp<-as.numeric(lastlp)
#countlp<-array(data=NA,dim=c(out$n.sims,nyear))
#dimnames(countlp)<-list(c(1:out$n.sims),c(sort(unique(dat$year))))
#for (xj in sort(unique(as.numeric(factor(dat$year))))) {
#  countlp[,xj]<-apply(out$sims.array[,,paste("lp[",xj[1],",",1:(max(dat$day)-min(dat$day)+1),"]",sep="")],MARGIN=c(if(out$n.chains>1) 1:2 else 1),count.fn)
#}
#returns "inf" when no estimates are >prob
# summarize estimates
ann.last<-array(NA, dim=c(max(dat$year)-min(dat$year)+1,3),dimnames=list(c(min(dat$year):max(dat$year)),c("mean","lci","uci")))
last<-apply(lastlp,c(2),mean,na.rm=T)
ann.last[names(last),"mean"]<-last
last<-apply(lastlp,c(2),quantile,probs=lci,na.rm=T)
ann.last[names(last),"lci"]<-last
last<-apply(lastlp,c(2),quantile,probs=uci,na.rm=T)
ann.last[names(last),"uci"]<-last
# get estimate of trend in date of peak detectability over years
#firstlp<-as.numeric()
r.last<-matrix(NA,dim(lastlp)[1],2)
for (o in 1:(dim(lastlp)[1])) {
# if(!is.na(sum(lpmax[o,]))) {
y<-lastlp[o,]
y[y=="Inf"]<-NA
lm(y~as.numeric(colnames(lastlp)))$coefficients->r.last[o,]
#}
}
slopevec.last<-as.vector(r.last[,2])
intercept.last<-mean(r.last[,1],na.rm=T)
slope.last<-mean(r.last[,2],na.rm=T)
intercept.last.lci<-quantile(r.last[,1],c(lci),na.rm=T)
intercept.last.uci<-quantile(r.last[,1],c(uci),na.rm=T)
slope.last.lci<-quantile(r.last[,2],c(lci),na.rm=T)
slope.last.uci<-quantile(r.last[,2],c(uci),na.rm=T)
r.last.recent<-matrix(NA,dim(lastlp)[1],2)
for (o in 1:(dim(lastlp)[1])) {
# if(!is.na(sum(lpmax[o,]))) {
y<-lastlp[o,25:40]
y[y=="Inf"]<-NA
lm(y~as.numeric(colnames(lastlp)[25:40]))$coefficients->r.last.recent[o,]
#}
}
slopevec.last.recent<-as.vector(r.last.recent[,2])
intercept.last.recent<-mean(r.last.recent[,1],na.rm=T)
slope.last.recent<-mean(r.last.recent[,2],na.rm=T)
intercept.last.recent.lci<-quantile(r.last.recent[,1],c(lci),na.rm=T)
intercept.last.recent.uci<-quantile(r.last.recent[,1],c(uci),na.rm=T)
slope.last.recent.lci<-quantile(r.last.recent[,2],c(lci),na.rm=T)
slope.last.recent.uci<-quantile(r.last.recent[,2],c(uci),na.rm=T)
### Write results (in console if argument file is not specified in function cat)
if(season=="1"){
cat(paste("summary results",pod,region,season),"\n",
paste("annual change of activity peak:", round(mean(slopevec,na.rm=T),digits=2),"days"),
paste("confidence interval from", round(quantile(slopevec,lci,na.rm=T),digits=2),
"to",round(quantile(slopevec,uci,na.rm=T),digits=2)),
"\n","mean estimate of activity peak","as date",
as.character(as.Date(x=c(ann.res[,colnames(ann.res)=="mean"]),origin=c(paste(row.names(ann.res),"-01-01",sep="")))),"\n",
sep="\n","as day of year",
paste(rownames(ann.res),round(ann.res[,"mean"])))
cat(paste("summary results",pod,region,season),"\n",
paste("annual change of first activity doy:", round(mean(slopevec.first,na.rm=T),digits=2),"days"),
paste("confidence interval from", round(quantile(slopevec.first,lci,na.rm=T),digits=2),
"to",round(quantile(slopevec.first,uci,na.rm=T),digits=2)),
"\n","mean estimate of first activity doy","as date",
as.character(as.Date(x=c(ann.first[,colnames(ann.first)=="mean"]),origin=c(paste(row.names(ann.first),"-01-01",sep="")))),"\n",
sep="\n","as day of year",
paste(rownames(ann.first),round(ann.first[,"mean"])))
cat(paste("summary results",pod,region,season),"\n",
paste("annual change of last activity doy:", round(mean(slopevec.last,na.rm=T),digits=2),"days"),
paste("confidence interval from", round(quantile(slopevec.last,lci,na.rm=T),digits=2),
"to",round(quantile(slopevec.last,uci,na.rm=T),digits=2)),
"\n","mean estimate of last activity doy","as date",
as.character(as.Date(x=c(ann.res[,colnames(ann.res)=="mean"]),origin=c(paste(row.names(ann.res),"-01-01",sep="")))),"\n",
paste(rownames(ann.last),round(ann.last[,"mean"])))
}
if(season=="2"){
cat(paste("summary results",pod,region,season),"\n",
paste("annual change of peak occurrence prob:", round(mean(slopevec,na.rm=T),digits=2),"days"),
paste("confidence interval from", round(quantile(slopevec,lci,na.rm=T),digits=2),
"to",round(quantile(slopevec,uci,na.rm=T),digits=2)),
"\n","mean estimate of activity peak","as date",
as.character(as.Date(x=c(ann.res[,colnames(ann.res)=="mean"]),origin=c(paste(row.names(ann.res),"-01-01",sep="")))),"\n",
sep="\n","as day of year",
paste(rownames(ann.res),round(ann.res[,"mean"])))
}
#save a dataframe of trends in all three phenophases
df<-rbind(
c(pod,region,season,"peak",round(mean(slopevec,na.rm=T),digits=2),round(quantile(slopevec,lci,na.rm=T),digits=2),round(quantile(slopevec,uci,na.rm=T),digits=2)),
c(pod,region,season,"first",round(mean(slopevec.first,na.rm=T),digits=2),round(quantile(slopevec.first,lci,na.rm=T),digits=2),round(quantile(slopevec.first,uci,na.rm=T),digits=2)),
c(pod,region,season,"last",round(mean(slopevec.last,na.rm=T),digits=2),round(quantile(slopevec.last,lci,na.rm=T),digits=2),round(quantile(slopevec.last,uci,na.rm=T),digits=2)),
c(pod,region,season,"peak.20022016",round(mean(slopevec.recent,na.rm=T),digits=2),round(quantile(slopevec.recent,lci,na.rm=T),digits=2),round(quantile(slopevec.recent,uci,na.rm=T),digits=2)),
c(pod,region,season,"first.20022016",round(mean(slopevec.first.recent,na.rm=T),digits=2),round(quantile(slopevec.first.recent,lci,na.rm=T),digits=2),round(quantile(slopevec.first.recent,uci,na.rm=T),digits=2)),
c(pod,region,season,"last.20022016",round(mean(slopevec.last.recent,na.rm=T),digits=2),round(quantile(slopevec.last.recent,lci,na.rm=T),digits=2),round(quantile(slopevec.last.recent,uci,na.rm=T),digits=2))
)
colnames(df)<-c("pod","region","season","phase","slope.mn","slope.lci","slope.uci")
if(assumeSRKW==TRUE){df.name<-paste("analyses/output/",pod,"_",season,region,"_","doy",min(dat$day),"-",max(dat$day),min(dat$year),"-",max(dat$year),"occprob_wrecent_assumeSRKW.csv", sep="")}
if(assumeSRKW==FALSE){df.name<-paste("analyses/output/",pod,"_",season,region,"_","doy",min(dat$day),"-",max(dat$day),min(dat$year),"-",max(dat$year),"occprob_wrecent_assumeSRKW.csv", sep="")}
write.csv(df,df.name, row.names=FALSE)
#save years and first-last-peak estimates
phen<-cbind(pod,region,season,rownames(ann.res),round(ann.res[,"mean"]),round(ann.res[,"lci"]),round(ann.res[,"uci"]),
round(ann.first[,"mean"]),round(ann.first[,"lci"]),round(ann.first[,"uci"]),
round(ann.last[,"mean"]),round(ann.last[,"lci"]),round(ann.last[,"uci"]),round(meanpsi, digits=2))
colnames(phen)<-c("pod","region","season","year","peak.psi","peak.lcl","peak.ucl","first.psi","first.lcl","first.ucl","last.psi","last.lcl","last.ucl", "mean.psi")
if(assumeSRKW==TRUE){phen.name<-paste("analyses/output/",pod,"_",season,region,"_doy",min(dat$day),"-",max(dat$day),"_",min(dat$year),"-",max(dat$year),"assumeSRKWoccprobdoy.csv", sep="")}
if(assumeSRKW==FALSE){phen.name<-paste("analyses/output/",pod,"_",season,region,"_doy",min(dat$day),"-",max(dat$day),"_",min(dat$year),"-",max(dat$year),"occprobdoy.csv", sep="")}
write.csv(phen,phen.name, row.names=FALSE)
#-----------------------------------------------------------------
# Plot output
#-----------------------------------------------------------------
if(region == "uss"){color = "darkblue"}
if(region == "ps"){color = "salmon"}
# save plotted results as pdf
if(assumeSRKW==TRUE){pdf(file=paste("analyses/figures/",pod,"/orcaphen_",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_",prob,"assumeSRKWpeakoccprob.pdf", sep=""),width=7,height=7)}
if(assumeSRKW==FALSE){pdf(file=paste("analyses/figures/",pod,"/orcaphen_",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_",prob,"peakoccprob.pdf", sep=""),width=7,height=7)}
### plot estimates of peak detectability over all years
#quartz(width=7, height=6)
par(mfrow=c(1,1),mai=c(1,1,1,0.5))
x=rownames(ann.res)
y=ann.res[,"mean"]
seasname<-c("winter","summer")
plot(x,y,xlab="",ylab="",axes=F,main=paste("Date of Peak Occurence Probability","\n",pod," Pod",seasname[as.numeric(season)],region),
ylim=range(dat$day),pch=16,type="l", lwd=1.5,col=color)
polygon(c(rev(x),x),c(rev(ann.res[,"uci"]),ann.res[,"lci"]),col=alpha(color,0.2),lty=0)
axis(side=1,at=x)
if(season==2){
axis(side=2,at=c(92,122,152,183,214,244,274,303),
labels=c("1Apr","1May","1Jun","1Jul","1Aug","1Sept","1Oct","1Nov"))
}
if(season==1){
axis(side=2,at=c(182,213,244,274,305,335,366),
labels=c("1Jul","1Aug","1Sept","1Oct","1Nov","1Dec","1Jan"))}
if(season ==3){
axis(side=2,at=c(1,92,183,274,365),
labels=c("1Jan","1Apr","1Jul","1Oct","31Dec"))
}
#for (o in 1:500) {
#if(!is.na(sum(lpmax[o,]))) {
#  mod<-lm(lpmax[o,]~as.numeric(colnames(lpmax)))$coefficients->r[o,]
#  abline(mod,col=alpha("salmon",0.2),lwd=2)
#}
#}
#clip(2008,2017, min(y), max(y))
if(season==1){abline(a=intercept,b=slope,col="darkred",lwd=2)}
if(season==2){abline(a=intercept,b=slope,col="midnightblue",lwd=2)}
dev.off()
#plot only recent years
# save plotted results as pdf
if(assumeSRKW==TRUE){pdf(file=paste("analyses/figures/",pod,"/orcaphen_","2002-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_",prob,"assumeSRKWpeakoccprob.pdf", sep=""),width=7,height=7)}
if(assumeSRKW==FALSE){pdf(file=paste("analyses/figures/",pod,"/orcaphen_","2002-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_",prob,"peakoccprob.pdf", sep=""),width=7,height=7)}
### plot estimates of peak occurence over only recent years
#quartz(width=7, height=6)
par(mfrow=c(1,1),mai=c(1,1,1,0.5))
x=rownames(ann.res)[25:length(rownames(ann.res))]
y=ann.res[,"mean"][25:length(rownames(ann.res))]
seasname<-c("winter","summer")
plot(x,y,xlab="",ylab="",axes=F,main=paste("Date of Peak Occurence Probability","\n",pod," Pod",seasname[as.numeric(season)],region),
ylim=range(dat$day),pch=16,type="l", lwd=1.5,col=color)
polygon(c(rev(x),x),c(rev(ann.res[,"uci"][25:length(rownames(ann.res))]),ann.res[,"lci"][25:length(rownames(ann.res))]),col=alpha(color,0.2),lty=0)
axis(side=1,at=x)
if(season==2){
axis(side=2,at=c(92,122,152,183,214,244,274,303),
labels=c("1Apr","1May","1Jun","1Jul","1Aug","1Sept","1Oct","1Nov"))
}
if(season==1){
axis(side=2,at=c(182,213,244,274,305,335,366),
labels=c("1Jul","1Aug","1Sept","1Oct","1Nov","1Dec","1Jan"))}
if(season ==3){
axis(side=2,at=c(1,92,183,274,365),
labels=c("1Jan","1Apr","1Jul","1Oct","31Dec"))
}
#for (o in 1:500) {
#if(!is.na(sum(lpmax[o,]))) {
#  mod<-lm(lpmax[o,]~as.numeric(colnames(lpmax)))$coefficients->r[o,]
#  abline(mod,col=alpha("salmon",0.2),lwd=2)
#}
#}
#clip(2008,2017, min(y), max(y))
if(season==1){abline(a=intercept.recent,b=slope.recent,col="darkred",lwd=2)}
if(season==2){abline(a=intercept.recent,b=slope.recent,col="midnightblue",lwd=2)}
dev.off()
#-----------------------------------------------------------------
# Plot first date detectability > selected prob
#-----------------------------------------------------------------
# save plotted results as pdf
if(assumeSRKW==TRUE){pdf(file=paste("analyses/figures/",pod,"/orcaphen",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_first_",prob,"assumeSRKWoccprob.pdf", sep=""),width=7,height=7)}
if(assumeSRKW==FALSE){pdf(file=paste("analyses/figures/",pod,"/orcaphen",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_first_",prob,"occprob.pdf", sep=""),width=7,height=7)}
### plot estimates of first det.prob > XX over all years
#quartz(width=7, height=6)
par(mfrow=c(1,1),mai=c(1,1,1,0.5))
x=rownames(ann.first)
y=ann.first[,"mean"]
seasname<-c("winter","summer")
plot(x,y,xlab="",ylab="",axes=F,main=paste("First Detection Probability >",prob,"\n",pod," Pod",seasname[as.numeric(season)],region),
ylim=range(dat$day),pch=16,type="l", lwd=1.5,col=color)
polygon(c(rev(x),x),c(rev(ann.first[,"uci"]),ann.first[,"lci"]),col=alpha(color,0.2),lty=0)
axis(side=1,at=x)
if(season==2){
axis(side=2,at=c(92,122,152,183,214,244,274,303),
labels=c("1Apr","1May","1Jun","1Jul","1Aug","1Sept","1Oct","1Nov"))
}
if(season==1){
axis(side=2,at=c(182,213,244,274,305,335,366),
labels=c("1Jul","1Aug","1Sept","1Oct","1Nov","1Dec","1Jan"))
}
if(season==3){
axis(side=2,at=c(1,92,183,274,365),
labels=c("1Jan","1Apr","1Jul","1Oct","31Dec"))
}
#for (o in 1:500) {
#  #if(!is.na(sum(lpmax[o,]))) {
#  mod.first<-lm(firstlp[o,]~as.numeric(colnames(firstlp)))$coefficients->r.first[o,]
#  abline(mod.first,col=alpha("grey",0.2),lwd=2)
#}
#}
if(season==1){abline(a=intercept.first,b=slope.first,col="darkred",lwd=2)}
if(season==2){abline(a=intercept.first,b=slope.first,col="midnightblue",lwd=2)}
dev.off()
# save plotted results as pdf
if(assumeSRKW==TRUE){pdf(file=paste("analyses/figures/",pod,"/orcaphen",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"last_",prob,"assumeSRKWoccprob.pdf", sep=""),width=7,height=7)}
if(assumeSRKW==FALSE){pdf(file=paste("analyses/figures/",pod,"/orcaphen",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"last_",prob,"occprob.pdf", sep=""),width=7,height=7)}
### plot estimates of last detectability > selected prob over all years
#quartz(width=7, height=6)
par(mfrow=c(1,1),mai=c(1,1,1,0.5))
x=rownames(ann.last)
y=ann.last[,"mean"]
seasname<-c("winter","summer")
plot(x,y,xlab="",ylab="",axes=F,main=paste("Last Occurence Probability >",prob,"\n",pod," Pod",seasname[as.numeric(season)],region),
ylim=range(dat$day),pch=16,type="l", lwd=1.5,col=color)
polygon(c(rev(x),x),c(rev(ann.last[,"uci"]),ann.last[,"lci"]),col=alpha(color,0.2),lty=0)
axis(side=1,at=x)
if(season==2){
axis(side=2,at=c(92,122,152,183,214,244,274,303),
labels=c("1Apr","1May","1Jun","1Jul","1Aug","1Sept","1Oct","1Nov"))
}
if(season==1){
axis(side=2,at=c(182,213,244,274,305,335,366),
labels=c("1Jul","1Aug","1Sept","1Oct","1Nov","1Dec","1Jan"))
}
if(season==3){
axis(side=2,at=c(1,92,183,274,365),
labels=c("1Jan","1Apr","1Jul","1Oct","31Dec"))
}
#for (o in 1:500) {
#  #if(!is.na(sum(lpmax[o,]))) {
#  mod.last<-lm(lastlp[o,]~as.numeric(colnames(lastlp)))$coefficients->r.last[o,]
#  abline(mod.last,col=alpha("grey",0.2),lwd=2)
#
#}
#}
if(season ==1){abline(a=intercept.last,b=slope.last,col="darkred",lwd=2)}
if(season ==2){abline(a=intercept.last,b=slope.last,col="midnightblue",lwd=2)}
dev.off()
### Plot annual detectability pattern
# loop over all years
years<-sort(unique(as.numeric((dat$year))))
seasonname<-c("winter","summer","wholeyear")
for (xj in 1:length(years)) {
j<-years[xj]
# Get BUGS estimates
res.chains<-out$sims.array[,,paste("lp[",xj[1],",",1:(max(dat$day)-min(dat$day)+1),"]",sep="")]
res=plogis(apply(res.chains,MARGIN=c(length(dim(res.chains))),quantile,probs=c(.10,.5,.90)))
### Plot "naive" estimate of occurence
# prepare bars to compare barplot of observation data (bars) with estimates (line); barheight represents weekly proportion of detection events divided by all surveys
barwidth<-7
z<-1
for(m in seq(from=min(dat$day),to=max(dat$day),by=barwidth)) {
dat$barpos[dat$day >= m & dat$day < m+barwidth]<-z
z<-z+1
}
barheight<-rep(NA,times=max(dat$day)+7)
names(barheight)<-1:max(dat$day)
# height of the bars equals to a seven day successful obs to all obs ratio
n<-(max(dat$day)-min(dat$day)+1)
res.height<-tapply(dat$ndet[dat$year==j],dat$barpos[dat$year==j],sum)/tapply(dat$nrep[dat$year==j],dat$barpos[dat$year==j],sum)
barheight[as.numeric(names(res.height))*7-3+min(dat$day)]<-res.height
# plot bars
#for seasonal values...
figpath<- paste("analyses/figures/",pod,sep="")
if(assumeSRKW==TRUE){figname<-paste("orcaphen",j,region,seasonname[as.numeric(season)],"doy",min(dat$day),"-",max(dat$day),"_",pod,"assumeSRKW.pdf",sep="_")}
if(assumeSRKW==FALSE){figname<-paste("orcaphen",j,region,seasonname[as.numeric(season)],"doy",min(dat$day),"-",max(dat$day),"_",pod,".pdf",sep="_")}
pdf(file.path(figpath, figname), width = 9, height = 6)
#quartz()
x<-barplot(as.numeric(barheight[min(dat$day):max(dat$day)]),
width=1,space=0,ylim=c(0,1),xlab="", ylab="Occurence Probability",
main=paste(pod," pod",j),border=NA,axes=F)#ylim:max(res[3,])
### Plot model estimates
# plot seasonal estimates of detectability p
lines(res[3,],lty=3,col=1,lwd=2.5) # lower bound of the 90% CI
lines(res[2,],lty=1,col=1,lwd=2) # median
lines(res[1,],lty=3,col=1,lwd=2.5) # upper bound of the 90% CI
axis(2)
if(season==1){
axis(side=1,at=c(183-183,213-183,244-183,274-183,305-183,335-183,366-183),
labels=c("1Jul","1Aug","1Sept","1Oct","1Nov","1Dec","1Jan"))
}
if(season==2){
axis(side=1,at=c(92-92,122-92,152-92,183-92,214-92,244-92,274-92,303-92),
labels=c("1Apr","1May","1Jun","1Jul","1Aug","1Sept","1Oct","1Nov"))
}
if(season==3){
axis(side=1,at=c(1,92,183,274,365),
labels=c("1Jan","1Apr","1Jul","1Oct","31Dec"))
}
dev.off()
}
#setwd("/Users/aileneettinger/Documents/GitHub/fishphen")
#Read in summaries of rates of change from orca occupancy model
l2<-read.csv("analyses/output/L_2uss_doy92-3031978-2017occprob_wrecent_assumeSRKW.csv")
l1<-read.csv("analyses/output/L_1ps_doy183-3661978-2017occprob_wrecent_assumeSRKW.csv")
k2<-read.csv("analyses/output/K_2uss_doy92-3031978-2017occprob_wrecent_assumeSRKW.csv")
k1<-read.csv("analyses/output/K_1ps_doy183-3661978-2017occprob_wrecent_assumeSRKW.csv")
j2<-read.csv("analyses/output/J_2uss_doy92-3031978-2017occprob_wrecent_assumeSRKW.csv")
j1<-read.csv("analyses/output/J_1ps_doy183-3661978-2017occprob_wrecent_assumeSRKW.csv")
all2<-rbind(j2,k2,l2)
all1<-rbind(j1,k1,l1)
all2<-all2[order(all2$pod),]
#read in salmon data
wildshifts<-read.csv("analyses/output/salmonreturntrends_wild.csv",header=TRUE)
hatchshifts<-read.csv( "analyses/output/salmonreturntrends_hatch.csv",header=TRUE)
#hatchshifts<-hatchshifts[hatchshifts$type=="hatch",]
albion<-read.csv("analyses/output/albionreturntrends.csv",header=TRUE)
colnames(albion)<-c("name","value")
albionshifts<-as.data.frame(t(as.numeric(albion[4:28,2])))
colnames(albionshifts)<-albion[4:28,1]
# save plotted results as pdf
pdf(file="analyses/figures/srkw_salmon_shifts_lm.pdf",width=16,height=6)
### plot estimates of peak occurrence prob over all years
#quartz(width=16, height=6)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,1),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,3), bty="l")
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first"],x,all2$slope.uci[all2$phase=="first"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak"],x+1,all2$slope.uci[all2$phase=="peak"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last"],x+2,all2$slope.uci[all2$phase=="last"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first"],pch=c(21,22,24),bg="darkblue")
points(x+1,all2$slope.mn[all2$phase=="peak"],pch=c(21,22,24),bg="darkblue")
points(x+2,all2$slope.mn[all2$phase=="last"],pch=c(21,22,24),bg="darkblue")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
mtext("SRKWs 1978-2017",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
#Puget sound proper
plot(x,all1$slope.mn[all1$phase=="first"],pch=c(21,22,24),bg="salmon", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,all1$slope.lci[all1$phase=="first"],x,all1$slope.uci[all1$phase=="first"], code=3, length=0)
arrows(x+1,all1$slope.lci[all1$phase=="peak"],x+1,all1$slope.uci[all1$phase=="peak"], code=3, length=0)
arrows(x+2,all1$slope.lci[all1$phase=="last"],x+2,all1$slope.uci[all1$phase=="last"], code=3, length=0)
points(x,all1$slope.mn[all1$phase=="first"],pch=c(21,22,24),bg="salmon")
points(x+1,all1$slope.mn[all1$phase=="peak"],pch=c(21,22,24),bg="salmon")
points(x+2,all1$slope.mn[all1$phase=="last"],pch=c(21,22,24),bg="salmon")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
#add shifts in most recent (1990-2016)
pdf(file="analyses/figures/srkw_salmon_recentshifts_lm.pdf",width=16,height=6)
### plot estimates of peak occurrence prob over all years
#quartz(width=16, height=6)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,1),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first.20022016"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,3), bty="l")
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first.20022016"],x,all2$slope.uci[all2$phase=="first.20022016"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak.20022016"],x+1,all2$slope.uci[all2$phase=="peak.20022016"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last.20022016"],x+2,all2$slope.uci[all2$phase=="last.20022016"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first.20022016"],pch=c(21,22,24),bg="darkblue")
points(x+1,all2$slope.mn[all2$phase=="peak.20022016"],pch=c(21,22,24),bg="darkblue")
points(x+2,all2$slope.mn[all2$phase=="last.20022016"],pch=c(21,22,24),bg="darkblue")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
mtext("SRKWs 1990-2016",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
#Puget sound proper
plot(x,all1$slope.mn[all1$phase=="first.20022016"],pch=c(21,22,24),bg="salmon", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,all1$slope.lci[all1$phase=="first.20022016"],x,all1$slope.uci[all1$phase=="first.20022016"], code=3, length=0)
arrows(x+1,all1$slope.lci[all1$phase=="peak.20022016"],x+1,all1$slope.uci[all1$phase=="peak.20022016"], code=3, length=0)
arrows(x+2,all1$slope.lci[all1$phase=="last.20022016"],x+2,all1$slope.uci[all1$phase=="last.20022016"], code=3, length=0)
points(x,all1$slope.mn[all1$phase=="first.20022016"],pch=c(21,22,24),bg="salmon")
points(x+1,all1$slope.mn[all1$phase=="peak.20022016"],pch=c(21,22,24),bg="salmon")
points(x+2,all1$slope.mn[all1$phase=="last.20022016"],pch=c(21,22,24),bg="salmon")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
##Add salmon
pdf(file="analyses/figures/salmon_shifts_lm.pdf",width=16,height=6)
par(mfcol=c(2,2),mai=c(.5,1,.5,0.5))
#Central salish sea = albion test fishery from fraser
x<-c(1,2,3,4)
y<-c(albionshifts$first.yr,albionshifts$pk.yr,albionshifts$mid.yr,albionshifts$last.yr)
ylci<-c(albionshifts$first.yrlci,albionshifts$pk.yrlci,albionshifts$mid.yrlci,albionshifts$last.yrlci)
yuci<-c(albionshifts$first.yruci,albionshifts$pk.yruci,albionshifts$mid.yruci,albionshifts$last.yruci)
plot(x,y,pch=23,bg="blue4",ylab= "",xaxt="n", xlab="",xlim=c(0,5), bty="l", cex=log(albionshifts$mn.total)/6)
abline(h=0,lty=2)
mtext("wild salmon",side=3,line=0)
arrows(x,ylci,x,yuci, code=3, length=0,col="blue2")
points(x,y,cex=log(albionshifts$mn.total)/6,bg="blue1",pch=23)
legend("topleft",legend=c("Chum","Chinook","Coho"),pch=c(21,23,25), bty="n",pt.bg="darkblue")
#Hachery shifts
#Puget sound proper
dd<-wildshifts
x<-rep(1,times=6)
shapes<-c(21,23,25)
cols<-c("lightgray","lightsalmon","salmon2","salmon4","darksalmon")
plot(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)], ylab= "",xaxt="n", xlab="",xlim=c(0,5),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,dd$first.yrlci,x,dd$first.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+1,dd$pk.yrlci,x+1,dd$pk.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+2,dd$mid.yrlci,x+2,dd$mid.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+3,dd$last.yrlci,x+3,dd$last.yruci, code=3, length=0,col=cols[factor(dd$site)])
points(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+1,dd$pk.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+2,dd$mid.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+3,dd$last.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
axis(side=1,labels=c("First","Peak","Med","Last"), at = c(1,2,3,4))
#Central salish sea first...
cols<-c("skyblue")
dd<-hatchshifts[hatchshifts$site=="WHATCOM CR HATCHERY",]#only one hatchery site in central salish sea, i think
x<-1
plot(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)], ylab= "",xaxt="n", xlab="",xlim=c(0,5),ylim=c(-3,3), bty="l")
abline(h=0,lty=2)
arrows(x,dd$first.yrlci,x,dd$first.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+1,dd$pk.yrlci,x+1,dd$pk.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+2,dd$mid.yrlci,x+2,dd$mid.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+3,dd$last.yrlci,x+3,dd$last.yruci, code=3, length=0,col=cols[factor(dd$site)])
points(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+1,dd$pk.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+2,dd$mid.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+3,dd$last.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
axis(side=1,labels=c("First","Peak","Med","Last"), at = c(1,2,3,4))
mtext("hatchery salmon",side=3,line=0)
#Hachery shifts
#Puget sound proper
dd<-hatchshifts[hatchshifts$site!="WHATCOM CR HATCHERY",]#only one hatchery site in central salish sea, i think
cols<-c("lightgray","lightsalmon","salmon2","salmon4","darksalmon","darkred")
x<-rep(1, times=length(dd$first.yr))
plot(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)], ylab= "",xaxt="n", xlab="",xlim=c(0,5),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,dd$first.yrlci,x,dd$first.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+1,dd$pk.yrlci,x+1,dd$pk.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+2,dd$mid.yrlci,x+2,dd$mid.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+3,dd$last.yrlci,x+3,dd$last.yruci, code=3, length=0,col=cols[factor(dd$site)])
points(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+1,dd$pk.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+2,dd$mid.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+3,dd$last.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
axis(side=1,labels=c("First","Peak","Med","Last"), at = c(1,2,3,4))
dev.off()
pdf(file="analyses/figures/srkw_salmon_recentshifts_lm.pdf",width=16,height=6)
### plot estimates of peak occurrence prob over all years
#quartz(width=16, height=6)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,1),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first.20022016"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,6), bty="l")
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first.20022016"],x,all2$slope.uci[all2$phase=="first.20022016"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak.20022016"],x+1,all2$slope.uci[all2$phase=="peak.20022016"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last.20022016"],x+2,all2$slope.uci[all2$phase=="last.20022016"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first.20022016"],pch=c(21,22,24),bg="darkblue")
points(x+1,all2$slope.mn[all2$phase=="peak.20022016"],pch=c(21,22,24),bg="darkblue")
points(x+2,all2$slope.mn[all2$phase=="last.20022016"],pch=c(21,22,24),bg="darkblue")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
mtext("SRKWs 1990-2016",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
#Puget sound proper
plot(x,all1$slope.mn[all1$phase=="first.20022016"],pch=c(21,22,24),bg="salmon", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,all1$slope.lci[all1$phase=="first.20022016"],x,all1$slope.uci[all1$phase=="first.20022016"], code=3, length=0)
arrows(x+1,all1$slope.lci[all1$phase=="peak.20022016"],x+1,all1$slope.uci[all1$phase=="peak.20022016"], code=3, length=0)
arrows(x+2,all1$slope.lci[all1$phase=="last.20022016"],x+2,all1$slope.uci[all1$phase=="last.20022016"], code=3, length=0)
points(x,all1$slope.mn[all1$phase=="first.20022016"],pch=c(21,22,24),bg="salmon")
points(x+1,all1$slope.mn[all1$phase=="peak.20022016"],pch=c(21,22,24),bg="salmon")
points(x+2,all1$slope.mn[all1$phase=="last.20022016"],pch=c(21,22,24),bg="salmon")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
