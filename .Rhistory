knots<-quantile(unique(covariate),seq(0,1,length=(nknots+2))[-c(1,(nknots+2))])
#Note: the maximum number of knots is 35. thus, the annual model (for which nk=92 in many cases, but it is restricted to 35 by default) differs in flexibility than the seasonal model
#perhaps better to extract the seasonal peaks after fitting the whole year of data
# fixed effects matrix
X<-NULL
for (l in 0:degree) {
X<-cbind(X,covariate^l)
}
# random coefficients matrix
Z_K<-(abs(outer(covariate,knots,"-")))^3
OMEGA_all<-(abs(outer(knots,knots,"-")))^3
svd.OMEGA_all<-svd(OMEGA_all)
sqrt.OMEGA_all<-t(svd.OMEGA_all$v %*% (t(svd.OMEGA_all$u)*sqrt(svd.OMEGA_all$d)))
Z<-t(solve(sqrt.OMEGA_all,t(Z_K)))
# Input data
dat$site <- factor(dat$site)#
dat$site <- droplevels(dat$site)
dat$site <- as.integer(dat$site)
site <- dat$site
survey <- dat$day-min(dat$day)+1
nsurveys<-length(survey)
nobs <- length(unique(paste(dat$site,dat$day,dat$year)))
nrep <- dat$nrep
nsite <- length(unique(dat$site))
nyear <- length(unique(dat$year))
year <- as.numeric(factor(dat$year))
zst <- array(1, dim=c(nyear,n))
y <- dat$ndet
# Simulation parameters
#ni=15000; nc=2; nb=0; nt=10
ni=7000; nc=2; nb=2500; nt=1
# List input data
jags.data <- list("site","survey","nobs","nrep","nsite","nyear","year","nknots","n","X","Z","nc", "nb", "ni", "nt","zst","y")
# Inits function
f.inits <- function(){list(a=rep(0,nyear), b=rep(0,nyear), c=rep(0,nyear), z=zst)}
# specify the parameters to be monitored
parameters <- c("a","b","c","lp","psi","taub","p")
### Run MCMC Analysis using jags
jags.out<-jags.parallel(jags.data,f.inits,parameters,"analyses/splinesSiteOccS4psi.txt",nc,ni,nb,nt)
#names(jags.out$BUGSoutput)
#diagnose the model
#quartz()
#plot(jags.out)
if(region == "uss"){color = "darkblue"
cols = c("lightblue1","lightblue2","lightblue3","lightblue4")}
if(region == "ps"){color = "salmon"
cols = c("lightsalmon","lightsalmon2","lightsalmon4","salmon")}
prob<-0.5
findmax.fn<-function(x) {
mean(which(x==max(x)))
}
lpmax<-array(data=NA,dim=c(out$n.sims,nyear))
dimnames(lpmax)<-list(c(1:out$n.sims),c(sort(unique(dat$year))))
for (xj in sort(unique(as.numeric(factor(dat$year))))) {
lpmax[,xj]<-apply(out$sims.array[,,paste("lp[",xj[1],",",1:(max(dat$day)-min(dat$day)+1),"]",sep="")],MARGIN=c(if(out$n.chains>1) 1:2 else 1),findmax.fn)
}
lpmax<-lpmax+min(dat$day)-1
lpmax[lpmax==max(dat$day)]<-NA
lpmax[lpmax==min(dat$day)]<-NA
#would like to Extract and plot psi (probability of presence by day...)
dim(out$sims.list$psi)
doy<-seq(from=min(dat$day),to=max(dat$day),by=1)
#Plot by decade to see changes in psi over time
quartz(height=6,width=12)
par(mfrow=c(1,4))
plot(doy,out$mean$psi[1,], type= "l", ylim=c(0,1))
for(y in 2:10){
lines(doy,out$mean$psi[y,])
}
plot(doy,out$mean$psi[11,], type= "l", ylim=c(0,1))
for(y in 12:20){
lines(doy,out$mean$psi[y,])
}
plot(doy,out$mean$psi[21,], type= "l", ylim=c(0,1))
for(y in 22:30){
lines(doy,out$mean$psi[y,])
}
plot(doy,out$mean$psi[31,], type= "l", ylim=c(0,1))
for(y in 32:40){
lines(doy,out$mean$psi[y,])
}
length(unique(dat$day))
#plot mean psi across all years for the season
pdf(file=paste("analyses/figures/",pod,"/orcaphen_",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_",pod,"_",prob,"meanoccprob.pdf", sep=""),height=6,width=8)
#par(mfrow=c(1,4))
plot(doy,colMeans(out$mean$psi[1:10,]), type= "l", ylim=c(0,1), ylab= "Probability of occurrence", xlab= "Day of Year", bty="l", col=cols[1])
lines(doy,colMeans(out$mean$psi[11:20,]),col=cols[2])
lines(doy,colMeans(out$mean$psi[21:30,]),col=cols[3])
lines(doy,colMeans(out$mean$psi[31:40,]),col=cols[4], lwd=2)
lines(doy,colMeans(out$mean$psi),col=color,lwd=3)
legend("bottomleft",legend=c(paste(unique(dat$year)[1],"-",unique(dat$year)[10],sep= ""),
paste(unique(dat$year)[11],"-",unique(dat$year)[20],sep= ""),
paste(unique(dat$year)[21],"-",unique(dat$year)[30],sep= ""),
paste(unique(dat$year)[31],"-",unique(dat$year)[40],sep= ""),
paste(unique(dat$year)[1],"-",unique(dat$year)[40],sep= "")),lwd=c(1,1,1,2,3),lty=1,col=c(cols,color), bty="n")
dev.off()
# summarize estimates and look at change across the whole time series
ann.res<-array(NA, dim=c(max(dat$year)-min(dat$year)+1,3),dimnames=list(c(min(dat$year):max(dat$year)),c("mean","lci","uci")))
res<-apply(lpmax,c(2),mean,na.rm=T)
ann.res[names(res),"mean"]<-res
res<-apply(lpmax,c(2),quantile,probs=lci,na.rm=T)
ann.res[names(res),"lci"]<-res
res<-apply(lpmax,c(2),quantile,probs=uci,na.rm=T)
ann.res[names(res),"uci"]<-res
# look at change
# get estimate of trend in date of peak detectability over years
do.lm<-function(x) {
lmres<-lm(x~as.numeric(names(x)))$coefficients
return(lmres)
}
r<-matrix(NA,dim(lpmax)[1],2)
#just do lm from 1978-2017
for (o in 1:(dim(lpmax)[1])) {
# if(!is.na(sum(lpmax[o,]))) {
lm(lpmax[o,]~as.numeric(colnames(lpmax)))$coefficients->r[o,]
#}
}
slopevec<-as.vector(r[,2])
intercept<-mean(r[,1],na.rm=T)
slope<-mean(r[,2],na.rm=T)
intercept.lci<-quantile(r[,1],c(lci),na.rm=T)
intercept.uci<-quantile(r[,1],c(uci),na.rm=T)
slope.lci<-quantile(r[,2],c(lci),na.rm=T)
slope.uci<-quantile(r[,2],c(uci),na.rm=T)
#look just at recent trends
r.recent<-matrix(NA,dim(lpmax)[1],2)
for (o in 1:(dim(lpmax)[1])) {
y<-lpmax[o,23:39]
y[y=="Inf"]<-NA
lm(y~as.numeric(colnames(lpmax))[23:39])$coefficients->r.recent[o,]
}
slopevec.recent<-as.vector(r.recent[,2])
intercept.recent<-mean(r.recent[,1],na.rm=T)
slope.recent<-mean(r.recent[,2],na.rm=T)
intercept.recent.lci<-quantile(r.recent[,1],c(lci),na.rm=T)
intercept.recent.uci<-quantile(r.recent[,1],c(uci),na.rm=T)
slope.recent.lci<-quantile(r.recent[,2],c(lci),na.rm=T)
slope.recent.uci<-quantile(r.recent[,2],c(uci),na.rm=T)
#get first date when occurrenceis greater than some chosen probability
findfirst.fn<-function(x) {
min(which(plogis(x)>prob), na.rm=TRUE)
}
#check:
count.fn<-function(x) {
length(which(plogis(x)<prob))
}
firstlp<-array(data=NA,dim=c(out$n.sims,nyear))
dimnames(firstlp)<-list(c(1:out$n.sims),c(sort(unique(dat$year))))
for (xj in sort(unique(as.numeric(factor(dat$year))))) {
firstlp[,xj]<-apply(out$sims.array[,,paste("lp[",xj[1],",",1:(max(dat$day)-min(dat$day)+1),"]",sep="")],MARGIN=c(if(out$n.chains>1) 1:2 else 1),findfirst.fn)
}
firstlp<-firstlp+min(dat$day)-1
#firstlp[firstlp==max(dat$day)]<-NA
#firstlp[firstlp==min(dat$day)]<-NA
firstlp[which(firstlp=="Inf")]<-NA
#firstlp<-as.numeric(firstlp)
#countlp<-array(data=NA,dim=c(out$n.sims,nyear))
#dimnames(countlp)<-list(c(1:out$n.sims),c(sort(unique(dat$year))))
#for (xj in sort(unique(as.numeric(factor(dat$year))))) {
#  countlp[,xj]<-apply(out$sims.array[,,paste("lp[",xj[1],",",1:(max(dat$day)-min(dat$day)+1),"]",sep="")],MARGIN=c(if(out$n.chains>1) 1:2 else 1),count.fn)
#}
#returns "inf" when no estimates are >prob
# summarize estimates
ann.first<-array(NA, dim=c(max(dat$year)-min(dat$year)+1,3),dimnames=list(c(min(dat$year):max(dat$year)),c("mean","lci","uci")))
first<-apply(firstlp,c(2),mean,na.rm=T)
ann.first[names(first),"mean"]<-first
first<-apply(firstlp,c(2),quantile,probs=lci,na.rm=T)
ann.first[names(first),"lci"]<-first
first<-apply(firstlp,c(2),quantile,probs=uci,na.rm=T)
ann.first[names(first),"uci"]<-first
# get estimate of trend in date of peak detectability over years
#firstlp<-as.numeric()
r.first<-matrix(NA,dim(firstlp)[1],2)
for (o in 1:(dim(firstlp)[1])) {
# if(!is.na(sum(lpmax[o,]))) {
y<-firstlp[o,]
y[y=="Inf"]<-NA
lm(y~as.numeric(colnames(firstlp)))$coefficients->r.first[o,]
#}
}
slopevec.first<-as.vector(r.first[,2])
intercept.first<-mean(r.first[,1],na.rm=T)
slope.first<-mean(r.first[,2],na.rm=T)
intercept.first.lci<-quantile(r.first[,1],c(lci),na.rm=T)
intercept.first.uci<-quantile(r.first[,1],c(uci),na.rm=T)
slope.first.lci<-quantile(r.first[,2],c(lci),na.rm=T)
slope.first.uci<-quantile(r.first[,2],c(uci),na.rm=T)
#Look at trends just in recent data
r.first.recent<-matrix(NA,dim(firstlp)[1],2)
for (o in 1:(dim(firstlp)[1])) {
y<-firstlp[o,23:39]
y[y=="Inf"]<-NA
lm(y~as.numeric(colnames(firstlp))[23:39])$coefficients->r.first.recent[o,]
}
slopevec.first.recent<-as.vector(r.first.recent[,2])
intercept.first.recent<-mean(r.first.recent[,1],na.rm=T)
slope.first.recent<-mean(r.first.recent[,2],na.rm=T)
intercept.first.recent.lci<-quantile(r.first.recent[,1],c(lci),na.rm=T)
intercept.first.recent.uci<-quantile(r.first.recent[,1],c(uci),na.rm=T)
slope.first.recent.lci<-quantile(r.first.recent[,2],c(lci),na.rm=T)
slope.first.recent.uci<-quantile(r.first.recent[,2],c(uci),na.rm=T)
#get last date when detectability is greater than prob
findlast.fn<-function(x) {
max(which(plogis(x)>prob), na.rm=TRUE)
}
#check:
#count.fn<-function(x) {
#  length(which(plogis(x)<prob))
#}
lastlp<-array(data=NA,dim=c(out$n.sims,nyear))
dimnames(lastlp)<-list(c(1:out$n.sims),c(sort(unique(dat$year))))
for (xj in sort(unique(as.numeric(factor(dat$year))))) {
lastlp[,xj]<-apply(out$sims.array[,,paste("lp[",xj[1],",",1:(max(dat$day)-min(dat$day)+1),"]",sep="")],MARGIN=c(if(out$n.chains>1) 1:2 else 1),findlast.fn)
}
lastlp<-lastlp+min(dat$day)-1
#lastlp[lastlp==max(dat$day)]<-NA
#lastlp[lastlp==min(dat$day)]<-NA
#lastlp[which(lastlp=="Inf")]<-NA
lastlp[which(lastlp=="-Inf")]<-NA
#lastlp<-as.numeric(lastlp)
#countlp<-array(data=NA,dim=c(out$n.sims,nyear))
#dimnames(countlp)<-list(c(1:out$n.sims),c(sort(unique(dat$year))))
#for (xj in sort(unique(as.numeric(factor(dat$year))))) {
#  countlp[,xj]<-apply(out$sims.array[,,paste("lp[",xj[1],",",1:(max(dat$day)-min(dat$day)+1),"]",sep="")],MARGIN=c(if(out$n.chains>1) 1:2 else 1),count.fn)
#}
#returns "inf" when no estimates are >prob
# summarize estimates
ann.last<-array(NA, dim=c(max(dat$year)-min(dat$year)+1,3),dimnames=list(c(min(dat$year):max(dat$year)),c("mean","lci","uci")))
last<-apply(lastlp,c(2),mean,na.rm=T)
ann.last[names(last),"mean"]<-last
last<-apply(lastlp,c(2),quantile,probs=lci,na.rm=T)
ann.last[names(last),"lci"]<-last
last<-apply(lastlp,c(2),quantile,probs=uci,na.rm=T)
ann.last[names(last),"uci"]<-last
# get estimate of trend in date of peak detectability over years
#firstlp<-as.numeric()
r.last<-matrix(NA,dim(lastlp)[1],2)
for (o in 1:(dim(lastlp)[1])) {
# if(!is.na(sum(lpmax[o,]))) {
y<-lastlp[o,]
y[y=="Inf"]<-NA
lm(y~as.numeric(colnames(lastlp)))$coefficients->r.last[o,]
#}
}
slopevec.last<-as.vector(r.last[,2])
intercept.last<-mean(r.last[,1],na.rm=T)
slope.last<-mean(r.last[,2],na.rm=T)
intercept.last.lci<-quantile(r.last[,1],c(lci),na.rm=T)
intercept.last.uci<-quantile(r.last[,1],c(uci),na.rm=T)
slope.last.lci<-quantile(r.last[,2],c(lci),na.rm=T)
slope.last.uci<-quantile(r.last[,2],c(uci),na.rm=T)
r.last.recent<-matrix(NA,dim(lastlp)[1],2)
for (o in 1:(dim(lastlp)[1])) {
# if(!is.na(sum(lpmax[o,]))) {
y<-lastlp[o,]
y[y=="Inf"]<-NA
lm(y~as.numeric(colnames(lastlp)))$coefficients->r.last.recent[o,]
#}
}
slopevec.last.recent<-as.vector(r.last.recent[,2])
intercept.last.recent<-mean(r.last.recent[,1],na.rm=T)
slope.last.recent<-mean(r.last.recent[,2],na.rm=T)
intercept.last.recent.lci<-quantile(r.last.recent[,1],c(lci),na.rm=T)
intercept.last.recent.uci<-quantile(r.last.recent[,1],c(uci),na.rm=T)
slope.last.recent.lci<-quantile(r.last.recent[,2],c(lci),na.rm=T)
slope.last.recent.uci<-quantile(r.last.recent[,2],c(uci),na.rm=T)
### Write results (in console if argument file is not specified in function cat)
if(season=="1"){
cat(paste("summary results",pod,region,season),"\n",
paste("annual change of activity peak:", round(mean(slopevec,na.rm=T),digits=2),"days"),
paste("confidence interval from", round(quantile(slopevec,lci,na.rm=T),digits=2),
"to",round(quantile(slopevec,uci,na.rm=T),digits=2)),
"\n","mean estimate of activity peak","as date",
#as.character(as.Date(x=c(ann.res[,colnames(ann.res)=="mean"]),origin=c(paste(row.names(ann.res),"-03-31",sep="")))),"\n",
#sep="\n","as days after mar 31",
as.character(as.Date(x=c(ann.res[,colnames(ann.res)=="mean"]),origin=c(paste(row.names(ann.res),"-01-01",sep="")))),"\n",
sep="\n","as day of year",
paste(rownames(ann.res),round(ann.res[,"mean"])))
cat(paste("summary results",pod,region,season),"\n",
paste("annual change of first activity doy:", round(mean(slopevec.first,na.rm=T),digits=2),"days"),
paste("confidence interval from", round(quantile(slopevec.first,lci,na.rm=T),digits=2),
"to",round(quantile(slopevec.first,uci,na.rm=T),digits=2)),
"\n","mean estimate of first activity doy","as date",
as.character(as.Date(x=c(ann.first[,colnames(ann.first)=="mean"]),origin=c(paste(row.names(ann.first),"-01-01",sep="")))),"\n",
sep="\n","as day of year",
#as.character(as.Date(x=c(ann.first[,colnames(ann.first)=="mean"]),origin=c(paste(row.names(ann.first),"-03-31",sep="")))),"\n",
#sep="\n","as days after mar 31",
paste(rownames(ann.first),round(ann.first[,"mean"])))
cat(paste("summary results",pod,region,season),"\n",
paste("annual change of last activity doy:", round(mean(slopevec.last,na.rm=T),digits=2),"days"),
paste("confidence interval from", round(quantile(slopevec.last,lci,na.rm=T),digits=2),
"to",round(quantile(slopevec.last,uci,na.rm=T),digits=2)),
"\n","mean estimate of last activity doy","as date",
as.character(as.Date(x=c(ann.res[,colnames(ann.res)=="mean"]),origin=c(paste(row.names(ann.res),"-01-01",sep="")))),"\n",
sep="\n","as day of year",
#as.character(as.Date(x=c(ann.last[,colnames(ann.last)=="mean"]),origin=c(paste(row.names(ann.last),"-03-31",sep="")))),"\n",
#sep="\n","as days after mar 31",
paste(rownames(ann.last),round(ann.last[,"mean"])))
}
if(season=="2"){
cat(paste("summary results",pod,region,season),"\n",
paste("annual change of peak occurrence prob:", round(mean(slopevec,na.rm=T),digits=2),"days"),
paste("confidence interval from", round(quantile(slopevec,lci,na.rm=T),digits=2),
"to",round(quantile(slopevec,uci,na.rm=T),digits=2)),
"\n","mean estimate of activity peak","as date",
as.character(as.Date(x=c(ann.res[,colnames(ann.res)=="mean"]),origin=c(paste(row.names(ann.res),"-01-01",sep="")))),"\n",
sep="\n","as day of year",
paste(rownames(ann.res),round(ann.res[,"mean"])))
}
#save a dataframe of trends in all three phenophases
df<-rbind(
c(pod,region,season,"peak",round(mean(slopevec,na.rm=T),digits=2),round(quantile(slopevec,lci,na.rm=T),digits=2),round(quantile(slopevec,uci,na.rm=T),digits=2)),
c(pod,region,season,"first",round(mean(slopevec.first,na.rm=T),digits=2),round(quantile(slopevec.first,lci,na.rm=T),digits=2),round(quantile(slopevec.first,uci,na.rm=T),digits=2)),
c(pod,region,season,"last",round(mean(slopevec.last,na.rm=T),digits=2),round(quantile(slopevec.last,lci,na.rm=T),digits=2),round(quantile(slopevec.last,uci,na.rm=T),digits=2)),
c(pod,region,season,"peak.20002016",round(mean(slopevec.recent,na.rm=T),digits=2),round(quantile(slopevec.recent,lci,na.rm=T),digits=2),round(quantile(slopevec,uci,na.rm=T),digits=2)),
c(pod,region,season,"first.20002016",round(mean(slopevec.first.recent,na.rm=T),digits=2),round(quantile(slopevec.first.recent,lci,na.rm=T),digits=2),round(quantile(slopevec.first.recent,uci,na.rm=T),digits=2)),
c(pod,region,season,"last.20002016",round(mean(slopevec.last.recent,na.rm=T),digits=2),round(quantile(slopevec.last.recent,lci,na.rm=T),digits=2),round(quantile(slopevec.last.recent,uci,na.rm=T),digits=2))
)
colnames(df)<-c("pod","region","season","phase","slope.mn","slope.lci","slope.uci")
df.name<-paste("analyses/output/",pod,"_",season,"sept1_",region,min(dat$year),"-",max(dat$year),"occprob_wrecent.csv", sep="")
write.csv(df,df.name, row.names=FALSE)
#Figure showing phenological change by phenophase, pod/species, and region
#Goal is to compare rates of change among pods and regions, and between orcas and salmon
#Started August 2, 2019 by Ailene Ettinger
#housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
# Set working directory:
setwd("~/Documents/GitHub/fishphen")
#or from laptop:
#setwd("/Users/aileneettinger/Documents/GitHub/fishphen")
#Read in summaries of rates of change from orca occupancy model
l2<-read.csv("analyses/output/L_2sept1_uss1978-2017occprob_wrecent.csv")
l1<-read.csv("analyses/output/L_1sept1_ps1978-2017occprob_wrecent.csv")
k2<-read.csv("analyses/output/K_2sept1_uss1978-2017occprob_wrecent.csv")
k1<-read.csv("analyses/output/K_1sept1_ps1978-2017occprob_wrecent.csv")
j2<-read.csv("analyses/output/J_2sept1_uss1978-2017occprob_wrecent.csv")
j1<-read.csv("analyses/output/J_1sept1_ps1978-2017occprob_wrecent.csv")
all2<-rbind(j2,k2,l2)
all1<-rbind(j1,k1,l1)
all2<-all2[order(all2$pod),]
#read in salmon data
wildshifts<-read.csv("analyses/output/salmonreturntrends_wild.csv",header=TRUE)
hatchshifts<-read.csv( "analyses/output/salmonreturntrends_hatch.csv",header=TRUE)
#hatchshifts<-hatchshifts[hatchshifts$type=="hatch",]
albion<-read.csv("analyses/output/albionreturntrends.csv",header=TRUE)
colnames(albion)<-c("name","value")
albionshifts<-as.data.frame(t(as.numeric(albion[4:28,2])))
# Set working directory:
setwd("~/Documents/GitHub/fishphen")
#or from laptop:
#setwd("/Users/aileneettinger/Documents/GitHub/fishphen")
#Read in summaries of rates of change from orca occupancy model
l2<-read.csv("analyses/output/L_2sept1_uss1978-2017occprob_wrecent.csv")
l1<-read.csv("analyses/output/L_1sept1_ps1978-2017occprob_wrecent.csv")
k2<-read.csv("analyses/output/K_2sept1_uss1978-2017occprob_wrecent.csv")
k1<-read.csv("analyses/output/K_1sept1_ps1978-2017occprob_wrecent.csv")
j2<-read.csv("analyses/output/J_2sept1_uss1978-2017occprob_wrecent.csv")
j1<-read.csv("analyses/output/J_1sept1_ps1978-2017occprob_wrecent.csv")
l2<-read.csv("analyses/output/L_2sept1_uss1978-2017occprob.csv")
l1<-read.csv("analyses/output/L_1sept1_ps1978-2017occprob_wrecent.csv")
k2<-read.csv("analyses/output/K_2sept1_uss1978-2017occprob.csv")
k1<-read.csv("analyses/output/K_1sept1_ps1978-2017occprob_wrecent.csv")
j2<-read.csv("analyses/output/J_2sept1_uss1978-2017occprob.csv")
j1<-read.csv("analyses/output/J_1sept1_ps1978-2017occprob_wrecent.csv")
all2<-rbind(j2,k2,l2)
all1<-rbind(j1,k1,l1)
all2<-all2[order(all2$pod),]
#read in salmon data
wildshifts<-read.csv("analyses/output/salmonreturntrends_wild.csv",header=TRUE)
hatchshifts<-read.csv( "analyses/output/salmonreturntrends_hatch.csv",header=TRUE)
#hatchshifts<-hatchshifts[hatchshifts$type=="hatch",]
albion<-read.csv("analyses/output/albionreturntrends.csv",header=TRUE)
colnames(albion)<-c("name","value")
albionshifts<-as.data.frame(t(as.numeric(albion[4:28,2])))
colnames(albionshifts)<-albion[4:28,1]
# save plotted results as pdf
pdf(file="analyses/figures/srkw_salmon_shifts_lm.pdf",width=16,height=6)
### plot estimates of peak occurrence prob over all years
#quartz(width=16, height=6)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,1),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,3), bty="l")
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first"],x,all2$slope.uci[all2$phase=="first"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak"],x+1,all2$slope.uci[all2$phase=="peak"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last"],x+2,all2$slope.uci[all2$phase=="last"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first"],pch=c(21,22,24),bg="darkblue")
points(x+1,all2$slope.mn[all2$phase=="peak"],pch=c(21,22,24),bg="darkblue")
points(x+2,all2$slope.mn[all2$phase=="last"],pch=c(21,22,24),bg="darkblue")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
mtext("SRKWs 1978-2017",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
#Puget sound proper
plot(x,all1$slope.mn[all1$phase=="first"],pch=c(21,22,24),bg="salmon", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,all1$slope.lci[all1$phase=="first"],x,all1$slope.uci[all1$phase=="first"], code=3, length=0)
arrows(x+1,all1$slope.lci[all1$phase=="peak"],x+1,all1$slope.uci[all1$phase=="peak"], code=3, length=0)
arrows(x+2,all1$slope.lci[all1$phase=="last"],x+2,all1$slope.uci[all1$phase=="last"], code=3, length=0)
points(x,all1$slope.mn[all1$phase=="first"],pch=c(21,22,24),bg="salmon")
points(x+1,all1$slope.mn[all1$phase=="peak"],pch=c(21,22,24),bg="salmon")
points(x+2,all1$slope.mn[all1$phase=="last"],pch=c(21,22,24),bg="salmon")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
pdf(file="analyses/figures/srkw_salmon_recentshifts_lm.pdf",width=16,height=6)
### plot estimates of peak occurrence prob over all years
#quartz(width=16, height=6)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,1),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first.19902016"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,3), bty="l")
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first.19902016"],x,all2$slope.uci[all2$phase=="first.19902016"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak.19902016"],x+1,all2$slope.uci[all2$phase=="peak.19902016"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last.19902016"],x+2,all2$slope.uci[all2$phase=="last.19902016"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first.19902016"],pch=c(21,22,24),bg="darkblue")
points(x+1,all2$slope.mn[all2$phase=="peak.19902016"],pch=c(21,22,24),bg="darkblue")
points(x+2,all2$slope.mn[all2$phase=="last.19902016"],pch=c(21,22,24),bg="darkblue")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
mtext("SRKWs 1990-2016",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
pdf(file="analyses/figures/srkw_salmon_recentshifts_lm.pdf",width=16,height=6)
### plot estimates of peak occurrence prob over all years
#quartz(width=16, height=6)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,1),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first.19902016"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,3), bty="l")
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first.19902016"],x,all2$slope.uci[all2$phase=="first.19902016"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak.19902016"],x+1,all2$slope.uci[all2$phase=="peak.19902016"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last.19902016"],x+2,all2$slope.uci[all2$phase=="last.19902016"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first.19902016"],pch=c(21,22,24),bg="darkblue")
points(x+1,all2$slope.mn[all2$phase=="peak.19902016"],pch=c(21,22,24),bg="darkblue")
points(x+2,all2$slope.mn[all2$phase=="last.19902016"],pch=c(21,22,24),bg="darkblue")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
mtext("SRKWs 1990-2016",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
#Puget sound proper
plot(x,all1$slope.mn[all1$phase=="first.20002016"],pch=c(21,22,24),bg="salmon", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,all1$slope.lci[all1$phase=="first.20002016"],x,all1$slope.uci[all1$phase=="first.20002016"], code=3, length=0)
arrows(x+1,all1$slope.lci[all1$phase=="peak.20002016"],x+1,all1$slope.uci[all1$phase=="peak.20002016"], code=3, length=0)
arrows(x+2,all1$slope.lci[all1$phase=="last.20002016"],x+2,all1$slope.uci[all1$phase=="last.20002016"], code=3, length=0)
points(x,all1$slope.mn[all1$phase=="first.20002016"],pch=c(21,22,24),bg="salmon")
points(x+1,all1$slope.mn[all1$phase=="peak.20002016"],pch=c(21,22,24),bg="salmon")
points(x+2,all1$slope.mn[all1$phase=="last.120002016"],pch=c(21,22,24),bg="salmon")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
### plot estimates of peak occurrence prob over all years
#quartz(width=16, height=6)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,1),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first.19902016"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,3), bty="l")
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first.19902016"],x,all2$slope.uci[all2$phase=="first.19902016"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak.19902016"],x+1,all2$slope.uci[all2$phase=="peak.19902016"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last.19902016"],x+2,all2$slope.uci[all2$phase=="last.19902016"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first.19902016"],pch=c(21,22,24),bg="darkblue")
points(x+1,all2$slope.mn[all2$phase=="peak.19902016"],pch=c(21,22,24),bg="darkblue")
points(x+2,all2$slope.mn[all2$phase=="last.19902016"],pch=c(21,22,24),bg="darkblue")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
mtext("SRKWs 1990-2016",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
#Puget sound proper
plot(x,all1$slope.mn[all1$phase=="first.20002016"],pch=c(21,22,24),bg="salmon", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,all1$slope.lci[all1$phase=="first.20002016"],x,all1$slope.uci[all1$phase=="first.20002016"], code=3, length=0)
arrows(x+1,all1$slope.lci[all1$phase=="peak.20002016"],x+1,all1$slope.uci[all1$phase=="peak.20002016"], code=3, length=0)
arrows(x+2,all1$slope.lci[all1$phase=="last.20002016"],x+2,all1$slope.uci[all1$phase=="last.20002016"], code=3, length=0)
points(x,all1$slope.mn[all1$phase=="first.20002016"],pch=c(21,22,24),bg="salmon")
points(x+1,all1$slope.mn[all1$phase=="peak.20002016"],pch=c(21,22,24),bg="salmon")
points(x+2,all1$slope.mn[all1$phase=="last.20002016"],pch=c(21,22,24),bg="salmon")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
pdf(file="analyses/figures/srkw_salmon_recentshifts_lm.pdf",width=16,height=6)
### plot estimates of peak occurrence prob over all years
#quartz(width=16, height=6)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,1),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first.19902016"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,3), bty="l")
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first.19902016"],x,all2$slope.uci[all2$phase=="first.19902016"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak.19902016"],x+1,all2$slope.uci[all2$phase=="peak.19902016"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last.19902016"],x+2,all2$slope.uci[all2$phase=="last.19902016"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first.19902016"],pch=c(21,22,24),bg="darkblue")
points(x+1,all2$slope.mn[all2$phase=="peak.19902016"],pch=c(21,22,24),bg="darkblue")
points(x+2,all2$slope.mn[all2$phase=="last.19902016"],pch=c(21,22,24),bg="darkblue")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
mtext("SRKWs 1990-2016",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
#Puget sound proper
plot(x,all1$slope.mn[all1$phase=="first.20002016"],pch=c(21,22,24),bg="salmon", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,all1$slope.lci[all1$phase=="first.20002016"],x,all1$slope.uci[all1$phase=="first.20002016"], code=3, length=0)
arrows(x+1,all1$slope.lci[all1$phase=="peak.20002016"],x+1,all1$slope.uci[all1$phase=="peak.20002016"], code=3, length=0)
arrows(x+2,all1$slope.lci[all1$phase=="last.20002016"],x+2,all1$slope.uci[all1$phase=="last.20002016"], code=3, length=0)
points(x,all1$slope.mn[all1$phase=="first.20002016"],pch=c(21,22,24),bg="salmon")
points(x+1,all1$slope.mn[all1$phase=="peak.20002016"],pch=c(21,22,24),bg="salmon")
points(x+2,all1$slope.mn[all1$phase=="last.20002016"],pch=c(21,22,24),bg="salmon")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
##Add salmon
pdf(file="analyses/figures/salmon_shifts_lm.pdf",width=16,height=6)
