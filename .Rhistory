# 3. Limit space and time to 1975 or later and Salish Sea, Puget Sound, Washington Outer Coast
source("analyses/orcaphen/source/orca_limitspacetime.R")
#4. Get data in terms of number of observations per day and "whale days": days on which whales were seen (presence/absence for each day instead of )
source("analyses/orcaphen/source/orca_get_whaledays.R")
#5. summarize whale days per year by region
wdays<-as.data.frame(tapply(orcasum.days$AllSRpres,list(orcasum.days$year,orcasum.days$region),sum))
dim(wdays)#42 years
colMeans(wdays[1:20,], na.rm=TRUE)
wdays
wdays.J<-as.data.frame(tapply(orcasum.days$Jpres,list(orcasum.days$year,orcasum.days$region),sum))
wdays.K<-as.data.frame(tapply(orcasum.days$Kpres,list(orcasum.days$year,orcasum.days$region),sum))
wdays.L<-as.data.frame(tapply(orcasum.days$Lpres,list(orcasum.days$year,orcasum.days$region),sum))
#Plots observed or not, by doy and year
#yaxis is year
#xaxis is doy
#do for 3 regions
podcols<-c("Jpres", "Kpres", "Lpres", "AllSRpres")
pods<-c("J","K","L","SRs")
for(p in 1:length(podcols)){
quartz(width=16,height=6)
par(omi=c(.5,2,.5,.5), mfrow=c(1,3))
colnum<-which(colnames(orcasum.days)==podcols[p])
regions=unique(orcasum.days$region)
for(r in regions){
regdat<-orcasum.days[orcasum.days$region==r,]
years = unique(orcasum.days$year)
plot(0, type = 'n', las=1, xlim=c(1,366),ylim=c(min(as.numeric(years)),max(as.numeric(years))),ylab="",xlab="Day of year", main=paste(r), cex.axis=1.1, cex.lab=1.3)
for(y in years){
yrdat = regdat[regdat$year==y,]
days = yrdat$day[yrdat[,colnum]==1]
points(x=days,y=rep(y,length=length(days)), pch=21,bg="gray", cex=1.3)
#lines(x=days,y=rep(y,length=length(days)), lwd=2)
}
if(r=="uss"){mtext(paste(pods[p]), side=3,line=3, adj=0.5)}
if(r=="ps"){mtext("Year", side=2,line=4, adj=0.5)}
}
}
#summary of the number of days whales were observed in each region, by year:
pres<-tapply(orcasum.days$AllSRpres,list(orcasum.days$region, orcasum.days$year),sum)
#summary of the number of days whales with rows of data (observed or not) in each region, by year:
totobs<-tapply(orcasum.days$AllSRpres,list(orcasum.days$region, orcasum.days$year),length)
prob<-pres/totobs
#summary of the number of days whales were observed in each region, across all years:
pres.doy<-tapply(orcasum.days$AllSRpres,list(orcasum.days$region, orcasum.days$day),sum)
#summary of the number of days whales with rows of data (observed or not) in each region, across all tears:
totobs.doy<-tapply(orcasum.days$AllSRpres,list(orcasum.days$region, orcasum.days$day),length)
prob.doy<-pres.doy/totobs.doy
quartz()
par(mfrow=c(2,1))
plot(colnames(prob.doy),prob.doy[3,], type="l", ylab="Probability of obs.",xlab="DOY", main="USS")
plot(colnames(prob.doy),prob.doy[2,], type="l", ylab="Probability of obs.",xlab="DOY", main="PS")
#use a shifting window approach to see if trends in first and last obs date vary depending on when the start window is.
#use may 1 for uss season, oct 1 for ps season as start dates
#use oct 31 for uss season, jan31 for ps season, as end dates
regions=unique(orcasum.days$region)
podcols<-c("AllSRpres")#just do for all SRs for now
pods<-c("SRs")
#Create dataframe with first, last obs for each start date in each year
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.1may.all<-c()#for uss
firstest.1oct.all<-c()#for ps
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.1may.all<-c()#for uss
firstest.1oct.all<-c()#for ps
lastest.31oct.all<-c()#for uss
lastest.31jan.all<-c()#for ps
#p=1
#r=1
years<-unique(orcasum.days$orcayear)#use may 1 as start of orca year, as this will encompass min start date window that i want to try
years
head(orcasum.days)
#Only use fishing areas that have atleast 4 years with >20 observations:
#Look at some basic stats about orca observations
#Started with orca_dataprep_occmodel.R code
#4 February 2019
#housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
# Set working directory:
setwd("~/Documents/GitHub/fishphen")
#or from laptop:
#setwd("/Users/aileneettinger/Documents/GitHub/fishphen")
# Load libraries
library(dplyr)
library(mgcv)
library(scales)
library(RColorBrewer)
# 1. Get the data
d <- read.csv("data/AppendixII.csv")
# 2. Clean the data (also saved in output/AppendixII_cleaned,csv)
source("analyses/orcaphen/source/clean_orca.R")
# 3. Limit space and time to 1975 or later and Salish Sea, Puget Sound, Washington Outer Coast
source("analyses/orcaphen/source/orca_limitspacetime.R")
#4. Get data in terms of number of observations per day and "whale days": days on which whales were seen (presence/absence for each day instead of )
source("analyses/orcaphen/source/orca_get_whaledays.R")
#5. summarize whale days per year by region
wdays<-as.data.frame(tapply(orcasum.days$AllSRpres,list(orcasum.days$year,orcasum.days$region),sum))
colMeans(wdays[1:20,], na.rm=TRUE)
wdays.J<-as.data.frame(tapply(orcasum.days$Jpres,list(orcasum.days$year,orcasum.days$region),sum))
wdays.K<-as.data.frame(tapply(orcasum.days$Kpres,list(orcasum.days$year,orcasum.days$region),sum))
wdays.L<-as.data.frame(tapply(orcasum.days$Lpres,list(orcasum.days$year,orcasum.days$region),sum))
#6. if you want to do some basic plots of the data. This includes proportion of days in a week in which whales were observed up by week and decade
#source("analyses/orcaphen/source/orca_plotdata.R")
#Take home from the above plots: Seasonality is hard to see in the figure with a separate line for each decade. I also plotted them with a single line showing the mean across all decades, and I standardized the proportions by substracting the means and dividing by the standard deviation.
#I did this to try to make seasonal patterns more obvious. It only sort of made them more obvious. Here's what I take away from these figures:
#1) There is a very clear seasonal pattern in the SRKW use of the upper salish sea. This season ranges roughly from week 20 (mid May) through week 40 (early October).
#2) The seasonal pattern in the SRKW use is less obvious for Puget Sound, because the maximum proportion is lower over all. However, the season during which the proportion is consistently above the mean probability
#ranges from week 40 (early October) through week 2 (early January)
#use these for whale seasons to investigate shifts over time
#use a shifting window approach to see if trends in first and last obs date vary depending on when the start window is.
#use may 1 for uss season, oct 1 for ps season as start dates
#use oct 31 for uss season, jan31 for ps season, as end dates
regions=unique(orcasum.days$region)
podcols<-c("AllSRpres")#just do for all SRs for now
pods<-c("SRs")
#Create dataframe with first, last obs for each start date in each year
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.1may.all<-c()#for uss
firstest.1oct.all<-c()#for ps
lastest.31oct.all<-c()#for uss
lastest.31jan.all<-c()#for ps
#p=1
#r=1
years<-unique(orcasum.days$orcayear)#use may 1 as start of orca year, as this will encompass min start date window that i want to try
years
#p=1
#r=1
years<-seq(1978,2017, by=1)
years
#p=1
#r=1
years<-seq(1978,2017, by=1)#restrict to these years for orcayears
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
for(r in 1:2){
regdat<-orcasum.days[orcasum.days$region==regions[r],]
if (regions[r]=="uss"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)<154,]#may 1 through sept 30 for summer season
}
if (regions[r]=="ps"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)>=154 |as.numeric(regdat$daysaftapr30)<277,]#look at weeks oct 1 through jan 31
}
for(y in 1:length(years)){
yrdat<-regdat[regdat$orcayear==years[y],]
pods.all<-c(pods.all,pods[p])
regions.all<-c(regions.all,regions[r])
years.all<-c(years.all,years[y])
nobs.all<-c(nobs.all,length(yrdat$day[yrdat[,colnum]==1]))
#  if (regions[r]=="uss"){
yrdat<- yrdat[as.numeric(yrdat$daysaftapr30)<=336,]#look between start date (may 1) and mar31
firstest.1may.all<-c(firstest.1may.all,min(yrdat$daysaftapr30[yrdat[,colnum]==1], na.rm=TRUE))#1may=1 day after apr30stdays
#firstest.1jun.all<-c(firstest.1jun.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=32 & yrdat[,colnum]==1], na.rm=TRUE))#1jun=32 days after apr30
#firstest.1jul.all<-c(firstest.1jul.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=62 & yrdat[,colnum]==1], na.rm=TRUE))#1jul=63 days after apr30
#firstest.1aug.all<-c(firstest.1aug.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=93 & yrdat[,colnum]==1], na.rm=TRUE))#1aug=93 days after apr30
#firstest.1sep.all<-c(firstest.1sep.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=124 & yrdat[,colnum]==1], na.rm=TRUE))#1sep=124 days after apr30
firstest.1oct.all<-c(firstest.1oct.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=154 & yrdat[,colnum]==1], na.rm=TRUE))#1aug=154 days after apr30
#lastest.31dec.all<-c(lastest.31dec.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=245 & yrdat[,colnum]==1], na.rm=TRUE))#31dec = 245 days after apr30
lastest.31jan.all<-c(lastest.31jan.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=276 & yrdat[,colnum]==1], na.rm=TRUE))#31jan = 276 days after apr30
#lastest.28feb.all<-c(lastest.28feb.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=304 & yrdat[,colnum]==1], na.rm=TRUE))#28feb=304 days after apr30
lastest.31oct.all<-c(lastest.31oct.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=184 & yrdat[,colnum]==1], na.rm=TRUE))#31oct= 184 days after apr30
#lastest.all<-c(lastest.all,max(yrdat$daysaftapr30[yrdat[,colnum]==1], na.rm=TRUE))#31mar= 336 days after apr30
#}
}
}
}
warnings()
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.1may.all<-c()#for uss
firstest.1oct.all<-c()#for ps
lastest.31oct.all<-c()#for uss
lastest.31jan.all<-c()#for ps
#p=1
#r=1
years<-seq(1978,2017, by=1)#restrict to these years for orcayears
#unique(orcasum.days$orcayear)#use may 1 as start of orca year, as this will encompass min start date window that i want to try
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
for(r in 1:2){
regdat<-orcasum.days[orcasum.days$region==regions[r],]
if (regions[r]=="uss"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)<184,]#may 1 through oct 31 for summer season
}
if (regions[r]=="ps"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)>=154 |as.numeric(regdat$daysaftapr30)<277,]#look at weeks oct 1 through jan 31
}
for(y in 1:length(years)){
yrdat<-regdat[regdat$orcayear==years[y],]
pods.all<-c(pods.all,pods[p])
regions.all<-c(regions.all,regions[r])
years.all<-c(years.all,years[y])
nobs.all<-c(nobs.all,length(yrdat$day[yrdat[,colnum]==1]))
#  if (regions[r]=="uss"){
yrdat<- yrdat[as.numeric(yrdat$daysaftapr30)<=336,]#look between start date (may 1) and mar31
firstest.1may.all<-c(firstest.1may.all,min(yrdat$daysaftapr30[yrdat[,colnum]==1], na.rm=TRUE))#1may=1 day after apr30stdays
#firstest.1jun.all<-c(firstest.1jun.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=32 & yrdat[,colnum]==1], na.rm=TRUE))#1jun=32 days after apr30
#firstest.1jul.all<-c(firstest.1jul.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=62 & yrdat[,colnum]==1], na.rm=TRUE))#1jul=63 days after apr30
#firstest.1aug.all<-c(firstest.1aug.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=93 & yrdat[,colnum]==1], na.rm=TRUE))#1aug=93 days after apr30
#firstest.1sep.all<-c(firstest.1sep.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=124 & yrdat[,colnum]==1], na.rm=TRUE))#1sep=124 days after apr30
firstest.1oct.all<-c(firstest.1oct.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=154 & yrdat[,colnum]==1], na.rm=TRUE))#1aug=154 days after apr30
#lastest.31dec.all<-c(lastest.31dec.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=245 & yrdat[,colnum]==1], na.rm=TRUE))#31dec = 245 days after apr30
lastest.31jan.all<-c(lastest.31jan.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=276 & yrdat[,colnum]==1], na.rm=TRUE))#31jan = 276 days after apr30
#lastest.28feb.all<-c(lastest.28feb.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=304 & yrdat[,colnum]==1], na.rm=TRUE))#28feb=304 days after apr30
lastest.31oct.all<-c(lastest.31oct.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=184 & yrdat[,colnum]==1], na.rm=TRUE))#31oct= 184 days after apr30
#lastest.all<-c(lastest.all,max(yrdat$daysaftapr30[yrdat[,colnum]==1], na.rm=TRUE))#31mar= 336 days after apr30
#}
}
}
}
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
for(r in 1:2){
regdat<-orcasum.days[orcasum.days$region==regions[r],]
if (regions[r]=="uss"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)<184,]#may 1 through oct 31 for summer season
}
if (regions[r]=="ps"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)>=154 |as.numeric(regdat$daysaftapr30)<277,]#look at weeks oct 1 through jan 31
}
for(y in 1:length(years)){
yrdat<-regdat[regdat$orcayear==years[y],]
pods.all<-c(pods.all,pods[p])
regions.all<-c(regions.all,regions[r])
years.all<-c(years.all,years[y])
nobs.all<-c(nobs.all,length(yrdat$day[yrdat[,colnum]==1]))
#  if (regions[r]=="uss"){
yrdat<- yrdat[as.numeric(yrdat$daysaftapr30)<=336,]#look between start date (may 1) and mar31
firstest.1may.all<-c(firstest.1may.all,min(yrdat$daysaftapr30[yrdat[,colnum]==1], na.rm=TRUE))#1may=1 day after apr30stdays
firstest.1oct.all<-c(firstest.1oct.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=154 & yrdat[,colnum]==1], na.rm=TRUE))#1oct=154 days after apr30
lastest.31jan.all<-c(lastest.31jan.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=276 & yrdat[,colnum]==1], na.rm=TRUE))#31jan = 276 days after apr30
lastest.31oct.all<-c(lastest.31oct.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=184 & yrdat[,colnum]==1], na.rm=TRUE))#31oct= 184 days after apr30
#}
}
}
}
df <- as.data.frame(cbind(pods.all,regions.all,years.all,nobs.all,firstest.1may.all,firstest.1oct.all,lastest.31oct.all,lastest.31jan.all,))
df
df <- as.data.frame(cbind(pods.all,regions.all,years.all,nobs.all,firstest.1may.all,firstest.1oct.all,lastest.31oct.all,lastest.31jan.all))
df
if (regions[r]=="ps"){
firstest.1oct.all<-c(firstest.1oct.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=154 & yrdat[,colnum]==1], na.rm=TRUE))}#1oct=154 days after apr30
lastest.31jan.all<-c(lastest.31jan.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=276 & yrdat[,colnum]==1], na.rm=TRUE))#31jan = 276 days after apr30
firstest.1may.all<NA
firstest.1may.all<-NA
lastest.31oct.all<-NA
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.1may.all<-c()#for uss
firstest.1oct.all<-c()#for ps
lastest.31oct.all<-c()#for uss
lastest.31jan.all<-c()#for ps
#p=1
#r=1
years<-seq(1978,2017, by=1)#restrict to these years for orcayears
#unique(orcasum.days$orcayear)#use may 1 as start of orca year, as this will encompass min start date window that i want to try
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
for(r in 1:2){
regdat<-orcasum.days[orcasum.days$region==regions[r],]
if (regions[r]=="uss"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)<184,]#may 1 through oct 31 for summer season
}
if (regions[r]=="ps"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)>=154 |as.numeric(regdat$daysaftapr30)<277,]#look at weeks oct 1 through jan 31
}
for(y in 1:length(years)){
yrdat<-regdat[regdat$orcayear==years[y],]
pods.all<-c(pods.all,pods[p])
regions.all<-c(regions.all,regions[r])
years.all<-c(years.all,years[y])
nobs.all<-c(nobs.all,length(yrdat$day[yrdat[,colnum]==1]))
#  if (regions[r]=="uss"){
yrdat<- yrdat[as.numeric(yrdat$daysaftapr30)<=336,]#look between start date (may 1) and mar31
if (regions[r]=="uss"){
firstest.1may.all<-c(firstest.1may.all,min(yrdat$daysaftapr30[yrdat[,colnum]==1], na.rm=TRUE))#1may=1 day after apr30stdays
lastest.31oct.all<-c(lastest.31oct.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=184 & yrdat[,colnum]==1], na.rm=TRUE))#31oct= 184 days after apr30
firstest.1oct.all<-NA
lastest.31jan.all<-NA
}
if (regions[r]=="ps"){
firstest.1oct.all<-c(firstest.1oct.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=154 & yrdat[,colnum]==1], na.rm=TRUE))}#1oct=154 days after apr30
lastest.31jan.all<-c(lastest.31jan.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=276 & yrdat[,colnum]==1], na.rm=TRUE))#31jan = 276 days after apr30
firstest.1may.all<-NA
lastest.31oct.all<-NA
}
#}
}
}
df <- as.data.frame(cbind(pods.all,regions.all,years.all,nobs.all,firstest.1may.all,firstest.1oct.all,lastest.31oct.all,lastest.31jan.all))
colnames(df)[1:4]<-c("pod","region","year","nobs")
df
#Create dataframe with first, last obs for each start date in each year
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.1may.all<-c()#for uss
firstest.1oct.all<-c()#for ps
lastest.31oct.all<-c()#for uss
lastest.31jan.all<-c()#for ps
#p=1
#r=1
years<-seq(1978,2017, by=1)#restrict to these years for orcayears
#unique(orcasum.days$orcayear)#use may 1 as start of orca year, as this will encompass min start date window that i want to try
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
for(r in 1:2){
regdat<-orcasum.days[orcasum.days$region==regions[r],]
if (regions[r]=="uss"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)<184,]#may 1 through oct 31 for summer season
}
if (regions[r]=="ps"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)>=154 |as.numeric(regdat$daysaftapr30)<277,]#look at weeks oct 1 through jan 31
}
for(y in 1:length(years)){
yrdat<-regdat[regdat$orcayear==years[y],]
pods.all<-c(pods.all,pods[p])
regions.all<-c(regions.all,regions[r])
years.all<-c(years.all,years[y])
nobs.all<-c(nobs.all,length(yrdat$day[yrdat[,colnum]==1]))
#  if (regions[r]=="uss"){
yrdat<- yrdat[as.numeric(yrdat$daysaftapr30)<=336,]#look between start date (may 1) and mar31
if (regions[r]=="uss"){
firstest.1may.all<-c(firstest.1may.all,min(yrdat$daysaftapr30[yrdat[,colnum]==1], na.rm=TRUE))#1may=1 day after apr30stdays
lastest.31oct.all<-c(lastest.31oct.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=184 & yrdat[,colnum]==1], na.rm=TRUE))#31oct= 184 days after apr30
firstest.1oct.all<-c(firstest.1oct.all,NA)
lastest.31jan.all<-c(lastest.31jan.all,NA)
}
if (regions[r]=="ps"){
firstest.1oct.all<-c(firstest.1oct.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=154 & yrdat[,colnum]==1], na.rm=TRUE))}#1oct=154 days after apr30
lastest.31jan.all<-c(lastest.31jan.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=276 & yrdat[,colnum]==1], na.rm=TRUE))#31jan = 276 days after apr30
firstest.1may.all<-c(firstest.1may.all,NA)
lastest.31oct.all<-c(lastest.31oct.all,NA)
}
#}
}
}
df <- as.data.frame(cbind(pods.all,regions.all,years.all,nobs.all,firstest.1may.all,firstest.1oct.all,lastest.31oct.all,lastest.31jan.all))
regions=unique(orcasum.days$region)
podcols<-c("AllSRpres")#just do for all SRs for now
pods<-c("SRs")
#Create dataframe with first, last obs for each start date in each year
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.1may.all<-c()#for uss
firstest.1oct.all<-c()#for ps
lastest.31oct.all<-c()#for uss
lastest.31jan.all<-c()#for ps
#p=1
#r=1
years<-seq(1978,2017, by=1)#restrict to these years for orcayears
#unique(orcasum.days$orcayear)#use may 1 as start of orca year, as this will encompass min start date window that i want to try
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
for(r in 1:2){
regdat<-orcasum.days[orcasum.days$region==regions[r],]
if (regions[r]=="uss"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)<184,]#may 1 through oct 31 for summer season
}
if (regions[r]=="ps"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)>=154 |as.numeric(regdat$daysaftapr30)<277,]#look at weeks oct 1 through jan 31
}
for(y in 1:length(years)){
yrdat<-regdat[regdat$orcayear==years[y],]
pods.all<-c(pods.all,pods[p])
regions.all<-c(regions.all,regions[r])
years.all<-c(years.all,years[y])
nobs.all<-c(nobs.all,length(yrdat$day[yrdat[,colnum]==1]))
#  if (regions[r]=="uss"){
yrdat<- yrdat[as.numeric(yrdat$daysaftapr30)<=336,]#look between start date (may 1) and mar31
if (regions[r]=="uss"){
firstest.1may.all<-c(firstest.1may.all,min(yrdat$daysaftapr30[yrdat[,colnum]==1], na.rm=TRUE))#1may=1 day after apr30stdays
lastest.31oct.all<-c(lastest.31oct.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=184 & yrdat[,colnum]==1], na.rm=TRUE))#31oct= 184 days after apr30
firstest.1oct.all<-c(firstest.1oct.all,NA)
lastest.31jan.all<-c(lastest.31jan.all,NA)
}
if (regions[r]=="ps"){
firstest.1oct.all<-c(firstest.1oct.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=154 & yrdat[,colnum]==1], na.rm=TRUE))}#1oct=154 days after apr30
lastest.31jan.all<-c(lastest.31jan.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=276 & yrdat[,colnum]==1], na.rm=TRUE))#31jan = 276 days after apr30
firstest.1may.all<-c(firstest.1may.all,NA)
lastest.31oct.all<-c(lastest.31oct.all,NA)
}
#}
}
}
df <- as.data.frame(cbind(pods.all,regions.all,years.all,nobs.all,firstest.1may.all,firstest.1oct.all,lastest.31oct.all,lastest.31jan.all))
colnames(df)[1:4]<-c("pod","region","year","nobs")
df
#Create dataframe with first, last obs for each start date in each year
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.1may.all<-c()#for uss
firstest.1oct.all<-c()#for ps
lastest.31oct.all<-c()#for uss
lastest.31jan.all<-c()#for ps
#p=1
#r=1
years<-seq(1978,2017, by=1)#restrict to these years for orcayears
#unique(orcasum.days$orcayear)#use may 1 as start of orca year, as this will encompass min start date window that i want to try
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
for(r in 1:2){
regdat<-orcasum.days[orcasum.days$region==regions[r],]
if (regions[r]=="uss"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)<184,]#may 1 through oct 31 for summer season
}
if (regions[r]=="ps"){
regdat<-regdat[as.numeric(regdat$daysaftapr30)>=154 |as.numeric(regdat$daysaftapr30)<277,]#look at weeks oct 1 through jan 31
}
for(y in 1:length(years)){
yrdat<-regdat[regdat$orcayear==years[y],]
pods.all<-c(pods.all,pods[p])
regions.all<-c(regions.all,regions[r])
years.all<-c(years.all,years[y])
nobs.all<-c(nobs.all,length(yrdat$day[yrdat[,colnum]==1]))
#  if (regions[r]=="uss"){
yrdat<- yrdat[as.numeric(yrdat$daysaftapr30)<=336,]#look between start date (may 1) and mar31
if (regions[r]=="uss"){
firstest.1may.all<-c(firstest.1may.all,min(yrdat$daysaftapr30[yrdat[,colnum]==1], na.rm=TRUE))#1may=1 day after apr30stdays
lastest.31oct.all<-c(lastest.31oct.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=184 & yrdat[,colnum]==1], na.rm=TRUE))#31oct= 184 days after apr30
firstest.1oct.all<-c(firstest.1oct.all,NA)
lastest.31jan.all<-c(lastest.31jan.all,NA)
}
if (regions[r]=="ps"){
firstest.1oct.all<-c(firstest.1oct.all,min(yrdat$daysaftapr30[yrdat$daysaftapr30>=154 & yrdat[,colnum]==1], na.rm=TRUE))}#1oct=154 days after apr30
lastest.31jan.all<-c(lastest.31jan.all,max(yrdat$daysaftapr30[yrdat$daysaftapr30<=276 & yrdat[,colnum]==1], na.rm=TRUE))#31jan = 276 days after apr30
firstest.1may.all<-c(firstest.1may.all,NA)
lastest.31oct.all<-c(lastest.31oct.all,NA)
}
#}
}
}
df <- as.data.frame(cbind(pods.all,regions.all,years.all,nobs.all,firstest.1may.all,lastest.31oct.all,firstest.1oct.all,lastest.31jan.all))
colnames(df)[1:4]<-c("pod","region","year","nobs")
pod.df=df[df$pod=="SRs",]
pod.df$firstest.1may.all[which(pod.df$firstest.1may.all=="Inf")]<-NA
pod.df$firstest.1jun.all[which(pod.df$firstest.1jun.all=="Inf")]<-NA
pod.df$firstest.1jul.all[which(pod.df$firstest.1jul.all=="Inf")]<-NA
pod.df$firstest.1aug.all[which(pod.df$firstest.1aug.all=="Inf")]<-NA
pod.df$firstest.1sep.all[which(pod.df$firstest.1sep.all=="Inf")]<-NA
pod.df$firstest.1oct.all[which(pod.df$firstest.1oct.all=="Inf")]<-NA
pod.df$lastest.31dec.all[which(pod.df$lastest.31dec.all=="-Inf")]<-NA
pod.df$lastest.31jan.all[which(pod.df$lastest.31jan.all=="-Inf")]<-NA
pod.df$lastest.28feb.all[which(pod.df$lastest.28feb.all=="-Inf")]<-NA
pod.df$lastest.31mar.all[which(pod.df$lastest.31mar.all=="-Inf")]<-NA
pod.df$lastest.all[which(pod.df$lastest.all=="-Inf")]<-NA
#
pod.df$firstest.1may.all<-as.numeric(pod.df$firstest.1may.all)
pod.df$firstest.1jun.all<-as.numeric(pod.df$firstest.1jun.all)
pod.df$firstest.1jul.all<-as.numeric(pod.df$firstest.1jul.all)
pod.df$firstest.1aug.all<-as.numeric(pod.df$firstest.1aug.all)
pod.df$firstest.1sep.all<-as.numeric(pod.df$firstest.1sep.all)
pod.df$firstest.1oct.all<-as.numeric(pod.df$firstest.1oct.all)
pod.df=df[df$pod=="SRs",]
pod.df$firstest.1may.all[which(pod.df$firstest.1may.all=="Inf")]<-NA
pod.df$firstest.1oct.all[which(pod.df$firstest.1oct.all=="Inf")]<-NA
pod.df$lastest.31jan.all[which(pod.df$lastest.31jan.all=="-Inf")]<-NA
pod.df$firstest.1may.all[which(pod.df$firstest.1may.all=="Inf")]<-NA
pod.df$firstest.1oct.all[which(pod.df$firstest.1oct.all=="Inf")]<-NA
pod.df$lastest.31oct.all[which(pod.df$lastest.31oct.all=="-Inf")]<-NA
pod.df$lastest.31jan.all[which(pod.df$lastest.31jan.all=="-Inf")]<-NA
#
pod.df$firstest.1may.all<-as.numeric(pod.df$firstest.1may.all)
pod.df$firstest.1jun.all<-as.numeric(pod.df$firstest.1jun.all)
pod.df$firstest.1jul.all<-as.numeric(pod.df$firstest.1jul.all)
pod.df$firstest.1aug.all<-as.numeric(pod.df$firstest.1aug.all)
pod.df$lastest.31jan.all<-as.numeric(pod.df$lastest.31jan.all)
pod.df$lastest.31oct.all<-as.numeric(pod.df$lastest.31ocy.all)
pod.df$lastest.31oct.all<-as.numeric(pod.df$lastest.31oct.all)
pod.df$year<-as.numeric(pod.df$year)
for(r in 1:length(regions)){
reg.df<-pod.df[pod.df$region==regions[r],]
quartz(height=10,width=7)
par(mfcol=c(6,2))
for(i in 1:6){
#first obs with jul1 st window
plot(reg.df$year,reg.df[,i+4],xlab="year",ylab="first obs doy", main=paste(colnames(reg.df)[i+4],regions[r]), bty="l", pch=21, bg="gray")
mod<-lm(reg.df[,i+4]~reg.df$year)
abline(mod)
mtext(paste("r2=",round(summary(mod)$r.squared, digits=2),",p=",round(summary(mod)$coeff[2,4], digits=2)), side=3, adj=1, cex=0.7)
mtext(paste("coef=",round(summary(mod)$coeff[2,1], digits=2)), side=3,line=-1, adj=1, cex=0.7)
}
for(j in 1:5){
#last obs
plot(reg.df$year,reg.df[,j+10],xlab="year",ylab="last obs doy", main=paste(colnames(reg.df)[j+10]), bty="l", pch=21, bg="gray")
mod<-lm(reg.df[,j+10]~reg.df$year)
mtext(paste("r2=",round(summary(mod)$r.squared, digits=2),",p=",round(summary(mod)$coeff[2,4], digits=2)), side=3, adj=1, cex=0.7)
abline(mod)
print(summary(mod))
mtext(paste("coef=",round(summary(mod)$coeff[2,1], digits=2)), side=3,line=-1, adj=1, cex=0.7)
}
}
regions
reg.df<-pod.df[pod.df$region==regions[r],]
head(reg.df)
