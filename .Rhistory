if(season=="2"){
cat(paste("summary results",pod,region,season),"\n",
paste("annual change of peak occurrence prob:", round(mean(slopevec,na.rm=T),digits=2),"days"),
paste("confidence interval from", round(quantile(slopevec,lci,na.rm=T),digits=2),
"to",round(quantile(slopevec,uci,na.rm=T),digits=2)),
"\n","mean estimate of activity peak","as date",
as.character(as.Date(x=c(ann.res[,colnames(ann.res)=="mean"]),origin=c(paste(row.names(ann.res),"-01-01",sep="")))),"\n",
sep="\n","as day of year",
paste(rownames(ann.res),round(ann.res[,"mean"])))
}
#save a dataframe of trends in all three phenophases
df<-rbind(
c(pod,region,season,"peak",round(mean(slopevec,na.rm=T),digits=2),round(quantile(slopevec,lci,na.rm=T),digits=2),round(quantile(slopevec,uci,na.rm=T),digits=2),round(quantile(slopevec,.025,na.rm=T),digits=2),round(quantile(slopevec,.975,na.rm=T),digits=2)),
c(pod,region,season,"first",round(mean(slopevec.first,na.rm=T),digits=2),round(quantile(slopevec.first,lci,na.rm=T),digits=2),round(quantile(slopevec.first,uci,na.rm=T),digits=2),round(quantile(slopevec.first,.025,na.rm=T),digits=2),round(quantile(slopevec.first,.975,na.rm=T),digits=2)),
c(pod,region,season,"last",round(mean(slopevec.last,na.rm=T),digits=2),round(quantile(slopevec.last,lci,na.rm=T),digits=2),round(quantile(slopevec.last,uci,na.rm=T),digits=2),round(quantile(slopevec.last,.025,na.rm=T),digits=2),round(quantile(slopevec.last,.975,na.rm=T),digits=2)),
c(pod,region,season,"peak.20012016",round(mean(slopevec.recent,na.rm=T),digits=2),round(quantile(slopevec.recent,lci,na.rm=T),digits=2),round(quantile(slopevec.recent,uci,na.rm=T),digits=2),round(quantile(slopevec.recent,.025,na.rm=T),digits=2),round(quantile(slopevec.recent,.975,na.rm=T),digits=2)),
c(pod,region,season,"first.20012016",round(mean(slopevec.first.recent,na.rm=T),digits=2),round(quantile(slopevec.first.recent,lci,na.rm=T),digits=2),round(quantile(slopevec.first.recent,uci,na.rm=T),digits=2),round(quantile(slopevec.first.recent,.025,na.rm=T),digits=2),round(quantile(slopevec.first.recent,.975,na.rm=T),digits=2)),
c(pod,region,season,"last.20012016",round(mean(slopevec.last.recent,na.rm=T),digits=2),round(quantile(slopevec.last.recent,lci,na.rm=T),digits=2),round(quantile(slopevec.last.recent,uci,na.rm=T),digits=2),round(quantile(slopevec.last.recent,.025,na.rm=T),digits=2),round(quantile(slopevec.last.recent,.975,na.rm=T),digits=2))
)
colnames(df)[1:7]<-c("pod","region","season","phase","slope.mn","slope.lci","slope.uci")
cis<-uci-lci
if(assumeSRKW==TRUE){df.name<-paste("analyses/output/",pod,"_",season,region,"_","doy",min(dat$day),"-",max(dat$day),min(dat$year),"-",max(dat$year),"_ci",cis,"occprob_wrecent_assumeSRKW.csv", sep="")}
if(assumeSRKW==FALSE){df.name<-paste("analyses/output/",pod,"_",season,region,"_","doy",min(dat$day),"-",max(dat$day),min(dat$year),"-",max(dat$year),"_ci",cis,"occprob_wrecent.csv", sep="")}
write.csv(df,df.name, row.names=FALSE)
#save years and first-last-peak estimates
phen<-cbind(pod,region,season,rownames(ann.res),round(ann.res[,"mean"]),round(ann.res[,"lci"]),round(ann.res[,"uci"]),
round(ann.first[,"mean"]),round(ann.first[,"lci"]),round(ann.first[,"uci"]),
round(ann.last[,"mean"]),round(ann.last[,"lci"]),round(ann.last[,"uci"]),round(meanpsi, digits=2))
colnames(phen)<-c("pod","region","season","year","peak.psi","peak.lcl","peak.ucl","first.psi","first.lcl","first.ucl","last.psi","last.lcl","last.ucl", "mean.psi")
if(assumeSRKW==TRUE){phen.name<-paste("analyses/output/",pod,"_",season,region,"_doy",min(dat$day),"-",max(dat$day),"_",min(dat$year),"-",max(dat$year),"_ci",cis,"_assumeSRKWoccprobdoy.csv", sep="")}
if(assumeSRKW==FALSE){phen.name<-paste("analyses/output/",pod,"_",season,region,"_doy",min(dat$day),"-",max(dat$day),"_",min(dat$year),"-",max(dat$year),"_ci",cis,"_occprobdoy.csv", sep="")}
write.csv(phen,phen.name, row.names=FALSE)
if(assumeSRKW==TRUE){p.name<-paste("analyses/output/",pod,"_",season,region,"_doy",min(dat$day),"-",max(dat$day),"_",min(dat$year),"-",max(dat$year),"_ci",cis,"assumeSRKWdetprob.csv", sep="")}
if(assumeSRKW==FALSE){p.name<-paste("analyses/output/",pod,"_",season,region,"_doy",min(dat$day),"-",max(dat$day),"_",min(dat$year),"-",max(dat$year),"_ci",cis,"detprob.csv", sep="")}
write.csv(meanp, p.name, row.names=TRUE)
if(assumeSRKW==TRUE){p.name<-paste("analyses/output/",pod,"_",season,region,"_doy",min(dat$day),"-",max(dat$day),"_",min(dat$year),"-",max(dat$year),"_ci",cis,"assumeSRKWdetprob.csv", sep="")}
if(assumeSRKW==FALSE){p.name<-paste("analyses/output/",pod,"_",season,region,"_doy",min(dat$day),"-",max(dat$day),"_",min(dat$year),"-",max(dat$year),"_ci",cis,"detprob.csv", sep="")}
mean.psi.allyears<-jags.out$BUGSoutput$mean$psi
if(assumeSRKW==TRUE){psi.name<-paste("analyses/output/",pod,"_",season,region,"_doy",min(dat$day),"-",max(dat$day),"_",min(dat$year),"-",max(dat$year),"assumeSRKWmeanoccprob_all.csv", sep="")}
if(assumeSRKW==FALSE){psi.name<-paste("analyses/output/",pod,"_",season,region,"_doy",min(dat$day),"-",max(dat$day),"_",min(dat$year),"-",max(dat$year),"meanoccprob_all.csv", sep="")}
write.csv(mean.psi.allyears, psi.name, row.names=TRUE)
#-----------------------------------------------------------------
# Plot output
#-----------------------------------------------------------------
if(region == "uss"){color = "darkblue"}
if(region == "ps"){color = "salmon"}
# save plotted results as pdf
if(assumeSRKW==TRUE){pdf(file=paste("analyses/figures/",pod,"/orcaphen_",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_",prob,"assumeSRKWpeakoccprob.pdf", sep=""),width=7,height=7)}
if(assumeSRKW==FALSE){pdf(file=paste("analyses/figures/",pod,"/orcaphen_",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_",prob,"peakoccprob.pdf", sep=""),width=7,height=7)}
### plot estimates of peak prob of occurrence over all years
#quartz(width=7, height=6)
par(mfrow=c(1,1),mai=c(1,1,1,0.5))
x=rownames(ann.res)
y=ann.res[,"mean"]
seasname<-c("winter","summer")
plot(x,y,xlab="",ylab="",axes=F,main=paste("Date of Peak Occurence Probability","\n",pod," Pod",seasname[as.numeric(season)],region),
ylim=range(dat$day),pch=16,type="l", lwd=1.5,col=color)
polygon(c(rev(x),x),c(rev(ann.res[,"uci"]),ann.res[,"lci"]),col=alpha(color,0.2),lty=0)
axis(side=1,at=x)
if(season==2){
axis(side=2,at=c(92,122,152,183,214,244,274,303),
labels=c("1Apr","1May","1Jun","1Jul","1Aug","1Sept","1Oct","1Nov"))
}
if(season==1){
axis(side=2,at=c(182,213,244,274,305,335,366),
labels=c("1Jul","1Aug","1Sept","1Oct","1Nov","1Dec","1Jan"))}
if(season ==3){
axis(side=2,at=c(1,92,183,274,365),
labels=c("1Jan","1Apr","1Jul","1Oct","31Dec"))
}
#for (o in 1:500) {
#if(!is.na(sum(lpmax[o,]))) {
#  mod<-lm(lpmax[o,]~as.numeric(colnames(lpmax)))$coefficients->r[o,]
#  abline(mod,col=alpha("salmon",0.2),lwd=2)
#}
#}
#clip(2008,2017, min(y), max(y))
if(season==1){abline(a=intercept,b=slope,col="darkred",lwd=2)}
if(season==2){abline(a=intercept,b=slope,col="midnightblue",lwd=2)}
dev.off()
#plot only recent years
# save plotted results as pdf
if(assumeSRKW==TRUE){pdf(file=paste("analyses/figures/",pod,"/orcaphen_","2001-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_",prob,"assumeSRKWpeakoccprob.pdf", sep=""),width=7,height=7)}
if(assumeSRKW==FALSE){pdf(file=paste("analyses/figures/",pod,"/orcaphen_","2001-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_",prob,"peakoccprob.pdf", sep=""),width=7,height=7)}
### plot estimates of peak occurence over only recent years
#quartz(width=7, height=6)
par(mfrow=c(1,1),mai=c(1,1,1,0.5))
x=rownames(ann.res)[24:length(rownames(ann.res))]
y=ann.res[,"mean"][24:length(rownames(ann.res))]
seasname<-c("winter","summer")
plot(x,y,xlab="",ylab="",axes=F,main=paste("Date of Peak Occurence Probability","\n",pod," Pod",seasname[as.numeric(season)],region),
ylim=range(dat$day),pch=16,type="l", lwd=1.5,col=color)
polygon(c(rev(x),x),c(rev(ann.res[,"uci"][24:length(rownames(ann.res))]),ann.res[,"lci"][24:length(rownames(ann.res))]),col=alpha(color,0.2),lty=0)
axis(side=1,at=x)
if(season==2){
axis(side=2,at=c(92,122,152,183,214,244,274,303),
labels=c("1Apr","1May","1Jun","1Jul","1Aug","1Sept","1Oct","1Nov"))
}
if(season==1){
axis(side=2,at=c(182,213,244,274,305,335,366),
labels=c("1Jul","1Aug","1Sept","1Oct","1Nov","1Dec","1Jan"))}
if(season ==3){
axis(side=2,at=c(1,92,183,274,365),
labels=c("1Jan","1Apr","1Jul","1Oct","31Dec"))
}
#for (o in 1:500) {
#if(!is.na(sum(lpmax[o,]))) {
#  mod<-lm(lpmax[o,]~as.numeric(colnames(lpmax)))$coefficients->r[o,]
#  abline(mod,col=alpha("salmon",0.2),lwd=2)
#}
#}
#clip(2008,2017, min(y), max(y))
if(season==1){abline(a=intercept.recent,b=slope.recent,col="darkred",lwd=2)}
if(season==2){abline(a=intercept.recent,b=slope.recent,col="midnightblue",lwd=2)}
dev.off()
#-----------------------------------------------------------------
# Plot first date detectability > selected prob
#-----------------------------------------------------------------
# save plotted results as pdf
if(assumeSRKW==TRUE){pdf(file=paste("analyses/figures/",pod,"/orcaphen",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_first_",prob,"assumeSRKWoccprob.pdf", sep=""),width=7,height=7)}
if(assumeSRKW==FALSE){pdf(file=paste("analyses/figures/",pod,"/orcaphen",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"_first_",prob,"occprob.pdf", sep=""),width=7,height=7)}
### plot estimates of first det.prob > XX over all years
#quartz(width=7, height=6)
par(mfrow=c(1,1),mai=c(1,1,1,0.5))
x=rownames(ann.first)
y=ann.first[,"mean"]
seasname<-c("winter","summer")
plot(x,y,xlab="",ylab="",axes=F,main=paste("First Detection Probability >",prob,"\n",pod," Pod",seasname[as.numeric(season)],region),
ylim=range(dat$day),pch=16,type="l", lwd=1.5,col=color)
polygon(c(rev(x),x),c(rev(ann.first[,"uci"]),ann.first[,"lci"]),col=alpha(color,0.2),lty=0)
axis(side=1,at=x)
if(season==2){
axis(side=2,at=c(92,122,152,183,214,244,274,303),
labels=c("1Apr","1May","1Jun","1Jul","1Aug","1Sept","1Oct","1Nov"))
}
if(season==1){
axis(side=2,at=c(182,213,244,274,305,335,366),
labels=c("1Jul","1Aug","1Sept","1Oct","1Nov","1Dec","1Jan"))
}
if(season==3){
axis(side=2,at=c(1,92,183,274,365),
labels=c("1Jan","1Apr","1Jul","1Oct","31Dec"))
}
#for (o in 1:500) {
#  #if(!is.na(sum(lpmax[o,]))) {
#  mod.first<-lm(firstlp[o,]~as.numeric(colnames(firstlp)))$coefficients->r.first[o,]
#  abline(mod.first,col=alpha("grey",0.2),lwd=2)
#}
#}
if(season==1){abline(a=intercept.first,b=slope.first,col="darkred",lwd=2)}
if(season==2){abline(a=intercept.first,b=slope.first,col="midnightblue",lwd=2)}
dev.off()
# save plotted results as pdf
if(assumeSRKW==TRUE){pdf(file=paste("analyses/figures/",pod,"/orcaphen",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"last_",prob,"assumeSRKWoccprob.pdf", sep=""),width=7,height=7)}
if(assumeSRKW==FALSE){pdf(file=paste("analyses/figures/",pod,"/orcaphen",min(dat$year),"-",max(dat$year),"_",region,"_",season,"_doy",min(dat$day),"-",max(dat$day),"_",pod,"last_",prob,"occprob.pdf", sep=""),width=7,height=7)}
### plot estimates of last detectability > selected prob over all years
#quartz(width=7, height=6)
par(mfrow=c(1,1),mai=c(1,1,1,0.5))
x=rownames(ann.last)
y=ann.last[,"mean"]
seasname<-c("winter","summer")
plot(x,y,xlab="",ylab="",axes=F,main=paste("Last Occurence Probability >",prob,"\n",pod," Pod",seasname[as.numeric(season)],region),
ylim=range(dat$day),pch=16,type="l", lwd=1.5,col=color)
polygon(c(rev(x),x),c(rev(ann.last[,"uci"]),ann.last[,"lci"]),col=alpha(color,0.2),lty=0)
axis(side=1,at=x)
if(season==2){
axis(side=2,at=c(92,122,152,183,214,244,274,303),
labels=c("1Apr","1May","1Jun","1Jul","1Aug","1Sept","1Oct","1Nov"))
}
if(season==1){
axis(side=2,at=c(182,213,244,274,305,335,366),
labels=c("1Jul","1Aug","1Sept","1Oct","1Nov","1Dec","1Jan"))
}
if(season==3){
axis(side=2,at=c(1,92,183,274,365),
labels=c("1Jan","1Apr","1Jul","1Oct","31Dec"))
}
#for (o in 1:500) {
#  #if(!is.na(sum(lpmax[o,]))) {
#  mod.last<-lm(lastlp[o,]~as.numeric(colnames(lastlp)))$coefficients->r.last[o,]
#  abline(mod.last,col=alpha("grey",0.2),lwd=2)
#
#}
#}
if(season ==1){abline(a=intercept.last,b=slope.last,col="darkred",lwd=2)}
if(season ==2){abline(a=intercept.last,b=slope.last,col="midnightblue",lwd=2)}
dev.off()
### Plot annual detectability pattern
# loop over all years
years<-sort(unique(as.numeric((dat$year))))
seasonname<-c("winter","summer","wholeyear")
for (xj in 1:length(years)) {
j<-years[xj]
# Get BUGS estimates
res.chains<-out$sims.array[,,paste("lp[",xj[1],",",1:(max(dat$day)-min(dat$day)+1),"]",sep="")]
res=plogis(apply(res.chains,MARGIN=c(length(dim(res.chains))),quantile,probs=c(.05,.5,.95)))
### Plot "naive" estimate of occurence
# prepare bars to compare barplot of observation data (bars) with estimates (line); barheight represents weekly proportion of detection events divided by all surveys
barwidth<-7
z<-1
for(m in seq(from=min(dat$day),to=max(dat$day),by=barwidth)) {
dat$barpos[dat$day >= m & dat$day < m+barwidth]<-z
z<-z+1
}
barheight<-rep(NA,times=max(dat$day)+7)
names(barheight)<-1:max(dat$day)
# height of the bars equals to a seven day successful obs to all obs ratio
n<-(max(dat$day)-min(dat$day)+1)
res.height<-tapply(dat$ndet[dat$year==j],dat$barpos[dat$year==j],sum)/tapply(dat$nrep[dat$year==j],dat$barpos[dat$year==j],sum)
barheight[as.numeric(names(res.height))*7-3+min(dat$day)]<-res.height
# plot bars
#for seasonal values...
figpath<- paste("analyses/figures/",pod,sep="")
if(assumeSRKW==TRUE){figname<-paste("orcaphen",j,region,seasonname[as.numeric(season)],"doy",min(dat$day),"-",max(dat$day),"_",pod,"_",prob, "assumeSRKW.pdf",sep="_")}
if(assumeSRKW==FALSE){figname<-paste("orcaphen",j,region,seasonname[as.numeric(season)],"doy",min(dat$day),"-",max(dat$day),"_",pod,"_",prob, ".pdf",sep="_")}
pdf(file.path(figpath, figname), width = 9, height = 6)
#quartz()
x<-barplot(as.numeric(barheight[min(dat$day):max(dat$day)]),
width=1,space=0,ylim=c(0,1),xlab="", ylab="Occurence Probability",
main=paste(pod," pod",j),border=NA,axes=F)#ylim:max(res[3,])
### Plot model estimates
# plot seasonal estimates of detectability p
lines(res[3,],lty=3,col=1,lwd=2.5) # lower bound of the 90% CI
lines(res[2,],lty=1,col=1,lwd=2) # median
lines(res[1,],lty=3,col=1,lwd=2.5) # upper bound of the 90% CI
axis(2)
if(season==1){
axis(side=1,at=c(183-183,213-183,244-183,274-183,305-183,335-183,366-183),
labels=c("1Jul","1Aug","1Sept","1Oct","1Nov","1Dec","1Jan"))
}
if(season==2){
axis(side=1,at=c(92-92,122-92,152-92,183-92,214-92,244-92,274-92,303-92),
labels=c("1Apr","1May","1Jun","1Jul","1Aug","1Sept","1Oct","1Nov"))
}
if(season==3){
axis(side=1,at=c(1,92,183,274,365),
labels=c("1Jan","1Apr","1Jul","1Oct","31Dec"))
}
dev.off()
}
pod
rm(list=ls())
options(stringsAsFactors = FALSE)
#library(lme4)
# Set working directory:
setwd("~/Documents/GitHub/fishphen")
#or from work laptop:
#setwd("/Users/aileneettinger/Documents/GitHub/fishphen")
#Read in summaries of rates of change from orca occupancy model
l2<-read.csv("analyses/output/L_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
l1<-read.csv("analyses/output/L_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
k2<-read.csv("analyses/output/K_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
k1<-read.csv("analyses/output/K_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
j2<-read.csv("analyses/output/J_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
j1<-read.csv("analyses/output/J_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
all2<-rbind(j2,k2,l2)
all1<-rbind(j1,k1,l1)
all2<-all2[order(all2$pod),]
setwd("~/GitHub/fishphen/analyses/orcaphen")
#library(lme4)
# Set working directory:
setwd("~/GitHub/fishphen")
#Read in summaries of rates of change from orca occupancy model
l2<-read.csv("analyses/output/L_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
l1<-read.csv("analyses/output/L_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
k2<-read.csv("analyses/output/K_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
k1<-read.csv("analyses/output/K_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
j2<-read.csv("analyses/output/J_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
j1<-read.csv("analyses/output/J_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
all2<-rbind(j2,k2,l2)
all1<-rbind(j1,k1,l1)
all2<-all2[order(all2$pod),]
all2<-rbind(j2,k2,l2)
head(all2)
all1<-rbind(j1,k1,l1)
head(ji)
head(j1)
head(j2)
head(k2)
head(k1)
head(l1)
head(j1)
l2<-read.csv("analyses/output/L_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
l1<-read.csv("analyses/output/L_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
k2<-read.csv("analyses/output/K_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
k1<-read.csv("analyses/output/K_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
j2<-read.csv("analyses/output/J_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
j1<-read.csv("analyses/output/J_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
all2<-rbind(j2,k2,l2)
all1<-rbind(j1,k1,l1)
colnames(j1)
colnames(k1)
colnames(l1)
colnames(k2)
#housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
#library(lme4)
# Set working directory:
setwd("~/GitHub/fishphen")
#or from work laptop:
#setwd("/Users/aileneettinger/Documents/GitHub/fishphen")
#Read in summaries of rates of change from orca occupancy model
l2<-read.csv("analyses/output/L_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
l1<-read.csv("analyses/output/L_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
k2<-read.csv("analyses/output/K_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
k1<-read.csv("analyses/output/K_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
j2<-read.csv("analyses/output/J_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
j1<-read.csv("analyses/output/J_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
all2<-rbind(j2,k2,l2)
all1<-rbind(j1,k1,l1)
all2<-all2[order(all2$pod),]
#Goal is to compare rates of change among pods and regions, and between orcas and salmon
#Started August 2, 2019 by Ailene Ettinger
#housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
#library(lme4)
# Set working directory:
setwd("~/GitHub/fishphen")
#or from work laptop:
#setwd("/Users/aileneettinger/Documents/GitHub/fishphen")
#Read in summaries of rates of change from orca occupancy model
l2<-read.csv("analyses/output/L_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
l1<-read.csv("analyses/output/L_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
k2<-read.csv("analyses/output/K_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
k1<-read.csv("analyses/output/K_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
j2<-read.csv("analyses/output/J_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
j1<-read.csv("analyses/output/J_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
all2<-rbind(j2,k2,l2)
all1<-rbind(j1,k1,l1)
colnames(j1)
colnames(l1)
colnames(j2)
colnames(l2)
#housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
#library(lme4)
# Set working directory:
setwd("~/GitHub/fishphen")
#or from work laptop:
#setwd("/Users/aileneettinger/Documents/GitHub/fishphen")
#Read in summaries of rates of change from orca occupancy model
l2<-read.csv("analyses/output/L_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
l1<-read.csv("analyses/output/L_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
k2<-read.csv("analyses/output/K_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
k1<-read.csv("analyses/output/K_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
j2<-read.csv("analyses/output/J_2uss_doy92-3031978-2017_ci0.5occprob_wrecent.csv")
j1<-read.csv("analyses/output/J_1ps_doy183-3661978-2017_ci0.5occprob_wrecent.csv")
all2<-rbind(j2,k2,l2)
all1<-rbind(j1,k1,l1)
all2<-all2[order(all2$pod),]
wildshifts<-read.csv("analyses/output/salmonreturntrends_wild.csv",header=TRUE)
hatchshifts<-read.csv( "analyses/output/salmonreturntrends_hatch.csv",header=TRUE)
#hatchshifts<-hatchshifts[hatchshifts$type=="hatch",]
albion<-read.csv("analyses/output/albionreturntrends_linmodyrs.csv",header=TRUE)
#colnames(albion)<-colnames(albionsp)<-colnames(albionfa)<-c("name","value")
#albionshifts<-as.data.frame(t(as.numeric(albion[4:28,2])))
colnames(albion)[1]<-"coef"
psshifts<-read.csv("analyses/output/salmonreturntrends_pslmm.csv", header=TRUE)
psshifts<-psshifts[,-2]
#colnames(albionshifts)<-albion[4:28,1]
albionshifts<-albion
# save plotted results as pdf
pdf(file="analyses/figures/srkw_salmon_shifts_lm_1978_2017.pdf",width=16,height=6)
#quartz()
### plot estimates of peak occurrence prob over all years
#quartz(width=16, height=6)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,1),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,3), bty="l")
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first"],x,all2$slope.uci[all2$phase=="first"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak"],x+1,all2$slope.uci[all2$phase=="peak"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last"],x+2,all2$slope.uci[all2$phase=="last"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first"],pch=c(21,22,24),bg="darkblue")
points(x+1,all2$slope.mn[all2$phase=="peak"],pch=c(21,22,24),bg="darkblue")
points(x+2,all2$slope.mn[all2$phase=="last"],pch=c(21,22,24),bg="darkblue")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
mtext("SRKWs 1978-2017",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
#Puget sound proper
plot(x,all1$slope.mn[all1$phase=="first"],pch=c(21,22,24),bg="salmon", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,all1$slope.lci[all1$phase=="first"],x,all1$slope.uci[all1$phase=="first"], code=3, length=0)
arrows(x+1,all1$slope.lci[all1$phase=="peak"],x+1,all1$slope.uci[all1$phase=="peak"], code=3, length=0)
arrows(x+2,all1$slope.lci[all1$phase=="last"],x+2,all1$slope.uci[all1$phase=="last"], code=3, length=0)
points(x,all1$slope.mn[all1$phase=="first"],pch=c(21,22,24),bg="yellow")
points(x+1,all1$slope.mn[all1$phase=="peak"],pch=c(21,22,24),bg="salmon")
points(x+2,all1$slope.mn[all1$phase=="last"],pch=c(21,22,24),bg="salmon")
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
#add shifts in most recent (1990-2016)
#pdf(file="analyses/figures/srkw_salmon_recentshifts_lm.pdf",width=12,height=10)
png(file="analyses/figures/srkw_salmon_recentshifts_lm.png",width=600,height=500)
###dev.off() plot estimates of peak occurrence prob over all years
#quartz(width=12, height=10)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,2),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first.20012016"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,7), bty="l", cex=2)
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first.20012016"],x,all2$slope.uci[all2$phase=="first.20012016"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak.20012016"],x+1,all2$slope.uci[all2$phase=="peak.20012016"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last.20012016"],x+2,all2$slope.uci[all2$phase=="last.20012016"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first.20012016"],pch=c(21,22,24),bg="darkblue", cex=2)
points(x+1,all2$slope.mn[all2$phase=="peak.20012016"],pch=c(21,22,24),bg="darkblue", cex=2)
points(x+2,all2$slope.mn[all2$phase=="last.20012016"],pch=c(21,22,24),bg="darkblue", cex=2)
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
#mtext("SRKWs 2001-2016",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
mtext("A)",side=3,line=0, adj=0)
#Puget sound proper
plot(x,all1$slope.mn[all1$phase=="first.20012016"],pch=c(21,22,24),bg="goldenrod", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,7), bty="l", cex=2)
abline(h=0,lty=2)
arrows(x,all1$slope.lci[all1$phase=="first.20012016"],x,all1$slope.uci[all1$phase=="first.20012016"], code=3, length=0)
arrows(x+1,all1$slope.lci[all1$phase=="peak.20012016"],x+1,all1$slope.uci[all1$phase=="peak.20012016"], code=3, length=0)
arrows(x+2,all1$slope.lci[all1$phase=="last.20012016"],x+2,all1$slope.uci[all1$phase=="last.20012016"], code=3, length=0)
points(x,all1$slope.mn[all1$phase=="first.20012016"],pch=c(21,22,24),bg="goldenrod", cex=2)
points(x+1,all1$slope.mn[all1$phase=="peak.20012016"],pch=c(21,22,24),bg="goldenrod", cex=2)
points(x+2,all1$slope.mn[all1$phase=="last.20012016"],pch=c(21,22,24),bg="goldenrod", cex=2)
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
#dev.off()
x<-c(1,2,3)
y<-c(albionshifts$est[2],albionshifts$est[6],albionshifts$est[4])
ylci<-c(albionshifts$ci25[2],albionshifts$ci25[6],albionshifts$ci25[4])
yuci<-c(albionshifts$ci75[2],albionshifts$ci75[6],albionshifts$ci75[4])
mtext("B)",side=3,line=0, adj=0)
plot(x,y,pch=23,bg="salmon",ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,5), ylim=c(-3,7),bty="l", cex=2)
abline(h=0,lty=2)
arrows(x,ylci,x,yuci, code=3, length=0)
points(x,y,cex=2,bg="salmon",pch=23)
mtext("C)",side=3,line=0, adj=0)
legend("topleft",legend=c("Fraser River Chinook","Multiple Puget Sound Runs"),pch=c(23,25), bty="n",pt.bg="salmon")
y<-c(psshifts[1,2],psshifts[1,4],psshifts[1,6])
ylci<-c(psshifts[2,2],psshifts[2,4],psshifts[2,6])
yuci<-c(psshifts[3,2],psshifts[3,4],psshifts[3,6])
plot(x,y,pch=25,bg="salmon",ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,5), ylim=c(-3,7),bty="l", cex=2)
abline(h=0,lty=2)
arrows(x,ylci,x,yuci, code=3, length=0)
points(x,y,cex=2,bg="salmon",pch=25)
mtext("D)",side=3,line=0, adj=0)
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
##Separate salmon figure
pdf(file="analyses/figures/salmon_shifts_lm.pdf",width=16,height=6)
par(mfcol=c(2,2),mai=c(.5,1,.5,0.5))
#Central salish sea = albion test fishery from fraser
x<-c(1,2,3,4)
y<-c(albionshifts$first.yr,albionshifts$pk.yr,albionshifts$mid.yr,albionshifts$last.yr)
ylci<-c(albionshifts$first.yrlci,albionshifts$pk.yrlci,albionshifts$mid.yrlci,albionshifts$last.yrlci)
yuci<-c(albionshifts$first.yruci,albionshifts$pk.yruci,albionshifts$mid.yruci,albionshifts$last.yruci)
plot(x,y,pch=23,bg="blue4",ylab= "",xaxt="n", xlab="",xlim=c(0,5), bty="l", cex=log(albionshifts$mn.total)/6)
abline(h=0,lty=2)
mtext("wild salmon",side=3,line=0)
arrows(x,ylci,x,yuci, code=3, length=0,col="blue2")
points(x,y,cex=log(albionshifts$mn.total)/6,bg="blue1",pch=23)
legend("topleft",legend=c("Chum","Chinook","Coho"),pch=c(21,23,25), bty="n",pt.bg="darkblue")
#Hachery shifts
#Puget sound proper
dd<-wildshifts
x<-rep(1,times=6)
shapes<-c(21,23,25)
cols<-c("lightgray","lightsalmon","salmon2","salmon4","darksalmon")
plot(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)], ylab= "",xaxt="n", xlab="",xlim=c(0,5),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,dd$first.yrlci,x,dd$first.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+1,dd$pk.yrlci,x+1,dd$pk.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+2,dd$mid.yrlci,x+2,dd$mid.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+3,dd$last.yrlci,x+3,dd$last.yruci, code=3, length=0,col=cols[factor(dd$site)])
points(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+1,dd$pk.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+2,dd$mid.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+3,dd$last.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
axis(side=1,labels=c("First","Peak","Med","Last"), at = c(1,2,3,4))
#Central salish sea first...
cols<-c("skyblue")
dd<-hatchshifts[hatchshifts$site=="WHATCOM CR HATCHERY",]#only one hatchery site in central salish sea, i think
x<-1
plot(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)], ylab= "",xaxt="n", xlab="",xlim=c(0,5),ylim=c(-3,3), bty="l")
abline(h=0,lty=2)
arrows(x,dd$first.yrlci,x,dd$first.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+1,dd$pk.yrlci,x+1,dd$pk.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+2,dd$mid.yrlci,x+2,dd$mid.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+3,dd$last.yrlci,x+3,dd$last.yruci, code=3, length=0,col=cols[factor(dd$site)])
points(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+1,dd$pk.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+2,dd$mid.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+3,dd$last.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
axis(side=1,labels=c("First","Peak","Med","Last"), at = c(1,2,3,4))
mtext("hatchery salmon",side=3,line=0)
#Hachery shifts
#Puget sound proper
dd<-hatchshifts[hatchshifts$site!="WHATCOM CR HATCHERY",]#only one hatchery site in central salish sea, i think
cols<-c("lightgray","lightsalmon","salmon2","salmon4","darksalmon","darkred")
x<-rep(1, times=length(dd$first.yr))
plot(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)], ylab= "",xaxt="n", xlab="",xlim=c(0,5),ylim=c(-10,7), bty="l")
abline(h=0,lty=2)
arrows(x,dd$first.yrlci,x,dd$first.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+1,dd$pk.yrlci,x+1,dd$pk.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+2,dd$mid.yrlci,x+2,dd$mid.yruci, code=3, length=0,col=cols[factor(dd$site)])
arrows(x+3,dd$last.yrlci,x+3,dd$last.yruci, code=3, length=0,col=cols[factor(dd$site)])
points(x,dd$first.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+1,dd$pk.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+2,dd$mid.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
points(x+3,dd$last.yr,pch=shapes[factor(dd$sp)],cex=log(dd$mn.total.runsize)/6,bg=cols[factor(dd$site)])
axis(side=1,labels=c("First","Peak","Med","Last"), at = c(1,2,3,4))
dev.off()
