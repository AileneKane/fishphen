#do for 3 regions
podcols<-c("Jpres", "Kpres", "Lpres", "AllSRpres")
pods<-c("J","K","L","SRs")
for(p in 1:length(podcols)){
quartz(width=16,height=6)
par(omi=c(.5,2,.5,.5), mfrow=c(1,3))
colnum<-which(colnames(orcasum.days)==podcols[p])
regions=unique(orcasum.days$region)
for(r in regions){
regdat<-orcasum.days[orcasum.days$region==r,]
years = unique(orcasum.days$year)
plot(0, type = 'n', las=1, xlim=c(1,366),ylim=c(min(as.numeric(years)),max(as.numeric(years))),ylab="",xlab="Day of year", main=paste(r), cex.axis=1.1, cex.lab=1.3)
for(y in years){
yrdat = regdat[regdat$year==y,]
days = yrdat$day[yrdat[,colnum]==1]
points(x=days,y=rep(y,length=length(days)), pch=21,bg="gray", cex=1.3)
#lines(x=days,y=rep(y,length=length(days)), lwd=2)
}
if(r=="uss"){mtext(paste(pods[p]), side=3,line=3, adj=0.5)}
if(r=="ps"){mtext("Year", side=2,line=4, adj=0.5)}
}
}
#summary of the number of days whales were observed in each region, by year:
pres<-tapply(orcasum.days$AllSRpres,list(orcasum.days$region, orcasum.days$year),sum)
#summary of the number of days whales with rows of data (observed or not) in each region, by year:
totobs<-tapply(orcasum.days$AllSRpres,list(orcasum.days$region, orcasum.days$year),length)
prob<-pres/totobs
#summary of the number of days whales were observed in each region, across all years:
pres.doy<-tapply(orcasum.days$AllSRpres,list(orcasum.days$region, orcasum.days$day),sum)
#summary of the number of days whales with rows of data (observed or not) in each region, across all tears:
totobs.doy<-tapply(orcasum.days$AllSRpres,list(orcasum.days$region, orcasum.days$day),length)
prob.doy<-pres.doy/totobs.doy
quartz()
par(mfrow=c(2,1))
plot(colnames(prob.doy),prob.doy[3,], type="l", ylab="Probability of obs.",xlab="DOY", main="USS")
plot(colnames(prob.doy),prob.doy[2,], type="l", ylab="Probability of obs.",xlab="DOY", main="PS")
#Make box plots to see central tendencies:
# podcols<-c("Jpres", "Kpres", "Lpres", "AllSRpres")
# pods<-c("J","K","L","SRs")
# for(p in 1:length(podcols)){
#   quartz(width=15,height=6)
#   par(mfrow=c(1,3))
#   colnum<-which(colnames(orcasum.days)==podcols[p])
#   regions=unique(orcasum.days$region)
#   for(r in regions){
#     regdat<-orcasum.days[orcasum.days$region==r,]
#     if (r=="ps"){
#      regdat<-regdat[as.numeric(regdat$day)>273,]#look at data only after Sept 30 for PS
#     }
#         boxplot(as.numeric(regdat$day)~as.factor(regdat$year),
#             horizontal=TRUE,las=1,
#             ylab="year",xlab="DOY",main=paste(r))
#
#     if(r=="uss"){mtext(paste(pods[p]), side=3,line=2, adj=0.5)}
#
#   }
# }
#
#Add days after sept 30:
orcasum.days$daysaftsept30<-NA
orcasum.days$day<-as.numeric(orcasum.days$day)
orcasum.days$year<-as.numeric(orcasum.days$year)
orcasum.days$daysaftsept30[which(orcasum.days$day>273 & orcasum.days$day<367)]<-orcasum.days$day[which(orcasum.days$day>273 & orcasum.days$day<367)]-273
orcasum.days$daysaftsept30[which(orcasum.days$day<274)]<-orcasum.days$day[which(orcasum.days$day<274)]+93#
#add an "orca year" which runs Oct 1-Sept 31
orcasum.days$orcayear<-orcasum.days$year
orcasum.days$orcayear[which(orcasum.days$day>273)]<-orcasum.days$year[which(orcasum.days$day>273)]+1
#Add days after June 30:
orcasum.days$daysaftjun30[which(orcasum.days$day>179 & orcasum.days$day<367)]<-orcasum.days$day[which(orcasum.days$day>179 & orcasum.days$day<367)]-179
orcasum.days$daysaftjun30[which(orcasum.days$day<180)]<-orcasum.days$day[which(orcasum.days$day<180)]+187#
#add an "orca year" which runs Oct 1-Sept 31
orcasum.days$orcayear2<-orcasum.days$year
orcasum.days$orcayear2[which(orcasum.days$day>179)]<-orcasum.days$year[which(orcasum.days$day>179)]+1
#use a shifting window approach to see if trends in first and last obs date vary depending on when the start window is.
#use july 1, aug 1, sept 1, oct 1 as start dats
#use dec 31, jan31, feb 28, and march 31 as end dates
regions=unique(orcasum.days$region)
podcols<-c("AllSRpres")#just do for all SRs for now
pods<-c("SRs")
stdoy<-c(,)
stseas<-c("07","08","09","10")
enseas<-c("12","1","2","03")
regions=unique(orcasum.days$region)
podcols<-c("AllSRpres")#just do for all SRs for now
pods<-c("SRs")
stdoy<-c(,)
head(orcasum.day)
head(orcasum.days)
#add a month column just for reference
orcasum.days$date<-as.Date(paste(orcasum.days$year,orcasum.days$day,sep="-"), "format ="%j )
#add a month column just for reference
orcasum.days$date<-as.Date(paste(orcasum.days$year,orcasum.days$day,sep="-"), "%j" )
head(orcasum.days)
#add a month column just for reference
orcasum.days$date<-strftime(paste(orcasum.days$year,orcasum.days$day,sep="-"), format="%j" )
#add a month column just for reference
orcasum.days$date<-strftime(paste(orcasum.days$year,orcasum.days$day,sep="-"), format="%J" )
#add a month column just for reference
orcasum.days$date<-as.Date(paste(orcasum.days$year,orcasum.days$day,sep="-"), format="%J" )
head(orcasum.days)
#add a month column just for reference
orcasum.days$date<-strptime(paste(orcasum.days$year,orcasum.days$day,sep="-"), format="%J" )
head(orcasum.days)
strptime(paste(orcasum.days$year,orcasum.days$day,sep="-"))
strptime(paste(orcasum.days$year,orcasum.days$day,sep="-"), format="%J")
paste(orcasum.days$year,orcasum.days$day,sep="-")
head(orcasum.days)
as.Date(orcasum.days$day, origin = paste(orcasum.days$year-1,"12-31", sep="-")
#use a shifting window approach to see if trends in first and last obs date vary depending on when the start window is.
#use july 1, aug 1, sept 1, oct 1 as start dats
#use dec 31, jan31, feb 28, and march 31 as end dates
regions=unique(orcasum.days$region)
podcols<-c("AllSRpres")#just do for all SRs for now
pods<-c("SRs")
stdoy<-c(,)#these are in terms of days after June 30
stseas<-c("07","08","09","10")
enseas<-c("12","1","2","03")
for(t in 1:length(stseas)){
styr.date<-as.Date(paste("2019",stseas[t],"1", sep="-"))
styr.doy<-strptime(styr.date,format = "%j")
styr.doy<-strftime(styr.date,format= "%j")
##PICK UP HERE- GETTING DAYS SINCE CHOSEN START DATE!
days2st<-difftime(as.POSIXct(test2), as.POSIXct(test1, tz="UTC"), units="days")
orcasum.days$date<-
}
years<-unique(orcasum.days$orcayear2)#use July 1 as start of orca year, as this will encompass min start date window that i want to try
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
for(r in 1:length(regions)){
regdat<-orcasum.days[orcasum.days$region==regions[r],]
if (regions[r]=="ps"){
regdat<-regdat[as.numeric(regdat$day)>273,]#look at data only after Sept 30 for PS
}
if (regions[r]=="uss"){
regdat<-regdat[as.numeric(regdat$day)<273,]#look at data before Sept 30 for USS
regdat<-regdat[as.numeric(regdat$day)>121,]#look at data after MAy 1 for USS
}
for(y in 1:length(years)){
}
}
}
#See if there is a shift in first, last, mean  by decade
regions=unique(orcasum.days$region)
podcols<-c("Jpres", "Kpres", "Lpres", "AllSRpres")
pods<-c("J","K","L","SRs")
years<-unique(orcasum.days$year)
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.all<-c()
lastest.all<-c()
meanest.all<-c()
firstest.sept30.all<-c()
lastest.sept30.all<-c()
meanest.sept30.all<-c()
firstest.jun30.all<-c()
lastest.jun30.all<-c()
meanest.jun30.all<-c()
for(p in 1:length(podcols)){
colnum<-which(colnames(orcasum.days)==podcols[p])
for(r in 1:length(regions)){
regdat<-orcasum.days[orcasum.days$region==regions[r],]
if (regions[r]=="ps"){
regdat<-regdat[as.numeric(regdat$day)>273,]#look at data only after Sept 30 for PS
}
if (regions[r]=="uss"){
regdat<-regdat[as.numeric(regdat$day)<273,]#look at data before Sept 30 for USS
regdat<-regdat[as.numeric(regdat$day)>121,]#look at data after MAy 1 for USS
}
for(y in 1:length(years)){
yrdat<-regdat[regdat$year==years[y],]
pods.all<-c(pods.all,pods[p])
regions.all<-c(regions.all,regions[r])
years.all<-c(years.all,years[y])
nobs.all<-c(nobs.all,length(yrdat$day[yrdat[,colnum]==1]))
firstest.all<-c(firstest.all,min(yrdat$day[yrdat[,colnum]==1], na.rm=TRUE))
lastest.all<-c(lastest.all,max(yrdat$day[yrdat[,colnum]==1], na.rm=TRUE))
meanest.all<-c(meanest.all,mean(as.numeric(yrdat$day[yrdat[,colnum]==1]), na.rm=TRUE))
orcayrdat<-regdat[regdat$orcayear==years[y],]
orcayrdat2<-regdat[regdat$orcayear2==years[y],]
firstest.sept30.all<-c(firstest.sept30.all,min(orcayrdat$daysaftsept30[orcayrdat[,colnum]==1], na.rm=TRUE))
lastest.sept30.all<-c(lastest.sept30.all,max(orcayrdat$daysaftsept30[orcayrdat[,colnum]==1], na.rm=TRUE))
meanest.sept30.all<-c(meanest.sept30.all,mean(as.numeric(orcayrdat$daysaftsept30[orcayrdat[,colnum]==1]), na.rm=TRUE))
firstest.jun30.all<-c(firstest.jun30.all,min(orcayrdat2$daysaftjun30[orcayrdat2[,colnum]==1], na.rm=TRUE))
lastest.jun30.all<-c(lastest.jun30.all,max(orcayrdat2$daysaftjun30[orcayrdat2[,colnum]==1], na.rm=TRUE))
meanest.jun30.all<-c(meanest.jun30.all,mean(as.numeric(orcayrdat2$daysaftjun30[orcayrdat2[,colnum]==1]), na.rm=TRUE))
}
}
}
df <- as.data.frame(cbind(pods.all,regions.all,years.all,nobs.all,firstest.all,lastest.all,meanest.all,firstest.sept30.all,lastest.sept30.all,meanest.sept30.all,firstest.jun30.all,lastest.jun30.all,meanest.jun30.all))
colnames(df)<-c("pod","region","year","nobs","firstest","lastest","meanest","firstest.sept30","lastest.sept30","meanest.sept30","firstest.jun30","lastest.jun30","meanest.jun30")
#Now fit some linear models and plots
quartz()
par(mfrow=c(3,2))
pod.df=df[df$pod=="SRs",]
pod.df$firstest[which(pod.df$firstest=="Inf")]<-NA
pod.df$lastest[which(pod.df$lastest=="-Inf")]<-NA
pod.df$firstest<-as.numeric(pod.df$firstest)
pod.df$lastest<-as.numeric(pod.df$lastest)
pod.df$meanest=as.numeric(pod.df$meanest)
pod.df$firstest.sept30[which(pod.df$firstest.sept30=="Inf")]<-NA
pod.df$lastest.sept30[which(pod.df$lastest.sept30=="-Inf")]<-NA
pod.df$firstest.jun30[which(pod.df$firstest.jun30=="Inf")]<-NA
pod.df$lastest.jun30[which(pod.df$lastest.jun30=="-Inf")]<-NA
for(i in 1:length(regions)){
reg.df=pod.df[pod.df$region==regions[i],]
reg.df$year=as.numeric(reg.df$year)
#if(regions[i]=="ps" & unique(reg.df$pod)=="SRs"){reg.df<-reg.df[1:40,]}
#if(regions[i]=="uss"& unique(reg.df$pod)=="SRs"){reg.df[81:120,]}
#first obs
plot(reg.df$year,reg.df$firstest,xlab="year",ylab="first obs doy", main=paste(unique(reg.df$pod)), bty="l", pch=21, bg="gray")
mod<-lm(reg.df$firstest~reg.df$year)
abline(mod)
mtext(paste("r2=",round(summary(mod)$r.squared, digits=2),",p=",round(summary(mod)$coeff[2,4], digits=2)), side=3, adj=1, cex=0.7)
mtext(paste("coef=",round(summary(mod)$coeff[2,1], digits=2)), side=3,line=-1, adj=1, cex=0.7)
#last obs
plot(reg.df$year,reg.df$lastest,xlab="year",ylab="last obs doy", main=paste(regions[i]), bty="l", pch=21, bg="gray")
mod<-lm(reg.df$lastest~reg.df$year)
mtext(paste("r2=",round(summary(mod)$r.squared, digits=2),",p=",round(summary(mod)$coeff[2,4], digits=2)), side=3, adj=1, cex=0.7)
abline(mod)
mtext(paste("coef=",round(summary(mod)$coeff[2,1], digits=2)), side=3,line=-1, adj=1, cex=0.7)
# #mean obs
# plot(reg.df$year,reg.df$meanest,xlab="year",ylab="mean obs doy", main="", bty="l", pch=21, bg="gray")
# mod<-lm(reg.df$meanest~reg.df$year)
# mtext(paste("r2=",round(summary(mod)$r.squared, digits=2),",p=",round(summary(mod)$coeff[2,4], digits=2)), side=3, adj=1, cex=0.7)
# abline(mod)
# mtext(paste("coef=",round(summary(mod)$coeff[2,1], digits=2)), side=3,line=-1, adj=1, cex=0.7)
#
# #duration
# plot(reg.df$year,reg.df$duration,xlab="year",ylab="duration (days)", main="", bty="l", pch=21, bg="gray")
# mod<-lm(reg.df$duration~reg.df$year)
# mtext(paste("r2=",round(summary(mod)$r.squared, digits=2),",p=",round(summary(mod)$coeff[2,4], digits=2)), side=3, adj=1, cex=0.7)
# mtext(paste("coef=",round(summary(mod)$coeff[2,1], digits=2)), side=3,line=-1, adj=1, cex=0.7)
#
# abline(mod)
#
#using days since sept 30 does not change much!
#first obs after sept 30
#plot(reg.df$year,reg.df$firstest.sept30,xlab="year",ylab="first obs day after sept 30", main="all srs", bty="l", pch=21, bg="gray")
#mod<-lm(reg.df$firstest.sept30~reg.df$year)
#abline(mod)
#mtext(paste("r2=",round(summary(mod)$r.squared, digits=2),",p=",round(summary(mod)$coeff[2,4], digits=2)), side=3, adj=1, cex=0.7)
#last obs days after sept 30
#plot(reg.df$year,reg.df$lastest.sept30,xlab="year",ylab="last obs day after sept 30", main=paste(regions[i]), bty="l", pch=21, bg="gray")
#mod<-lm(reg.df$lastest.sept30~reg.df$year)
#mtext(paste("r2=",round(summary(mod)$r.squared, digits=2),",p=",round(summary(mod)$coeff[2,4], digits=2)), side=3, adj=1, cex=0.7)
#abline(mod)
#mean obs
#plot(reg.df$year,reg.df$meanest.sept30,xlab="year",ylab="mean obs day after sept 30", main="", bty="l", pch=21, bg="gray")
#mod<-lm(reg.df$meanest.sept30~reg.df$year)
#mtext(paste("r2=",round(summary(mod)$r.squared, digits=2),",p=",round(summary(mod)$coeff[2,4], digits=2)), side=3, adj=1, cex=0.7)
#abline(mod)
}
#Make boxplots similar to the way that i made them for test data
cbind(df$nobs[df$pod=="SRs"],df$year[df$pod=="SRs"])
pod.df=df[df$pod=="SRs",]
pod.df$firstest[which(pod.df$firstest=="Inf")]<-NA
pod.df$lastest[which(pod.df$lastest=="-Inf")]<-NA
pod.df$firstest<-as.numeric(pod.df$firstest)
pod.df$lastest<-as.numeric(pod.df$lastest)
pod.df$meanest=as.numeric(pod.df$meanest)
pod.df$decade<-"1976-1987"
pod.df$decade[pod.df$year>1987]<-"1988-1997"
pod.df$decade[pod.df$year>1997]<-"1998-2007"
pod.df$decade[pod.df$year>2007]<-"2008-2017"
pod.df$period<-"1976-1997"
pod.df$period[pod.df$year>1997]<-"1998-2017"
quartz()
par(mfrow=c(1,2))
#First obs
boxplot(as.numeric(pod.df$firstest[pod.df$region=="ps"])~as.factor(pod.df$decade[pod.df$region=="ps"]), xlab="Decade", ylab="Estimate of first obs (doy) in PS", main="First obs")
#Last obs
boxplot(as.numeric(pod.df$lastest[pod.df$region=="ps"])~as.factor(pod.df$decade[pod.df$region=="ps"]), xlab="Decade", ylab="Estimate of last obs (doy) in PS", main="Last obs")
quartz()
par(mfrow=c(1,2))
#First obs
boxplot(as.numeric(pod.df$firstest[pod.df$region=="ps"])~as.factor(pod.df$period[pod.df$region=="ps"]), xlab="Period", ylab="Estimate of first obs (doy) in PS", main="First obs")
t<-t.test(as.numeric(pod.df$firstest[pod.df$region=="ps"])~pod.df$period[pod.df$region=="ps"], paired = FALSE, var.equal = FALSE,conf.level=0.95)
mtext(paste("Change=",-1*round(t$estimate[1]-t$estimate[2], digits=1),"(",-1*round(t$conf.int[1],digits=1),",",-1*round(t$conf.int[2],digits=1),")", sep=""),side=3,line=-3, adj=1)
#Last obs
boxplot(as.numeric(pod.df$lastest[pod.df$region=="ps"])~as.factor(pod.df$period[pod.df$region=="ps"]), xlab="Period", ylab="Estimate of last obs (doy) in PS", main="Last obs")
t<-t.test(as.numeric(pod.df$lastest[pod.df$region=="ps"])~as.factor(pod.df$period[pod.df$region=="ps"]), conf.level=0.95)
mtext(paste("Change=",-1*round(t$estimate[1]-t$estimate[2], digits=1),"(",-1*round(t$conf.int[1],digits=1),",",-1*round(t$conf.int[2],digits=1),")", sep=""),side=1,line=-3, adj=1)
##Number of consecutive days
doy<- strptime(paste(orcasum.days$day,orcasum.days$year, sep="-"),format = "%j")
orcasum.days$date<-paste(orcasum.days$year,substr(doy,6,10), sep="-")
runchecker <- function(data, days){
data %>% arrange(date) %>%
group_by(AllSRpres) %>%
mutate(diff = c(0, diff(date)),
periodID = 1 + cumsum(diff > days)) %>%
group_by(ID, periodID) %>%
summarise(days = last(date) - first(date))
}
#p=4 for "ALLSRpres"
for(p in 1:length(podcols)){
quartz(width=15,height=6)
par(mfrow=c(1,3))
colnum<-which(colnames(orcasum.days)==podcols[p])
regions=unique(orcasum.days$region)
for(r in regions){
regdat<-orcasum.days[orcasum.days$region==r,]
orcaobs<-subset(regdat, select=c(AllSRpres,date))]
orcaobs$date<-as.Date(orcaobs$date)
runchecker(orcaobs,1)
runchecker(orcaobs$AllSRpres,)
}
}
df <- orcasum.days[order(orcasum.days$region,orcasum.days$date),]
df <- df[!duplicated(df[,c("region","date")]),]
df$last_Date <- as.Date(c("1979-08-16 ",df[1:nrow(df)-1,]$date))
df$Date <- as.Date(df$date)
df$diff <- df$Date - df$last_Date
df$last_region <- c(0,df[1:nrow(df)-1,]$region)
df$diff_region <- ifelse(df$region == df$last_region,0,1)
df$flag <- ifelse(df$diff==1 & df$diff_region==0,0,1)
consecutive_count <- function(x)  {
x <- !x
rl <- rle(x)
len <- rl$lengths
v <- rl$values
cumLen <- cumsum(len)
z <- x
# replace the 0 at the end of each zero-block in z by the
# negative of the length of the preceding 1-block....
iDrops <- c(0, diff(v)) < 0
z[ cumLen[ iDrops ] ] <- -len[ c(iDrops[-1],FALSE) ]
# ... to ensure that the cumsum below does the right thing.
# We zap the cumsum with x so only the cumsums for the 1-blocks survive:
x*cumsum(z)
}
df$Consecutive <- consecutive_count(df$flag)
podcols<-c("Jpres", "Kpres", "Lpres", "AllSRpres")
pods<-c("J","K","L","SRs")
if (r=="ps"){
regdat<-regdat[as.numeric(regdat$day)>273,]#look at data only after Sept 30 for PS
}
boxplot(as.numeric(regdat$day)~as.factor(regdat$year),
horizontal=TRUE,las=1,
ylab="year",xlab="DOY",main=paste(r))
if(r=="uss"){mtext(paste(pods[p]), side=3,line=2, adj=0.5)}
}
}
as.Date(orcasum.days$day, origin = paste(orcasum.days$year-1,"12-31", sep="-"))
#add a month column just for reference
orcasum.days$date<-as.Date(orcasum.days$day, origin = paste(orcasum.days$year-1,"12-31", sep="-"))
head(orcasum.days)
orcasum.days$mon<-substr(orcasum.days$date,6,7)
head(orcasum.days)
orcasum.days$daysaftjun30[substr(orcasum.days$date,6,10)=="07-01"]
> orcasum.days[substr(orcasum.days$date,6,10)=="07-01",]
orcasum.days[substr(orcasum.days$date,6,10)=="07-01",]
#Add days after June 30:
orcasum.days$daysaftjun30[which(orcasum.days$day>182 & orcasum.days$day<367)]<-orcasum.days$day[which(orcasum.days$day>181 & orcasum.days$day<367)]-181
orcasum.days$daysaftjun30[which(orcasum.days$day<183)]<-orcasum.days$day[which(orcasum.days$day<183)]+183#
#add an "orca year" which runs Oct 1-Sept 31
orcasum.days$orcayear2<-orcasum.days$year
#Add days after June 30:
orcasum.days$daysaftjun30[which(orcasum.days$day>182 & orcasum.days$day<367)]<-orcasum.days$day[which(orcasum.days$day>182 & orcasum.days$day<367)]-181
orcasum.days$daysaftjun30[which(orcasum.days$day<183)]<-orcasum.days$day[which(orcasum.days$day<183)]+183#
#add an "orca year" which runs Oct 1-Sept 31
orcasum.days$orcayear2<-orcasum.days$year
orcasum.days$orcayear2[which(orcasum.days$day>179)]<-orcasum.days$year[which(orcasum.days$day>179)]+1
#add a month column just for reference
orcasum.days$date<-as.Date(orcasum.days$day, origin = paste(orcasum.days$year-1,"12-31", sep="-"))
orcasum.days$mon<-substr(orcasum.days$date,6,7)
regions=unique(orcasum.days$region)
podcols<-c("AllSRpres")#just do for all SRs for now
pods<-c("SRs")
stseas<-c("07","08","09","10")
stdays<-c(1,)#in days since jun 30
#create a new column for each start date we want to have
orcasum.days$st.1jul<-as.Date(paste(orcasum.days$year-1,"07-01", sep="-"))
orcasum.days$st.1aug<-as.Date(paste(orcasum.days$year-1,"08-01", sep="-"))
orcasum.days$st.1sep<-as.Date(paste(orcasum.days$year-1,"09-01", sep="-"))
orcasum.days$st.1oct<-as.Date(paste(orcasum.days$year-1,"10-01", sep="-"))
#Create dataframe with first, last obs for each start date in each year
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.1jul.all<-c()#1
firstest.1aug.all<-c()
firstest.1sep.all<-c()
firstest.1oct.all<-c()
lastest.31dec.all<-c()
lastest.31jan.all<-c()
lastest.28feb.all<-c()
lastest.31mar.all<-c()
orcasum.days$daysaftjun30[substr(orcasum.days$date,6,10)=="07-01"]
orcasum.days[substr(orcasum.days$date,6,10)=="07-01",]
365-183
182+183
as.numeric(orcasum.days$date-as.Date('2015-03-01',format='%Y-%m-%d'))
orcasum.days$date-as.Date(paste(orcasum.days$year,"06-31",format='%Y-%m-%d'))
orcasum.days$date-as.Date(paste(orcasum.days$year,"06-30",format='%Y-%m-%d'))
orcasum.days$date-as.Date(paste(orcasum.days$year,"06-30"))
orcasum.days$date-as.Date(paste(orcasum.days$year,"06-30", sep="-"))
head(cbind(orcasum.days$date,as.Date(paste(orcasum.days$year,"06-30", sep="-")),orcasum.days$date-as.Date(paste(orcasum.days$year,"06-30", sep="-"))))
orcasum.days$date
365-150
as.Date(paste(orcasum.days$year,"06-30", sep="-"))+215
head(cbind(orcasum.days$date,as.Date(paste(orcasum.days$year,"06-30", sep="-")),orcasum.days$date-as.Date(paste(orcasum.days$year,"06-30", sep="-"))))
head(cbind(orcasum.days)
)
orcasum.days$date<-as.Date(orcasum.days$day, origin = paste(orcasum.days$year-1,"12-31", sep="-"))
orcasum.days$mon<-substr(orcasum.days$date,6,7)
#orcasum.days$date-as.Date(paste(orcasum.days$year,"06-30", sep="-"))
#head(cbind(orcasum.days$date,as.Date(paste(orcasum.days$year,"06-30", sep="-")),orcasum.days$date-as.Date(paste(orcasum.days$year,"06-30", sep="-"))))
#Add days after June 30:
orcasum.days$daysaftjun30[which(orcasum.days$day>182 & orcasum.days$day<367)]<-orcasum.days$day[which(orcasum.days$day>182 & orcasum.days$day<367)]-182
orcasum.days$daysaftjun30[which(orcasum.days$day<183)]<-orcasum.days$day[which(orcasum.days$day<183)]+182#
#the above does not work quite right becuase of leap years...
#add an "orca year" which runs jul 1-jun 30
orcasum.days$orcayear<-orcasum.days$year
orcasum.days$orcayear[which(orcasum.days$day>179)]<-orcasum.days$year[which(orcasum.days$day>179)]+1
#add a month column just for reference
#add an "orca year" which runs jul 1-jun 30
orcasum.days$orcayear<-orcasum.days$year
orcasum.days$orcayear[which(orcasum.days$day>182)]<-orcasum.days$year[which(orcasum.days$day>182)]+1
regions=unique(orcasum.days$region)
podcols<-c("AllSRpres")#just do for all SRs for now
pods<-c("SRs")
stseas<-c("07","08","09","10")
stdays<-c(1,)#in days since jun 30
#create a new column for each start date we want to have
orcasum.days$st.1jul<-as.Date(paste(orcasum.days$year-1,"07-01", sep="-"))
orcasum.days$st.1aug<-as.Date(paste(orcasum.days$year-1,"08-01", sep="-"))
#create a new column for each start date we want to have
orcasum.days$st.1jul<-as.Date(paste(orcasum.days$year-1,"07-01", sep="-"))
orcasum.days$st.1aug<-as.Date(paste(orcasum.days$year-1,"08-01", sep="-"))
orcasum.days$st.1sep<-as.Date(paste(orcasum.days$year-1,"09-01", sep="-"))
orcasum.days$st.1oct<-as.Date(paste(orcasum.days$year-1,"10-01", sep="-"))
#Create dataframe with first, last obs for each start date in each year
pods.all<-c()
regions.all<-c()
years.all<-c()
nobs.all<-c()
firstest.1jul.all<-c()#1
firstest.1aug.all<-c()
firstest.1sep.all<-c()
firstest.1oct.all<-c()
lastest.31dec.all<-c()
lastest.31jan.all<-c()
lastest.28feb.all<-c()
lastest.31mar.all<-c()
head(orcasum.days$st.1oct)
head(orcasum.days)
p=1
r=1
s=1
stseas
stday<-paste(stseas[s],"01")
stday
stday
stdays<-c(1,32,63,93)
stday<-stdays[s]
stday
regdat<-regdat[as.numeric(regdat$daysaftjun30)>=s-1,]#look at data only after Sept 30 for PS
head(regdat)
#     }
#         boxplot(as.numeric(regdat$day)~as.factor(regdat$year),
#             horizontal=TRUE,las=1,
#             ylab="year",xlab="DOY",main=paste(r))
#
#     if(r=="uss"){mtext(paste(pods[p]), side=3,line=2, adj=0.5)}
#
#   }
# }
#
orcasum.days$date<-as.Date(orcasum.days$day, origin = paste(orcasum.days$year-1,"12-31", sep="-"))
orcasum.days$mon<-substr(orcasum.days$date,6,7)
#orcasum.days$date-as.Date(paste(orcasum.days$year,"06-30", sep="-"))
#head(cbind(orcasum.days$date,as.Date(paste(orcasum.days$year,"06-30", sep="-")),orcasum.days$date-as.Date(paste(orcasum.days$year,"06-30", sep="-"))))
#Add days after June 30:
orcasum.days$daysaftjun30[which(orcasum.days$day>182 & orcasum.days$day<367)]<-orcasum.days$day[which(orcasum.days$day>182 & orcasum.days$day<367)]-182
orcasum.days$daysaftjun30[which(orcasum.days$day<183)]<-orcasum.days$day[which(orcasum.days$day<183)]+182#
#add an "orca year" which runs jul 1-jun 30
orcasum.days$orcayear<-orcasum.days$year
orcasum.days$orcayear[which(orcasum.days$day>182)]<-orcasum.days$year[which(orcasum.days$day>182)]+1
head(orcasum.days)
regdat<-regdat[as.numeric(regdat$daysaftjun30)>=273,]#stop looking at data after mar31
r
regsions[r]
regions[r]
r=2
regdat<-orcasum.days[orcasum.days$region==regions[r],]
if (regions[r]=="ps"){
stday<-stdays[s]
regdat<-regdat[as.numeric(regdat$daysaftjun30)>=s-1,]#look at data only after Sept 30 for PS
regdat<-regdat[as.numeric(regdat$daysaftjun30)>=273,]#stop looking at data after mar31
}
if (regions[r]=="uss"){
regdat<-regdat[as.numeric(regdat$day)<273,]#look at data before Sept 30 for USS
regdat<-regdat[as.numeric(regdat$day)>121,]#look at data after May 1 for USS
}
head(regdat)
stday<-paste(stseas[s],"01",)
stday
stday<-paste(stseas[s],"01")
stday
s
stseas
yrdat<-regdat[regdat$year==years[y],]
pods.all<-c(pods.all,pods[p])
regions.all<-c(regions.all,regions[r])
years.all<-c(years.all,years[y])
nobs.all<-c(nobs.all,length(yrdat$day[yrdat[,colnum]==1]))
colnum
yrdat[,colnum]
head(yrdat)
