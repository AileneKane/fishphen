arrows(x,ylci,x,yuci, code=3, length=0)
points(x,y,cex=2,bg="salmon",pch=23)
#y<-c(albionfa$first.yr,albionfa$mid.yr,albionfa$pk.yr,albionfa$last.yr)
#points(x,y,cex=2,bg="darkblue",pch=23)
psshifts<-psshifts[,-2]
y<-c(psshifts[4,])
ylci<-c(as.numeric(psshifts[5,]))
yuci<-c(as.numeric(psshifts[6,]))
plot(x,y,pch=23,bg="salmon",ylab= "",xaxt="n", xlab="",xlim=c(0,5), ylim=c(-3,7),bty="l", cex=2)
abline(h=0,lty=2)
arrows(x,ylci,x,yuci, code=3, length=0)
points(x,y,cex=2,bg="salmon",pch=23)
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
quartz(width=12, height=10)
par(mfcol=c(2,2),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first.20012016"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,7), bty="l", cex=2)
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first.20012016"],x,all2$slope.uci[all2$phase=="first.20012016"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak.20012016"],x+1,all2$slope.uci[all2$phase=="peak.20012016"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last.20012016"],x+2,all2$slope.uci[all2$phase=="last.20012016"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first.20012016"],pch=c(21,22,24),bg="darkblue", cex=2)
points(x+1,all2$slope.mn[all2$phase=="peak.20012016"],pch=c(21,22,24),bg="darkblue", cex=2)
points(x+2,all2$slope.mn[all2$phase=="last.20012016"],pch=c(21,22,24),bg="darkblue", cex=2)
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
mtext("SRKWs 2001-2016",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
mtext("A)",side=3,line=0, adj=-1)
mtext("A)",side=3,line=0, adj=0)
pdf(file="analyses/figures/srkw_salmon_recentshifts_lm.pdf",width=12,height=10)
###dev.off() plot estimates of peak occurrence prob over all years
#quartz(width=12, height=10)
#par(mfcol=c(2,3),mai=c(.5,1,.5,0.5))
par(mfcol=c(2,2),mai=c(.5,1,.5,0.5))
x<-rep(1,times=3)
#Central salish sea first...
plot(x,all2$slope.mn[all2$phase=="first.20012016"],pch=c(21,22,24),bg="darkblue", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,7), bty="l", cex=2)
abline(h=0,lty=2)
arrows(x,all2$slope.lci[all2$phase=="first.20012016"],x,all2$slope.uci[all2$phase=="first.20012016"], code=3, length=0)
arrows(x+1,all2$slope.lci[all2$phase=="peak.20012016"],x+1,all2$slope.uci[all2$phase=="peak.20012016"], code=3, length=0)
arrows(x+2,all2$slope.lci[all2$phase=="last.20012016"],x+2,all2$slope.uci[all2$phase=="last.20012016"], code=3, length=0)
points(x,all2$slope.mn[all2$phase=="first.20012016"],pch=c(21,22,24),bg="darkblue", cex=2)
points(x+1,all2$slope.mn[all2$phase=="peak.20012016"],pch=c(21,22,24),bg="darkblue", cex=2)
points(x+2,all2$slope.mn[all2$phase=="last.20012016"],pch=c(21,22,24),bg="darkblue", cex=2)
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
#mtext("SRKWs 2001-2016",side=3,line=0)
legend("topleft",legend=c("J pod","K pod","L pod"),pch=c(21,22,24), bty="n",pt.bg="darkblue")
mtext("A)",side=3,line=0, adj=0)
#Puget sound proper
plot(x,all1$slope.mn[all1$phase=="first.20012016"],pch=c(21,22,24),bg="goldenrod", ylab= "Change in timing (days/year)",xaxt="n", xlab="",xlim=c(0,4),ylim=c(-3,7), bty="l", cex=2)
abline(h=0,lty=2)
arrows(x,all1$slope.lci[all1$phase=="first.20012016"],x,all1$slope.uci[all1$phase=="first.20012016"], code=3, length=0)
arrows(x+1,all1$slope.lci[all1$phase=="peak.20012016"],x+1,all1$slope.uci[all1$phase=="peak.20012016"], code=3, length=0)
arrows(x+2,all1$slope.lci[all1$phase=="last.20012016"],x+2,all1$slope.uci[all1$phase=="last.20012016"], code=3, length=0)
points(x,all1$slope.mn[all1$phase=="first.20012016"],pch=c(21,22,24),bg="goldenrod", cex=2)
points(x+1,all1$slope.mn[all1$phase=="peak.20012016"],pch=c(21,22,24),bg="goldenrod", cex=2)
points(x+2,all1$slope.mn[all1$phase=="last.20012016"],pch=c(21,22,24),bg="goldenrod", cex=2)
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
#dev.off()
x<-c(1,2,3)
y<-c(albionshifts$est[2],albionshifts$est[6],albionshifts$est[4])
ylci<-c(albionshifts$ci25[2],albionshifts$ci25[6],albionshifts$ci25[4])
yuci<-c(albionshifts$ci75[2],albionshifts$ci75[6],albionshifts$ci75[4])
mtext("B)",side=3,line=0, adj=0)
plot(x,y,pch=23,bg="salmon",ylab= "",xaxt="n", xlab="",xlim=c(0,5), ylim=c(-3,7),bty="l", cex=2)
abline(h=0,lty=2)
arrows(x,ylci,x,yuci, code=3, length=0)
points(x,y,cex=2,bg="salmon",pch=23)
mtext("C)",side=3,line=0, adj=0)
#y<-c(albionfa$first.yr,albionfa$mid.yr,albionfa$pk.yr,albionfa$last.yr)
#points(x,y,cex=2,bg="darkblue",pch=23)
y<-c(psshifts[4,])
ylci<-c(as.numeric(psshifts[5,]))
yuci<-c(as.numeric(psshifts[6,]))
plot(x,y,pch=23,bg="salmon",ylab= "",xaxt="n", xlab="",xlim=c(0,5), ylim=c(-3,7),bty="l", cex=2)
abline(h=0,lty=2)
arrows(x,ylci,x,yuci, code=3, length=0)
points(x,y,cex=2,bg="salmon",pch=23)
mtext("D)",side=3,line=0, adj=0)
axis(side=1,labels=c("First","Peak","Last"), at = c(1,2,3))
dev.off()
#12. Relate limekiln data to chinook phenology in the Fraser river
albchin<-read.csv("analyses/output/albionchiphen_allyear.csv", header = TRUE)
#restrict to years that we have SRKW data for
albchin95<-albchin[albchin$year>1993  & albchin$year<2018,]
albchin95<-albchin95[-which(albchin95$year==2014),]
albchinest95<-albchinest[albchinest$year>1993  & albchinest$year<2018,]
albchinest95<-albchinest95[-which(albchinest95$year==2014),]
#Only use fishing areas that have atleast 4 years with >20 observations:
#Look at some basic stats about orca observations
#Started with orca_dataprep_occmodel.R code
#4 February 2019
#housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
# Set working directory:
setwd("~/Documents/GitHub/fishphen")#setwd("~/GitHub/fishphen")
#or from laptop:
#setwd("/Users/aileneettinger/Documents/GitHub/fishphen")
# Load libraries
library(dplyr)
library(mgcv)
library(scales)
library(RColorBrewer)
library(rworldmap)
library(scales)
library(matrixStats)
library(igraph)
# 1. Choose the years, regions of interest, assumption about reports in the OrcaMaster and get the data
includeCanada=TRUE
firstyear=1976#probably set to 1975 or 1976 (Olson et al)
assumeSRKW=FALSE #If true, assume that "Orcas" means SRKW unless noted otherwuse (i.e. Transients or NRKWs)
use3regions=FALSE#If true, separate out the straight of Juan de Fuca as a 3rd region, distinct from CSS and PS (all code not yet working for 3 regions!)
#Set start of seasons
ps.start<-182#July 1 = 182
uss.start<-91#April 1 = 91,
d <- read.csv("data/AppendixII.csv")
quads<-read.csv("data/QuadCentroids.csv")
dim(d)#105344  18 on Nov 08, 2019
# 2. Clean the data (also saved in output/AppendixII_cleaned,csv)
source("analyses/orcaphen/source/clean_orca.R")
dim(d)#105339     21 on Nov 8, 2019
# 3. Limit space and time to firstyear or later and Salish Sea, Puget Sound, Washington Outer Coast
source("analyses/orcaphen/source/orca_limitspacetime.R")
dim(d)#102435      22
#table(d$FishArea,d$region)#check regions are correct
#4. Get data in terms of number of observations per day and "whale days": days on which whales were seen (presence/absence for each day)
source("analyses/orcaphen/source/orca_get_whaledays.R")
#5. Summarize and plot whale days
wdays<-as.data.frame(tapply(orcasum.days$AllSRpres,list(orcasum.days$year,orcasum.days$region),sum))
wdays.J<-as.data.frame(tapply(orcasum.days$Jpres,list(orcasum.days$year,orcasum.days$region),sum))
wdays.K<-as.data.frame(tapply(orcasum.days$Kpres,list(orcasum.days$year,orcasum.days$region),sum))
wdays.L<-as.data.frame(tapply(orcasum.days$Lpres,list(orcasum.days$year,orcasum.days$region),sum))
source("analyses/orcaphen/source/orca_plot_whaledays.R")
#7. Make a map of the SRKW sightings in ps and uss
source("analyses/orcaphen/source/orca_makemap.R")
#8. Fit some basic linear models to all srkw data
regions=unique(orcasum.days$region)
podcols<-c("Jpres","Kpres","Lpres","AllSRpres")
pods<-c("J", "K","L","SRs")
source("analyses/orcaphen/source/orca_runlinmods.R")
#9. Fit some basic linear models to lime kiln data only
limed<-d[d$Source=="TWM-Otis",]
limed<-limed[which(!is.na(limed$SightDate)),]
source("analyses/orcaphen/source/orca_runlinmods_lime.R")
#12. Relate limekiln data to chinook phenology in the Fraser river
albchin<-read.csv("analyses/output/albionchiphen_allyear.csv", header = TRUE)
#restrict to years that we have SRKW data for
albchin95<-albchin[albchin$year>1993  & albchin$year<2018,]
albchin95<-albchin95[-which(albchin95$year==2014),]
albchinest95<-albchinest[albchinest$year>1993  & albchinest$year<2018,]
albchinest95<-albchinest95[-which(albchinest95$year==2014),]
#alternate version of the above with binned chinook arrival dates
albchin95$firstobsbin<-NA
lower<-quantile(albchin95$firstobsdate,prob=0.25, na.rm=TRUE)
upper<-quantile(albchin95$firstobsdate,prob=0.75, na.rm=TRUE)
albchin95$firstobsbin[albchin95$firstobsdate<=lower]<-"1"
albchin95$firstobsbin[albchin95$firstobsdate>lower]<-"2"
albchin95$firstobsbin[albchin95$firstobsdate>upper]<-"3"
albchin95$firstobsbin<-as.numeric(albchin95$firstobsbin)
#lime.df$year.cor<-lime.df$year+1
lime2002<-lime.df[lime.df$year>2001,]
lime2002<-lime2002[lime2002$year!=2018,]
lime2002$firstest<-as.numeric(lime2002$firstest.all)+90
lime2002$mean<-as.numeric(lime2002$mean.all)+90
lime2002$lastest<-as.numeric(lime2002$lastest.all)+90
lime1995<-lime.df[lime.df$year>1994,]
lime1995<-lime1995[lime1995$year!=2018,]
lime1995$firstest<-as.numeric(lime1995$firstest.all)+90
lime1995$mean<-as.numeric(lime1995$mean.all)+90
lime1995$lastest<-as.numeric(lime1995$lastest.all)+90
quartz(height=4,width=12)
myPalette <- colorRampPalette(brewer.pal(length(unique(albchin95$year)), "Blues")) #### Gives us a heat map look
cols = rev(myPalette(length(unique(albchin95$year))))
par(mfrow=c(1,3))
plot(albchin95$firstobsdate,lime.df$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
albchin95$firstobsdate
lime.df$firstest.all
length(lime.df$firstest.all)
length(albchin95$firstobsdate)
albchin95
albchin95$year
lime.df$year
plot(albchin95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
lime1995
lime1995$year
albchin95
albchin95$year
lime1995$year
#restrict to years that we have SRKW data for
albchinest<-read.csv("analyses/output/albionchiphenest.csv", header = TRUE)
albchin95<-albchinest[albchinest$year>1993  & albchinest$year<2018,]
#12. Relate limekiln data to chinook phenology in the Fraser river
albchin<-read.csv("analyses/output/albionchiphen_allyear.csv", header = TRUE)
#restrict to years that we have SRKW data for
albchinest<-read.csv("analyses/output/albionchiphenest.csv", header = TRUE)
albchin95<-albchin[albchin$year>1993  & albchin$year<2018,]
#albchin95<-albchin95[-which(albchin95$year==2014),]
albchinest95<-albchinest[albchinest$year>1993  & albchinest$year<2018,]
#alternate version of the above with binned chinook arrival dates
albchin95$firstobsbin<-NA
lower<-quantile(albchin95$firstobsdate,prob=0.25, na.rm=TRUE)
upper<-quantile(albchin95$firstobsdate,prob=0.75, na.rm=TRUE)
albchin95$firstobsbin[albchin95$firstobsdate<=lower]<-"1"
albchin95$firstobsbin[albchin95$firstobsdate>lower]<-"2"
albchin95$firstobsbin[albchin95$firstobsdate>upper]<-"3"
albchin95$firstobsbin<-as.numeric(albchin95$firstobsbin)
#lime.df$year.cor<-lime.df$year+1
lime2002<-lime.df[lime.df$year>2001,]
lime2002<-lime2002[lime2002$year!=2018,]
lime2002$firstest<-as.numeric(lime2002$firstest.all)+90
lime2002$mean<-as.numeric(lime2002$mean.all)+90
lime2002$lastest<-as.numeric(lime2002$lastest.all)+90
lime1995<-lime.df[lime.df$year>1994,]
lime1995<-lime1995[lime1995$year!=2018,]
lime1995$firstest<-as.numeric(lime1995$firstest.all)+90
lime1995$mean<-as.numeric(lime1995$mean.all)+90
lime1995$lastest<-as.numeric(lime1995$lastest.all)+90
quartz(height=4,width=12)
myPalette <- colorRampPalette(brewer.pal(length(unique(albchin95$year)), "Blues")) #### Gives us a heat map look
cols = rev(myPalette(length(unique(albchin95$year))))
lime.df
par(mfrow=c(1,3))
plot(albchin95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
albchinest95$firstobsdate
lime1995$firstest.all
length(lime1995$firstest.all)
length(lime1995$year)
lime1995$year
albchinest95$year
albchinest95<-albchinest95[-which(albchinest95$year==2014),]
#restrict to years that we have SRKW data for
albchinest<-read.csv("analyses/output/albionchiphenest.csv", header = TRUE)
albchin95<-albchin[albchin$year>1993  & albchin$year<2018,]
albchin95<-albchin95[-which(albchin95$year==2014),]
albchinest95<-albchinest[albchinest$year>1993  & albchinest$year<2018,]
albchinest95<-albchinest95[-which(albchinest95$year==2014),]
#alternate version of the above with binned chinook arrival dates
albchin95$firstobsbin<-NA
lower<-quantile(albchin95$firstobsdate,prob=0.25, na.rm=TRUE)
upper<-quantile(albchin95$firstobsdate,prob=0.75, na.rm=TRUE)
albchin95$firstobsbin[albchin95$firstobsdate<=lower]<-"1"
albchin95$firstobsbin[albchin95$firstobsdate>lower]<-"2"
albchin95$firstobsbin[albchin95$firstobsdate>upper]<-"3"
albchin95$firstobsbin<-as.numeric(albchin95$firstobsbin)
lime2002<-lime.df[lime.df$year>2001,]
lime2002<-lime2002[lime2002$year!=2018,]
lime2002$firstest<-as.numeric(lime2002$firstest.all)+90
lime2002$mean<-as.numeric(lime2002$mean.all)+90
lime2002$lastest<-as.numeric(lime2002$lastest.all)+90
lime1995<-lime.df[lime.df$year>1994,]
lime1995<-lime1995[lime1995$year!=2018,]
lime1995$firstest<-as.numeric(lime1995$firstest.all)+90
lime1995$mean<-as.numeric(lime1995$mean.all)+90
lime1995$lastest<-as.numeric(lime1995$lastest.all)+90
quartz(height=4,width=12)
myPalette <- colorRampPalette(brewer.pal(length(unique(albchin95$year)), "Blues")) #### Gives us a heat map look
cols = rev(myPalette(length(unique(albchin95$year))))
lime.df
par(mfrow=c(1,3))
plot(albchin95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
albchinest95$year
lime.df$year
#what is the really late salmon year?
#albchin95$year[which(albchin95$firstobsdate==max(albchin95$firstobsdate, na.rm=TRUE))]#2007
points(albchin95$firstobsdate,lime95$firstest.all,pch=21, bg = cols[factor(albchin95$year)],cex=1.5)
plot(albchinest95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
plot(albchin95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
albchinest95$year
lime1995$year
length(lime1995$year)
length(albchinest95$year)
albchin<-read.csv("analyses/output/albionchiphen_allyear.csv", header = TRUE)
#restrict to years that we have SRKW data for
albchinest<-read.csv("analyses/output/albionchiphenest.csv", header = TRUE)
albchin95<-albchin[albchin$year>1993  & albchin$year<2018,]
albchin95<-albchin95[-which(albchin95$year==2014),]
albchinest95<-albchinest[albchinest$year>1993  & albchinest$year<2018,]
albchinest95<-albchinest95[-which(albchinest95$year==2014),]
#alternate version of the above with binned chinook arrival dates
albchin95$firstobsbin<-NA
lower<-quantile(albchin95$firstobsdate,prob=0.25, na.rm=TRUE)
upper<-quantile(albchin95$firstobsdate,prob=0.75, na.rm=TRUE)
albchin95$firstobsbin[albchin95$firstobsdate<=lower]<-"1"
albchin95$firstobsbin[albchin95$firstobsdate>lower]<-"2"
albchin95$firstobsbin[albchin95$firstobsdate>upper]<-"3"
albchin95$firstobsbin<-as.numeric(albchin95$firstobsbin)
#add 90 days to limekiln doy columns to make comparable to chinook
#lime.df$year.cor<-lime.df$year+1
lime2002<-lime.df[lime.df$year>2001,]
lime2002<-lime2002[lime2002$year!=2018,]
lime2002$firstest<-as.numeric(lime2002$firstest.all)+90
lime2002$mean<-as.numeric(lime2002$mean.all)+90
lime2002$lastest<-as.numeric(lime2002$lastest.all)+90
lime1995<-lime.df[lime.df$year>1994,]
lime1995<-lime1995[lime1995$year!=2018,]
lime1995$firstest<-as.numeric(lime1995$firstest.all)+90
lime1995$mean<-as.numeric(lime1995$mean.all)+90
lime1995$lastest<-as.numeric(lime1995$lastest.all)+90
quartz(height=4,width=12)
myPalette <- colorRampPalette(brewer.pal(length(unique(albchin95$year)), "Blues")) #### Gives us a heat map look
cols = rev(myPalette(length(unique(albchin95$year))))
lime.df
par(mfrow=c(1,3))
plot(albchinest95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
albchin<-read.csv("analyses/output/albionchiphen_allyear.csv", header = TRUE)
#restrict to years that we have SRKW data for
albchinest<-read.csv("analyses/output/albionchiphenest.csv", header = TRUE)
albchin95<-albchin[albchin$year>1993  & albchin$year<2018,]
albchin95<-albchin95[-which(albchin95$year==2014),]
albchinest95<-albchinest[albchinest$year>1993  & albchinest$year<2018,]
albchinest95<-albchinest95[-which(albchinest95$year==2014),]
#alternate version of the above with binned chinook arrival dates
albchin95$firstobsbin<-NA
lower<-quantile(albchin95$firstobsdate,prob=0.25, na.rm=TRUE)
upper<-quantile(albchin95$firstobsdate,prob=0.75, na.rm=TRUE)
albchin95$firstobsbin[albchin95$firstobsdate<=lower]<-"1"
albchin95$firstobsbin[albchin95$firstobsdate>lower]<-"2"
albchin95$firstobsbin[albchin95$firstobsdate>upper]<-"3"
albchin95$firstobsbin<-as.numeric(albchin95$firstobsbin)
#add 90 days to limekiln doy columns to make comparable to chinook
#lime.df$year.cor<-lime.df$year+1
lime2002<-lime.df[lime.df$year>2001,]
lime2002<-lime2002[lime2002$year!=2018,]
lime2002$firstest<-as.numeric(lime2002$firstest.all)+90
lime2002$mean<-as.numeric(lime2002$mean.all)+90
lime2002$lastest<-as.numeric(lime2002$lastest.all)+90
lime1995<-lime.df[lime.df$year>=1994,]
lime1995<-lime1995[lime1995$year!=2018,]
lime1995$firstest<-as.numeric(lime1995$firstest.all)+90
lime1995$mean<-as.numeric(lime1995$mean.all)+90
lime1995$lastest<-as.numeric(lime1995$lastest.all)+90
quartz(height=4,width=12)
myPalette <- colorRampPalette(brewer.pal(length(unique(albchin95$year)), "Blues")) #### Gives us a heat map look
cols = rev(myPalette(length(unique(albchin95$year))))
lime.df
par(mfrow=c(1,3))
plot(albchinest95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
#what is the really late salmon year?
#
albchinest95$year
lime1995$year
#9. Fit some basic linear models to lime kiln data only
limed<-d[d$Source=="TWM-Otis",]
limed<-limed[which(!is.na(limed$SightDate)),]
source("analyses/orcaphen/source/orca_runlinmods_lime.R")
unique(limed$Year)
unique(lime.df$Year)
#11.Try the pearse approach to compare to using data at face-value for estimating first/last events
#lime.df contains first, last, mean dates from data face value
#orcasum.days.lime contains whale days
#unique(orcasum.days.lime$AllSRpres)#all presence
source("analyses/orcaphen/source/pearse_fxns.R")
alpha=0.10
k=20
source("analyses/orcaphen/source/orca_runlinmods_lime_pearse.R")
#12. Relate limekiln data to chinook phenology in the Fraser river
albchin<-read.csv("analyses/output/albionchiphen_allyear.csv", header = TRUE)
#restrict to years that we have SRKW data for
albchinest<-read.csv("analyses/output/albionchiphenest.csv", header = TRUE)
albchin95<-albchin[albchin$year>1993  & albchin$year<2018,]
albchin95<-albchin95[-which(albchin95$year==2014),]
albchinest95<-albchinest[albchinest$year>1993  & albchinest$year<2018,]
albchinest95<-albchinest95[-which(albchinest95$year==2014),]
albchin95$year
limed$Year
unique(limed$Year)
unique(lime.df$Year)
unique(lime.df$year)
albchin95<-albchin[albchin$year>1993  & albchin$year<2018,]
albchin95<-albchin95[-which(albchin95$year==2014),]
albchinest95<-albchinest[albchinest$year>1993  & albchinest$year<2018,]
albchinest95<-albchinest95[-which(albchinest95$year==2014),]
#alternate version of the above with binned chinook arrival dates
albchin95$firstobsbin<-NA
lower<-quantile(albchin95$firstobsdate,prob=0.25, na.rm=TRUE)
upper<-quantile(albchin95$firstobsdate,prob=0.75, na.rm=TRUE)
albchin95$firstobsbin[albchin95$firstobsdate<=lower]<-"1"
albchin95$firstobsbin[albchin95$firstobsdate>lower]<-"2"
albchin95$firstobsbin[albchin95$firstobsdate>upper]<-"3"
albchin95$firstobsbin<-as.numeric(albchin95$firstobsbin)
#lime.df$year.cor<-lime.df$year+1
lime2002<-lime.df[lime.df$year>2001,]
lime2002<-lime2002[lime2002$year!=2018,]
lime2002$firstest<-as.numeric(lime2002$firstest.all)+90
lime2002$mean<-as.numeric(lime2002$mean.all)+90
lime2002$lastest<-as.numeric(lime2002$lastest.all)+90
lime1995<-lime.df[lime.df$year>=1994,]
lime1995<-lime1995[lime1995$year!=2018,]
lime1995$firstest<-as.numeric(lime1995$firstest.all)+90
lime1995$mean<-as.numeric(lime1995$mean.all)+90
lime1995$lastest<-as.numeric(lime1995$lastest.all)+90
quartz(height=4,width=12)
myPalette <- colorRampPalette(brewer.pal(length(unique(albchin95$year)), "Blues")) #### Gives us a heat map look
cols = rev(myPalette(length(unique(albchin95$year))))
lime.df
par(mfrow=c(1,3))
plot(albchinest95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
#what is the really late salmon year?
#albchin95$year[which(albchin95$firstobsdate==max(albchin95$firstobsdate, na.rm=TRUE))]#2007
points(albchin95$firstobsdate,lime1995$firstest.all,pch=21, bg = cols[factor(albchin95$year)],cex=1.5)
legend("topleft",legend=c("1994","2017"), pch=21, pt.bg=c(cols[1], cols[length(cols)]), bty="n", cex=1.4)
mod<-lm(lime.df$firstest.all~albchin95$firstobsdate)
plot(albchinest95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
#what is the really late salmon year?
#albchin95$year[which(albchin95$firstobsdate==max(albchin95$firstobsdate, na.rm=TRUE))]#2007
#points(albchin95$firstobsdate,lime1995$firstest.all,pch=21, bg = cols[factor(albchin95$year)],cex=1.5)
legend("topleft",legend=c("1994","2017"), pch=21, pt.bg=c(cols[1], cols[length(cols)]), bty="n", cex=1.4)
mod<-lm(lime.df$firstest.all~albchin95$firstobsdate)
summary(mod)
mod<-lm(lime.df$firstest.all~albchin95$firstobsdate)
if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, lwd=2)}
if(summary(mod)$coef[2,4]<.15 & summary(mod)$coef[2,4]>.05){abline(mod, lty=3,  lwd=2)}
lime.df$firstest.all
lime.df$year
albchin95$year
quartz(height=4,width=12)
pdf(file="analyses/orcaphen/figures/lime_albchin.pdf",height=4,width=12)
myPalette <- colorRampPalette(brewer.pal(length(unique(albchin95$year)), "Blues")) #### Gives us a heat map look
cols = rev(myPalette(length(unique(albchin95$year))))
lime.df
par(mfrow=c(1,3))
plot(albchinest95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
#what is the really late salmon year?
#albchin95$year[which(albchin95$firstobsdate==max(albchin95$firstobsdate, na.rm=TRUE))]#2007
#points(albchin95$firstobsdate,lime1995$firstest.all,pch=21, bg = cols[factor(albchin95$year)],cex=1.5)
legend("topleft",legend=c("1994","2017"), pch=21, pt.bg=c(cols[1], cols[length(cols)]), bty="n", cex=1.4)
mod<-lm(lime.df$firstest.all~albchin95$firstobsdate)
if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, lwd=2)}
if(summary(mod)$coef[2,4]<.15 & summary(mod)$coef[2,4]>.05){abline(mod, lty=3,  lwd=2)}
#points(albchin95$firstobsdate,lime.df$firstest.p,pch=16, col = "blue",cex=1.2)
#mod<-lm(lime.df$firstest.p~albchin95$firstobsdate)
#if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, col="blue")}
#if(summary(mod)$coef[2,4]<.10){abline(mod, lty=3, col = "blue")}
#First obs of SRKW vs total run size
# plot(albchin95$alltotal,lime.df$firstest.all,type="p",pch=16, col = "black",xlab="Chinook Run Size",ylim = c(40,70),ylab="SRKW Arrival DOY", cex=1.2, bty="l")
# mod<-lm(lime.df$firstest.all~albchin95$alltotal)
# if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1)}
# if(summary(mod)$coef[2,4]<.1){abline(mod, lty=3)}
# points(albchin95$alltotal,lime.df$firstest.p,pch=16, col = "blue",cex=1.2)
# mod<-lm(lime.df$firstest.p~albchin95$alltotal)
# if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, col="blue")}
# if(summary(mod)$coef[2,4]<.15){abline(mod, lty=3, col = "blue")}
# #First obs of SRKW vs peak run date
# plot(albchin95$peakobsdate,lime.df$firstest.all,type="p",pch=16, col = "black",xlab="Chinook Peak DOY",ylim = c(40,70),ylab="SRKW Arrival DOY", cex=1.2, bty="l")
# mod<-lm(lime.df$firstest.all~albchin95$peakobsdate)
# if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1)}
# if(summary(mod)$coef[2,4]<.15){abline(mod, lty=3)}
# points(albchin95$peakobsdate,lime.df$firstest.p,pch=16, col = "blue",cex=1.2)
# mod<-lm(lime.df$firstest.p~albchin95$peakobsdate)
# if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, col="blue")}
# if(summary(mod)$coef[2,4]<.15){abline(mod, lty=3, col = "blue")}
#
# #Last obs of SRKW vs last obs of salmon
# plot(albchin95$lastobsdate,lime.df$lastest.all,type="p",pch=16, col = "black",xlab="Chinook Last Obs DOY",ylab="SRKW Departure DOY", cex=1.2, bty="l")
# mod<-lm(lime.df$lastest.all~albchin95$lastobsdate)
# if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1)}
# if(summary(mod)$coef[2,4]<.15){abline(mod, lty=3)}
# points(albchin95$lastobsdate,lime.df$lastest.p,pch=16, col = "blue",cex=1.2)
# mod<-lm(lime.df$lastest.p~albchin95$lastobsdate)
# if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, col="blue")}
# if(summary(mod)$coef[2,4]<.15){abline(mod, lty=3, col = "blue")}
#whale days vs chinook run size
plot(albchin95$alltotal,lime.df$nobs,type="p",pch=21, bg = cols[factor(albchin95$year)],cex.axis=1.3,cex.lab=1.3,xlab="Chinook Abundance (cpue)",ylab="Whale days", cex=1.2, bty="l")
points(albchin95$alltotal,lime.df$nobs,pch=21, bg = cols[factor(albchin95$year)],cex=1.5)
mod<-lm(lime.df$nobs~albchin95$alltotal)
if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, lwd=2)}
if(summary(mod)$coef[2,4]<.15 & summary(mod)$coef[2,4]>.05){abline(mod, lty=3, lwd=2)}
#compare lime kiln phenology to whol region phenology from 2002-2017
#Lastobs of SRKW vs total run size###Could add this
plot(albchin95$alltotal,lime.df$lastest.all,type="p",pch=21, bg = cols[factor(albchin95$year)],cex.axis=1.3,cex.lab=1.3,xlab="Chinook Abundance (cpue)",ylab="SRKW Departure (doy)", cex=1.2, bty="l")
points(albchin95$alltotal,lime.df$lastest.all,pch=21, bg = cols[factor(albchin95$year)],cex=1.5)
mod<-lm(lime.df$lastest.all~albchin95$alltotal)
if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1,lwd=2)}
if(summary(mod)$coef[2,4]<.15 & summary(mod)$coef[2,4]>.05){abline(mod, lty=3,lwd=2)}
# points(albchin95$alltotal,lime.df$lastest.p,pch=16, col = "blue",cex=1.2)
# mod<-lm(lime.df$lastest.p~albchin95$alltotal)
# if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, col="blue")}
# if(summary(mod)$coef[2,4]<.15){abline(mod, lty=3, col = "blue")}
# points(albchin95$alltotal,lime.df$lastest.p,pch=16, col = "blue",cex=1.2)
# mod<-lm(lime.df$lastest.p~albchin95$alltotal)
# if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, col="blue")}
# if(summary(mod)$coef[2,4]<.15){abline(mod, lty=3, col = "blue")}
dev.off()
quartz(height=4,width=12)
par(mfrow=c(1,3))
plot(albchinest95$firstobsdate,lime1995$firstest.all,type="p",pch=21, cex.axis=1.3,cex.lab=1.3,bg = cols[factor(albchin95$year)],xlab="Chinook Arrival (doy)",ylab="SRKW Arrival (doy)", cex=1.2, bty="l")
#what is the really late salmon year?
#albchin95$year[which(albchin95$firstobsdate==max(albchin95$firstobsdate, na.rm=TRUE))]#2007
#points(albchin95$firstobsdate,lime1995$firstest.all,pch=21, bg = cols[factor(albchin95$year)],cex=1.5)
legend("topleft",legend=c("1994","2017"), pch=21, pt.bg=c(cols[1], cols[length(cols)]), bty="n", cex=1.4)
mod<-lm(lime.df$firstest.all~albchin95$firstobsdate)
if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, lwd=2)}
if(summary(mod)$coef[2,4]<.15 & summary(mod)$coef[2,4]>.05){abline(mod, lty=3,  lwd=2)}
#whale days vs chinook run size
plot(albchin95$alltotal,lime.df$nobs,type="p",pch=21, bg = cols[factor(albchin95$year)],cex.axis=1.3,cex.lab=1.3,xlab="Chinook Abundance (cpue)",ylab="Whale days", cex=1.2, bty="l")
points(albchin95$alltotal,lime.df$nobs,pch=21, bg = cols[factor(albchin95$year)],cex=1.5)
mod<-lm(lime.df$nobs~albchin95$alltotal)
lime.df
#whale days vs chinook run size
plot(albchin95$alltotal,lime.df$nobs,type="p",pch=21, bg = cols[factor(albchin95$year)],cex.axis=1.3,cex.lab=1.3,xlab="Chinook Abundance (cpue)",ylab="Whale days", cex=1.2, bty="l")
mod<-lm(lime.df$nobs~albchin95$alltotal)
if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1, lwd=2)}
if(summary(mod)$coef[2,4]<.15 & summary(mod)$coef[2,4]>.05){abline(mod, lty=3, lwd=2)}
#compare lime kiln phenology to whol region phenology from 2002-2017
#Lastobs of SRKW vs total run size###Could add this
plot(albchin95$alltotal,lime.df$lastest.all,type="p",pch=21, bg = cols[factor(albchin95$year)],cex.axis=1.3,cex.lab=1.3,xlab="Chinook Abundance (cpue)",ylab="SRKW Departure (doy)", cex=1.2, bty="l")
mod<-lm(lime.df$lastest.all~albchin95$alltotal)
if(summary(mod)$coef[2,4]<.05){abline(mod, lty=1,lwd=2)}
if(summary(mod)$coef[2,4]<.15 & summary(mod)$coef[2,4]>.05){abline(mod, lty=3,lwd=2)}
